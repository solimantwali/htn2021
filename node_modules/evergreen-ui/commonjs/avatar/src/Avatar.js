"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _typeof = require("@babel/runtime/helpers/typeof");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _react = _interopRequireWildcard(require("react"));

var _classnames = _interopRequireDefault(require("classnames"));

var _glamor = require("glamor");

var _propTypes = _interopRequireDefault(require("prop-types"));

var _uiBox = _interopRequireDefault(require("ui-box"));

var _hooks = require("../../hooks");

var _image = require("../../image");

var _typography = require("../../typography");

var _getInitials = _interopRequireDefault(require("./utils/getInitials"));

var _hash = _interopRequireDefault(require("./utils/hash"));

var _excluded = ["className", "color", "forceShowInitials", "getInitials", "hashValue", "name", "shape", "size", "sizeLimitOneCharacter", "src"],
    _excluded2 = ["className"];

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { "default": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj["default"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

var imageStyles = {
  objectFit: 'cover'
};
var pseudoSelectors = {};
var internalStyles = {
  overflow: 'hidden',
  position: 'relative',
  display: 'inline-flex',
  flexShrink: 0,
  justifyContent: 'center'
};
var isObjectFitSupported = typeof document !== 'undefined' && 'objectFit' in document.documentElement.style;
var initialsStyleClass = (0, _glamor.css)({
  top: 0,
  position: 'absolute',
  display: 'flex',
  alignItems: 'center',
  justifyContent: 'center',
  lineHeight: 1
}).toString();

var getAvatarInitialsFontSize = function getAvatarInitialsFontSize(size, sizeLimitOneCharacter) {
  if (size <= sizeLimitOneCharacter) {
    return Math.floor(size / 2.2);
  }

  return Math.floor(size / 2.6);
};

var Avatar = /*#__PURE__*/(0, _react.memo)( /*#__PURE__*/(0, _react.forwardRef)(function Avatar(props, ref) {
  var className = props.className,
      _props$color = props.color,
      color = _props$color === void 0 ? 'automatic' : _props$color,
      _props$forceShowIniti = props.forceShowInitials,
      forceShowInitials = _props$forceShowIniti === void 0 ? false : _props$forceShowIniti,
      _props$getInitials = props.getInitials,
      getInitials = _props$getInitials === void 0 ? _getInitials["default"] : _props$getInitials,
      propsHashValue = props.hashValue,
      name = props.name,
      _props$shape = props.shape,
      shape = _props$shape === void 0 ? 'round' : _props$shape,
      _props$size = props.size,
      size = _props$size === void 0 ? 24 : _props$size,
      _props$sizeLimitOneCh = props.sizeLimitOneCharacter,
      sizeLimitOneCharacter = _props$sizeLimitOneCh === void 0 ? 20 : _props$sizeLimitOneCh,
      src = props.src,
      restProps = (0, _objectWithoutProperties2["default"])(props, _excluded);
  var hashValue = (0, _hash["default"])(propsHashValue || name);

  var _useStyleConfig = (0, _hooks.useStyleConfig)('Avatar', {
    color: color,
    hashValue: hashValue,
    shape: shape
  }, pseudoSelectors, internalStyles),
      themedClassName = _useStyleConfig.className,
      styleProps = (0, _objectWithoutProperties2["default"])(_useStyleConfig, _excluded2);

  var _useState = (0, _react.useState)(false),
      _useState2 = (0, _slicedToArray2["default"])(_useState, 2),
      imageHasFailedLoading = _useState2[0],
      setImageHasFailedLoading = _useState2[1];

  var onError = (0, _react.useCallback)(function () {
    return setImageHasFailedLoading(true);
  }, []);
  var imageUnavailable = !src || imageHasFailedLoading;
  var initialsFontSize = "".concat(getAvatarInitialsFontSize(size, sizeLimitOneCharacter), "px");
  var initials = getInitials(name);

  if (size <= sizeLimitOneCharacter) {
    initials = initials.slice(0, 1);
  }

  return /*#__PURE__*/_react["default"].createElement(_uiBox["default"], (0, _extends2["default"])({
    width: size,
    height: size,
    title: name,
    ref: ref,
    className: (0, _classnames["default"])(className, themedClassName)
  }, styleProps, restProps), (imageUnavailable || forceShowInitials) && /*#__PURE__*/_react["default"].createElement(_typography.Text, {
    className: initialsStyleClass,
    fontSize: initialsFontSize,
    lineHeight: initialsFontSize,
    width: size,
    height: size,
    color: "inherit"
  }, initials), !imageUnavailable && /*#__PURE__*/_react["default"].createElement(_image.Image, {
    style: imageStyles // Unsupported by ui-box directly
    ,
    width: isObjectFitSupported ? '100%' : 'auto' // Fallback to old behaviour on IE
    ,
    height: "100%",
    src: src,
    onError: onError
  }));
}));
Avatar.propTypes = {
  /**
   * Class name passed to the component.
   * Only use if you know what you are doing.
   */
  className: _propTypes["default"].string,

  /**
   * The src attribute of the image.
   * When it's not available, render initials instead.
   */
  src: _propTypes["default"].string,

  /**
   * The size of the avatar.
   */
  size: _propTypes["default"].number,

  /**
   * The name used for the initials and title attribute.
   */
  name: _propTypes["default"].string,

  /**
   * The value used for the hash function.
   * The name is used as the hashValue by default.
   * When dealing with anonymous users you should use the id instead.
   */
  hashValue: _propTypes["default"].string,

  /**
   * The color used for the avatar.
   * When the value is `automatic`, use the hash function to determine the color.
   */
  color: _propTypes["default"].string,

  /**
   * Function to get the initials based on the name.
   */
  getInitials: _propTypes["default"].func,

  /**
   * When true, force show the initials.
   * This is useful in some cases when using Gravatar and transparent pngs.
   */
  forceShowInitials: _propTypes["default"].bool,

  /**
   * When the size is smaller than this number, use a single initial for the avatar.
   */
  sizeLimitOneCharacter: _propTypes["default"].number,

  /**
   * Allows for the shape of the avatar component to either be round or square
   */
  shape: _propTypes["default"].oneOf(['round', 'square'])
};
var _default = Avatar;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9hdmF0YXIvc3JjL0F2YXRhci5qcyJdLCJuYW1lcyI6WyJpbWFnZVN0eWxlcyIsIm9iamVjdEZpdCIsInBzZXVkb1NlbGVjdG9ycyIsImludGVybmFsU3R5bGVzIiwib3ZlcmZsb3ciLCJwb3NpdGlvbiIsImRpc3BsYXkiLCJmbGV4U2hyaW5rIiwianVzdGlmeUNvbnRlbnQiLCJpc09iamVjdEZpdFN1cHBvcnRlZCIsImRvY3VtZW50IiwiZG9jdW1lbnRFbGVtZW50Iiwic3R5bGUiLCJpbml0aWFsc1N0eWxlQ2xhc3MiLCJ0b3AiLCJhbGlnbkl0ZW1zIiwibGluZUhlaWdodCIsInRvU3RyaW5nIiwiZ2V0QXZhdGFySW5pdGlhbHNGb250U2l6ZSIsInNpemUiLCJzaXplTGltaXRPbmVDaGFyYWN0ZXIiLCJNYXRoIiwiZmxvb3IiLCJBdmF0YXIiLCJwcm9wcyIsInJlZiIsImNsYXNzTmFtZSIsImNvbG9yIiwiZm9yY2VTaG93SW5pdGlhbHMiLCJnZXRJbml0aWFscyIsImdsb2JhbEdldEluaXRpYWxzIiwicHJvcHNIYXNoVmFsdWUiLCJoYXNoVmFsdWUiLCJuYW1lIiwic2hhcGUiLCJzcmMiLCJyZXN0UHJvcHMiLCJ0aGVtZWRDbGFzc05hbWUiLCJzdHlsZVByb3BzIiwiaW1hZ2VIYXNGYWlsZWRMb2FkaW5nIiwic2V0SW1hZ2VIYXNGYWlsZWRMb2FkaW5nIiwib25FcnJvciIsImltYWdlVW5hdmFpbGFibGUiLCJpbml0aWFsc0ZvbnRTaXplIiwiaW5pdGlhbHMiLCJzbGljZSIsInByb3BUeXBlcyIsIlByb3BUeXBlcyIsInN0cmluZyIsIm51bWJlciIsImZ1bmMiLCJib29sIiwib25lT2YiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7OztBQUVBLElBQU1BLFdBQVcsR0FBRztBQUFFQyxFQUFBQSxTQUFTLEVB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Q0FBZjtBQXVFQWxCLE1BQU0sQ0FBQ3VCLFNBQVAsR0FBbUI7QUFDakI7QUFDRjtBQUNBO0FBQ0E7QUFDRXBCLEVBQUFBLFNBQVMsRUFBRXFCLHNCQUFVQyxNQUxKOztBQU9qQjtBQUNGO0FBQ0E7QUFDQTtBQUNFYixFQUFBQSxHQUFHLEVBQUVZLHNCQUFVQyxNQVhFOztBQWFqQjtBQUNGO0FBQ0E7QUFDRTdCLEVBQUFBLElBQUksRUFBRTRCLHNCQUFVRSxNQWhCQzs7QUFrQmpCO0FBQ0Y7QUFDQTtBQUNFaEIsRUFBQUEsSUFBSSxFQUFFYyxzQkFBVUMsTUFyQkM7O0FBdUJqQjtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0VoQixFQUFBQSxTQUFTLEVBQUVlLHNCQUFVQyxNQTVCSjs7QUE4QmpCO0FBQ0Y7QUFDQTtBQUNBO0FBQ0VyQixFQUFBQSxLQUFLLEVBQUVvQixzQkFBVUMsTUFsQ0E7O0FBb0NqQjtBQUNGO0FBQ0E7QUFDRW5CLEVBQUFBLFdBQVcsRUFBRWtCLHNCQUFVRyxJQXZDTjs7QUF5Q2pCO0FBQ0Y7QUFDQTtBQUNBO0FBQ0V0QixFQUFBQSxpQkFBaUIsRUFBRW1CLHNCQUFVSSxJQTdDWjs7QUErQ2pCO0FBQ0Y7QUFDQTtBQUNFL0IsRUFBQUEscUJBQXFCLEVBQUUyQixzQkFBVUUsTUFsRGhCOztBQW9EakI7QUFDRjtBQUNBO0FBQ0VmLEVBQUFBLEtBQUssRUFBRWEsc0JBQVVLLEtBQVYsQ0FBZ0IsQ0FBQyxPQUFELEVBQVUsUUFBVixDQUFoQjtBQXZEVSxDQUFuQjtlQTBEZTdCLE0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgdXNlU3RhdGUsIG1lbW8sIGZvcndhcmRSZWYsIHVzZUNhbGxiYWNrIH0gZnJvbSAncmVhY3QnXG5pbXBvcnQgY3ggZnJvbSAnY2xhc3NuYW1lcydcbmltcG9ydCB7IGNzcyB9IGZyb20gJ2dsYW1vcidcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcydcbmltcG9ydCBCb3ggZnJvbSAndWktYm94J1xuaW1wb3J0IHsgdXNlU3R5bGVDb25maWcgfSBmcm9tICcuLi8uLi9ob29rcydcbmltcG9ydCB7IEltYWdlIH0gZnJvbSAnLi4vLi4vaW1hZ2UnXG5pbXBvcnQgeyBUZXh0IH0gZnJvbSAnLi4vLi4vdHlwb2dyYXBoeSdcbmltcG9ydCBnbG9iYWxHZXRJbml0aWFscyBmcm9tICcuL3V0aWxzL2dldEluaXRpYWxzJ1xuaW1wb3J0IGdsb2JhbEhhc2ggZnJvbSAnLi91dGlscy9oYXNoJ1xuXG5jb25zdCBpbWFnZVN0eWxlcyA9IHsgb2JqZWN0Rml0OiAnY292ZXInIH1cblxuY29uc3QgcHNldWRvU2VsZWN0b3JzID0ge31cbmNvbnN0IGludGVybmFsU3R5bGVzID0ge1xuICBvdmVyZmxvdzogJ2hpZGRlbicsXG4gIHBvc2l0aW9uOiAncmVsYXRpdmUnLFxuICBkaXNwbGF5OiAnaW5saW5lLWZsZXgnLFxuICBmbGV4U2hyaW5rOiAwLFxuICBqdXN0aWZ5Q29udGVudDogJ2NlbnRlcidcbn1cblxuY29uc3QgaXNPYmplY3RGaXRTdXBwb3J0ZWQgPSB0eXBlb2YgZG9jdW1lbnQgIT09ICd1bmRlZmluZWQnICYmICdvYmplY3RGaXQnIGluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZVxuXG5jb25zdCBpbml0aWFsc1N0eWxlQ2xhc3MgPSBjc3Moe1xuICB0b3A6IDAsXG4gIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICBkaXNwbGF5OiAnZmxleCcsXG4gIGFsaWduSXRlbXM6ICdjZW50ZXInLFxuICBqdXN0aWZ5Q29udGVudDogJ2NlbnRlcicsXG4gIGxpbmVIZWlnaHQ6IDFcbn0pLnRvU3RyaW5nKClcblxuY29uc3QgZ2V0QXZhdGFySW5pdGlhbHNGb250U2l6ZSA9IChzaXplLCBzaXplTGltaXRPbmVDaGFyYWN0ZXIpID0+IHtcbiAgaWYgKHNpemUgPD0gc2l6ZUxpbWl0T25lQ2hhcmFjdGVyKSB7XG4gICAgcmV0dXJuIE1hdGguZmxvb3Ioc2l6ZSAvIDIuMilcbiAgfVxuXG4gIHJldHVybiBNYXRoLmZsb29yKHNpemUgLyAyLjYpXG59XG5cbmNvbnN0IEF2YXRhciA9IG1lbW8oXG4gIGZvcndhcmRSZWYoZnVuY3Rpb24gQXZhdGFyKHByb3BzLCByZWYpIHtcbiAgICBjb25zdCB7XG4gICAgICBjbGFzc05hbWUsXG4gICAgICBjb2xvciA9ICdhdXRvbWF0aWMnLFxuICAgICAgZm9yY2VTaG93SW5pdGlhbHMgPSBmYWxzZSxcbiAgICAgIGdldEluaXRpYWxzID0gZ2xvYmFsR2V0SW5pdGlhbHMsXG4gICAgICBoYXNoVmFsdWU6IHByb3BzSGFzaFZhbHVlLFxuICAgICAgbmFtZSxcbiAgICAgIHNoYXBlID0gJ3JvdW5kJyxcbiAgICAgIHNpemUgPSAyNCxcbiAgICAgIHNpemVMaW1pdE9uZUNoYXJhY3RlciA9IDIwLFxuICAgICAgc3JjLFxuICAgICAgLi4ucmVzdFByb3BzXG4gICAgfSA9IHByb3BzXG5cbiAgICBjb25zdCBoYXNoVmFsdWUgPSBnbG9iYWxIYXNoKHByb3BzSGFzaFZhbHVlIHx8IG5hbWUpXG4gICAgY29uc3QgeyBjbGFzc05hbWU6IHRoZW1lZENsYXNzTmFtZSwgLi4uc3R5bGVQcm9wcyB9ID0gdXNlU3R5bGVDb25maWcoXG4gICAgICAnQXZhdGFyJyxcbiAgICAgIHsgY29sb3IsIGhhc2hWYWx1ZSwgc2hhcGUgfSxcbiAgICAgIHBzZXVkb1NlbGVjdG9ycyxcbiAgICAgIGludGVybmFsU3R5bGVzXG4gICAgKVxuXG4gICAgY29uc3QgW2ltYWdlSGFzRmFpbGVkTG9hZGluZywgc2V0SW1hZ2VIYXNGYWlsZWRMb2FkaW5nXSA9IHVzZVN0YXRlKGZhbHNlKVxuICAgIGNvbnN0IG9uRXJyb3IgPSB1c2VDYWxsYmFjaygoKSA9PiBzZXRJbWFnZUhhc0ZhaWxlZExvYWRpbmcodHJ1ZSksIFtdKVxuICAgIGNvbnN0IGltYWdlVW5hdmFpbGFibGUgPSAhc3JjIHx8IGltYWdlSGFzRmFpbGVkTG9hZGluZ1xuXG4gICAgY29uc3QgaW5pdGlhbHNGb250U2l6ZSA9IGAke2dldEF2YXRhckluaXRpYWxzRm9udFNpemUoc2l6ZSwgc2l6ZUxpbWl0T25lQ2hhcmFjdGVyKX1weGBcblxuICAgIGxldCBpbml0aWFscyA9IGdldEluaXRpYWxzKG5hbWUpXG4gICAgaWYgKHNpemUgPD0gc2l6ZUxpbWl0T25lQ2hhcmFjdGVyKSB7XG4gICAgICBpbml0aWFscyA9IGluaXRpYWxzLnNsaWNlKDAsIDEpXG4gICAgfVxuXG4gICAgcmV0dXJuIChcbiAgICAgIDxCb3hcbiAgICAgICAgd2lkdGg9e3NpemV9XG4gICAgICAgIGhlaWdodD17c2l6ZX1cbiAgICAgICAgdGl0bGU9e25hbWV9XG4gICAgICAgIHJlZj17cmVmfVxuICAgICAgICBjbGFzc05hbWU9e2N4KGNsYXNzTmFtZSwgdGhlbWVkQ2xhc3NOYW1lKX1cbiAgICAgICAgey4uLnN0eWxlUHJvcHN9XG4gICAgICAgIHsuLi5yZXN0UHJvcHN9XG4gICAgICA+XG4gICAgICAgIHsoaW1hZ2VVbmF2YWlsYWJsZSB8fCBmb3JjZVNob3dJbml0aWFscykgJiYgKFxuICAgICAgICAgIDxUZXh0XG4gICAgICAgICAgICBjbGFzc05hbWU9e2luaXRpYWxzU3R5bGVDbGFzc31cbiAgICAgICAgICAgIGZvbnRTaXplPXtpbml0aWFsc0ZvbnRTaXplfVxuICAgICAgICAgICAgbGluZUhlaWdodD17aW5pdGlhbHNGb250U2l6ZX1cbiAgICAgICAgICAgIHdpZHRoPXtzaXplfVxuICAgICAgICAgICAgaGVpZ2h0PXtzaXplfVxuICAgICAgICAgICAgY29sb3I9XCJpbmhlcml0XCJcbiAgICAgICAgICA+XG4gICAgICAgICAgICB7aW5pdGlhbHN9XG4gICAgICAgICAgPC9UZXh0PlxuICAgICAgICApfVxuICAgICAgICB7IWltYWdlVW5hdmFpbGFibGUgJiYgKFxuICAgICAgICAgIDxJbWFnZVxuICAgICAgICAgICAgc3R5bGU9e2ltYWdlU3R5bGVzfSAvLyBVbnN1cHBvcnRlZCBieSB1aS1ib3ggZGlyZWN0bHlcbiAgICAgICAgICAgIHdpZHRoPXtpc09iamVjdEZpdFN1cHBvcnRlZCA/ICcxMDAlJyA6ICdhdXRvJ30gLy8gRmFsbGJhY2sgdG8gb2xkIGJlaGF2aW91ciBvbiBJRVxuICAgICAgICAgICAgaGVpZ2h0PVwiMTAwJVwiXG4gICAgICAgICAgICBzcmM9e3NyY31cbiAgICAgICAgICAgIG9uRXJyb3I9e29uRXJyb3J9XG4gICAgICAgICAgLz5cbiAgICAgICAgKX1cbiAgICAgIDwvQm94PlxuICAgIClcbiAgfSlcbilcblxuQXZhdGFyLnByb3BUeXBlcyA9IHtcbiAgLyoqXG4gICAqIENsYXNzIG5hbWUgcGFzc2VkIHRvIHRoZSBjb21wb25lbnQuXG4gICAqIE9ubHkgdXNlIGlmIHlvdSBrbm93IHdoYXQgeW91IGFyZSBkb2luZy5cbiAgICovXG4gIGNsYXNzTmFtZTogUHJvcFR5cGVzLnN0cmluZyxcblxuICAvKipcbiAgICogVGhlIHNyYyBhdHRyaWJ1dGUgb2YgdGhlIGltYWdlLlxuICAgKiBXaGVuIGl0J3Mgbm90IGF2YWlsYWJsZSwgcmVuZGVyIGluaXRpYWxzIGluc3RlYWQuXG4gICAqL1xuICBzcmM6IFByb3BUeXBlcy5zdHJpbmcsXG5cbiAgLyoqXG4gICAqIFRoZSBzaXplIG9mIHRoZSBhdmF0YXIuXG4gICAqL1xuICBzaXplOiBQcm9wVHlwZXMubnVtYmVyLFxuXG4gIC8qKlxuICAgKiBUaGUgbmFtZSB1c2VkIGZvciB0aGUgaW5pdGlhbHMgYW5kIHRpdGxlIGF0dHJpYnV0ZS5cbiAgICovXG4gIG5hbWU6IFByb3BUeXBlcy5zdHJpbmcsXG5cbiAgLyoqXG4gICAqIFRoZSB2YWx1ZSB1c2VkIGZvciB0aGUgaGFzaCBmdW5jdGlvbi5cbiAgICogVGhlIG5hbWUgaXMgdXNlZCBhcyB0aGUgaGFzaFZhbHVlIGJ5IGRlZmF1bHQuXG4gICAqIFdoZW4gZGVhbGluZyB3aXRoIGFub255bW91cyB1c2VycyB5b3Ugc2hvdWxkIHVzZSB0aGUgaWQgaW5zdGVhZC5cbiAgICovXG4gIGhhc2hWYWx1ZTogUHJvcFR5cGVzLnN0cmluZyxcblxuICAvKipcbiAgICogVGhlIGNvbG9yIHVzZWQgZm9yIHRoZSBhdmF0YXIuXG4gICAqIFdoZW4gdGhlIHZhbHVlIGlzIGBhdXRvbWF0aWNgLCB1c2UgdGhlIGhhc2ggZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIHRoZSBjb2xvci5cbiAgICovXG4gIGNvbG9yOiBQcm9wVHlwZXMuc3RyaW5nLFxuXG4gIC8qKlxuICAgKiBGdW5jdGlvbiB0byBnZXQgdGhlIGluaXRpYWxzIGJhc2VkIG9uIHRoZSBuYW1lLlxuICAgKi9cbiAgZ2V0SW5pdGlhbHM6IFByb3BUeXBlcy5mdW5jLFxuXG4gIC8qKlxuICAgKiBXaGVuIHRydWUsIGZvcmNlIHNob3cgdGhlIGluaXRpYWxzLlxuICAgKiBUaGlzIGlzIHVzZWZ1bCBpbiBzb21lIGNhc2VzIHdoZW4gdXNpbmcgR3JhdmF0YXIgYW5kIHRyYW5zcGFyZW50IHBuZ3MuXG4gICAqL1xuICBmb3JjZVNob3dJbml0aWFsczogUHJvcFR5cGVzLmJvb2wsXG5cbiAgLyoqXG4gICAqIFdoZW4gdGhlIHNpemUgaXMgc21hbGxlciB0aGFuIHRoaXMgbnVtYmVyLCB1c2UgYSBzaW5nbGUgaW5pdGlhbCBmb3IgdGhlIGF2YXRhci5cbiAgICovXG4gIHNpemVMaW1pdE9uZUNoYXJhY3RlcjogUHJvcFR5cGVzLm51bWJlcixcblxuICAvKipcbiAgICogQWxsb3dzIGZvciB0aGUgc2hhcGUgb2YgdGhlIGF2YXRhciBjb21wb25lbnQgdG8gZWl0aGVyIGJlIHJvdW5kIG9yIHNxdWFyZVxuICAgKi9cbiAgc2hhcGU6IFByb3BUeXBlcy5vbmVPZihbJ3JvdW5kJywgJ3NxdWFyZSddKVxufVxuXG5leHBvcnQgZGVmYXVsdCBBdmF0YXJcbiJdfQ==
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _typeof = require("@babel/runtime/helpers/typeof");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = exports.usePaginationBehavior = void 0;

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _buttons = require("../../buttons");

var _icons = require("../../icons");

var _layers = require("../../layers");

var _scales = require("../../scales");

var _theme = require("../../theme");

var _typography = require("../../typography");

var _excluded = ["isSelected", "onPageChange", "page"],
    _excluded2 = ["onNextPage", "onPageChange", "onPreviousPage", "page", "totalPages"];

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { "default": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj["default"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

var usePaginationBehavior = function usePaginationBehavior() {
  var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
      _ref$page = _ref.page,
      inputPage = _ref$page === void 0 ? 1 : _ref$page;

  var _useState = (0, _react.useState)(inputPage),
      _useState2 = (0, _slicedToArray2["default"])(_useState, 2),
      page = _useState2[0],
      setPage = _useState2[1];

  var onNextPage = (0, _react.useCallback)(function () {
    setPage(function (page) {
      return page + 1;
    });
  }, []);
  var onPreviousPage = (0, _react.useCallback)(function () {
    setPage(function (page) {
      return page - 1;
    });
  }, []);
  var onPageChange = (0, _react.useCallback)(function (index) {
    setPage(index);
  }, []);
  return {
    page: page,
    onNextPage: onNextPage,
    onPageChange: onPageChange,
    onPreviousPage: onPreviousPage
  };
};

exports.usePaginationBehavior = usePaginationBehavior;
var MAX_HANDLES_TO_SHOW = 7;
/* eslint-disable react/prop-types */

var PaginationButton = function PaginationButton(_ref2) {
  var isSelected = _ref2.isSelected,
      onPageChange = _ref2.onPageChange,
      page = _ref2.page,
      rest = (0, _objectWithoutProperties2["default"])(_ref2, _excluded);

  var _useTheme = (0, _theme.useTheme)(),
      colors = _useTheme.colors;

  var isEllipsis = typeof page === 'string' && page === '...';
  var selectedProps = (0, _react.useMemo)(function () {
    if (isSelected) {
      return {
        backgroundColor: colors.blue50,
        color: colors.blue400
      };
    } else {
      return {};
    }
  }, [isSelected, colors]);
  var onClick = (0, _react.useCallback)(function () {
    onPageChange(page);
  }, [page, onPageChange]);

  if (isEllipsis) {
    return /*#__PURE__*/_react["default"].createElement(_typography.Text, {
      paddingX: (0, _scales.majorScale)(1),
      paddingY: (0, _scales.majorScale)(1),
      minWidth: (0, _scales.majorScale)(4),
      textAlign: "center",
      "aria-label": "Pagination overflow"
    }, page);
  }

  return /*#__PURE__*/_react["default"].createElement(_buttons.Button, (0, _extends2["default"])({
    "aria-current": isSelected,
    "aria-label": "Page ".concat(page),
    onClick: onClick,
    minWidth: (0, _scales.majorScale)(4),
    paddingX: (0, _scales.majorScale)(1)
  }, rest, selectedProps));
};

PaginationButton.displayName = "PaginationButton";

/* eslint-enable react/prop-types */
var range = function range(start, stop) {
  var output = [];

  for (var i = start; i <= stop; i++) {
    output.push(i);
  }

  return output;
};

var getPaginationButtonContent = function getPaginationButtonContent(_ref3) {
  var page = _ref3.page,
      totalPages = _ref3.totalPages;

  if (totalPages <= MAX_HANDLES_TO_SHOW) {
    return range(1, totalPages);
  }

  if (totalPages > MAX_HANDLES_TO_SHOW && page <= 4) {
    return [].concat((0, _toConsumableArray2["default"])(range(1, 5)), ['...', totalPages]);
  }

  if (totalPages - page < 4) {
    return [1, '...'].concat((0, _toConsumableArray2["default"])(range(totalPages - 4, totalPages)));
  }

  return [1, '...'].concat((0, _toConsumableArray2["default"])(range(page - 1, page + 1)), ['...', totalPages]);
};

var noop = function noop() {};

var Pagination = /*#__PURE__*/(0, _react.memo)( /*#__PURE__*/(0, _react.forwardRef)(function Pagination(_ref4, ref) {
  var _ref4$onNextPage = _ref4.onNextPage,
      onNextPage = _ref4$onNextPage === void 0 ? noop : _ref4$onNextPage,
      _ref4$onPageChange = _ref4.onPageChange,
      onPageChange = _ref4$onPageChange === void 0 ? noop : _ref4$onPageChange,
      _ref4$onPreviousPage = _ref4.onPreviousPage,
      onPreviousPage = _ref4$onPreviousPage === void 0 ? noop : _ref4$onPreviousPage,
      _ref4$page = _ref4.page,
      page = _ref4$page === void 0 ? 1 : _ref4$page,
      totalPages = _ref4.totalPages,
      rest = (0, _objectWithoutProperties2["default"])(_ref4, _excluded2);
  return /*#__PURE__*/_react["default"].createElement(_layers.Pane, (0, _extends2["default"])({
    is: "nav",
    role: "navigation",
    "aria-label": "Pagination"
  }, rest, {
    ref: ref
  }), /*#__PURE__*/_react["default"].createElement(_layers.Pane, {
    is: "ul",
    display: "flex",
    alignItems: "center",
    padding: 0
  }, /*#__PURE__*/_react["default"].createElement(_layers.Pane, {
    is: "li",
    listStyle: "none"
  }, /*#__PURE__*/_react["default"].createElement(_buttons.IconButton, {
    appearance: "minimal",
    icon: _icons.ChevronLeftIcon,
    disabled: page === 1,
    onClick: onPreviousPage
  })), totalPages ? getPaginationButtonContent({
    totalPages: totalPages,
    page: page
  }).map(function (val, i) {
    var isSelected = val === page;
    return /*#__PURE__*/_react["default"].createElement(_layers.Pane, {
      is: "li",
      listStyle: "none",
      key: "".concat(val, "-").concat(i)
    }, /*#__PURE__*/_react["default"].createElement(PaginationButton, {
      appearance: "minimal",
      isSelected: isSelected,
      page: val,
      onPageChange: onPageChange,
      marginX: (0, _scales.minorScale)(1) / 2
    }, val));
  }) : null, /*#__PURE__*/_react["default"].createElement(_layers.Pane, {
    is: "li",
    listStyle: "none"
  }, /*#__PURE__*/_react["default"].createElement(_buttons.IconButton, {
    appearance: "minimal",
    icon: _icons.ChevronRightIcon,
    disabled: totalPages ? page === totalPages : undefined,
    onClick: onNextPage
  }))));
}));
Pagination.propTypes = {
  /**
   * The current page that a user is on - defaults to 1.
   */
  page: _propTypes["default"].number.isRequired,

  /**
   * The total number of pages to render. If ommitted, the page numbers will not be shown to the end user.
   */
  totalPages: _propTypes["default"].number,

  /**
   * Callback handler when the next page button is clicked.
   */
  onNextPage: _propTypes["default"].func,

  /**
   * Callback handler when the previous page button is clicked.
   */
  onPreviousPage: _propTypes["default"].func,

  /**
   * Callback handler when a specific page # is clicked
   */
  onPageChange: _propTypes["default"].func
};
var _default = Pagination;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9wYWdpbmF0aW9uL3NyYy9QYWdpbmF0aW9uLmpzIl0sIm5hbWVzIjpbInVzZVBhZ2luYXRpb25CZWhhdmlvciIsInBhZ2UiLCJpbnB1dFBhZ2UiLCJzZXRQYWdlIiwib25OZXh0UGFnZSIsIm9uUHJldmlvdXNQYWdlIiwib25QYWdlQ2hhbmdlIiwiaW5kZXgiLCJNQVhfSEFORExFU19UT19TSE9XIiwiUGFnaW5hdGlvbkJ1dHRvbiIsImlzU2VsZWN0ZWQiLCJyZXN0IiwiY29sb3JzIiwiaXNFbGxpcHNpcyIsInNlbGVjdGVkUHJvcHMiLCJiYWNrZ3JvdW5kQ29sb3IiLCJibHVlNTAiLCJjb2xvciIsImJsdWU0MDAiLCJvbkNsaWNrIiwicmFuZ2UiLCJzdGFydCIsInN0b3AiLCJvdXRwdXQiLCJpIiwicHVzaCIsImdldFBhZ2luYXRpb25CdXR0b25Db250ZW50IiwidG90YWxQYWdlcyIsIm5vb3AiLCJQYWdpbmF0aW9uIiwicmVmIiwiQ2hldnJvbkxlZnRJY29uIiwibWFwIiwidmFsIiwiQ2hldnJvblJpZ2h0SWNvbiIsInVuZGVmaW5lZCIsInByb3BUeXBlcyIsIlByb3BUeXBlcyIsIm51bWJlciIsImlzUmVxdWlyZWQiLCJmdW5jIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7OztBQUVPLElBQU1BLHFCQUFxQixHQUFHLFNBQXhCQSxxQkFBd0IsR0FBa0M7QUFBQSxpRkFBUCxFQUFPO0FBQUEsdUJBQS9CQyxJQUErQjtBQUFBLE1BQXpCQyxTQUF5QiwwQkFBYixDQUFhOztBQUNyRSxrQkFBd0IscUJBQVNBLFNBQVQsQ0FBeEI7QUFBQTtBQUFBLE1BQU9ELElBQVA7QUFBQSxNQUFhRSxPQUFiOztBQUVBLE1BQU1DLFVBQVUsR0FBRyx3QkFBWSxZQUFNO0FBQ25DRCxJQUFBQSxPQUFPLENBQUMsVUFBQUYsSUFBSTtBQUFBLGFB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QUFJRSxNQUFBLFlBQVksRUFBRTNCLFlBSmhCO0FBS0UsTUFBQSxPQUFPLEVBQUUsd0JBQVcsQ0FBWCxJQUFnQjtBQUwzQixPQU9HMkIsR0FQSCxDQURGLENBREY7QUFhRCxHQWhCRCxDQURPLEdBa0JQLElBdEJOLGVBdUJFLGdDQUFDLFlBQUQ7QUFBTSxJQUFBLEVBQUUsRUFBQyxJQUFUO0FBQWMsSUFBQSxTQUFTLEVBQUM7QUFBeEIsa0JBQ0UsZ0NBQUMsbUJBQUQ7QUFDRSxJQUFBLFVBQVUsRUFBQyxTQURiO0FBRUUsSUFBQSxJQUFJLEVBQUVDLHVCQUZSO0FBR0UsSUFBQSxRQUFRLEVBQUVQLFVBQVUsR0FBRzFCLElBQUksS0FBSzBCLFVBQVosR0FBeUJRLFNBSC9DO0FBSUUsSUFBQSxPQUFPLEVBQUUvQjtBQUpYLElBREYsQ0F2QkYsQ0FERixDQURGO0FBb0NELENBeENELENBRGlCLENBQW5CO0FBNENBeUIsVUFBVSxDQUFDTyxTQUFYLEdBQXVCO0FBQ3JCO0FBQ0Y7QUFDQTtBQUNFbkMsRUFBQUEsSUFBSSxFQUFFb0Msc0JBQVVDLE1BQVYsQ0FBaUJDLFVBSkY7O0FBS3JCO0FBQ0Y7QUFDQTtBQUNFWixFQUFBQSxVQUFVLEVBQUVVLHNCQUFVQyxNQVJEOztBQVNyQjtBQUNGO0FBQ0E7QUFDRWxDLEVBQUFBLFVBQVUsRUFBRWlDLHNCQUFVRyxJQVpEOztBQWFyQjtBQUNGO0FBQ0E7QUFDRW5DLEVBQUFBLGNBQWMsRUFBRWdDLHNCQUFVRyxJQWhCTDs7QUFpQnJCO0FBQ0Y7QUFDQTtBQUNFbEMsRUFBQUEsWUFBWSxFQUFFK0Isc0JBQVVHO0FBcEJILENBQXZCO2VBdUJlWCxVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IHVzZVN0YXRlLCB1c2VDYWxsYmFjaywgdXNlTWVtbywgbWVtbywgZm9yd2FyZFJlZiB9IGZyb20gJ3JlYWN0J1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJ1xuaW1wb3J0IHsgQnV0dG9uLCBJY29uQnV0dG9uIH0gZnJvbSAnLi4vLi4vYnV0dG9ucydcbmltcG9ydCB7IENoZXZyb25MZWZ0SWNvbiwgQ2hldnJvblJpZ2h0SWNvbiB9IGZyb20gJy4uLy4uL2ljb25zJ1xuaW1wb3J0IHsgUGFuZSB9IGZyb20gJy4uLy4uL2xheWVycydcbmltcG9ydCB7IG1ham9yU2NhbGUsIG1pbm9yU2NhbGUgfSBmcm9tICcuLi8uLi9zY2FsZXMnXG5pbXBvcnQgeyB1c2VUaGVtZSB9IGZyb20gJy4uLy4uL3RoZW1lJ1xuaW1wb3J0IHsgVGV4dCB9IGZyb20gJy4uLy4uL3R5cG9ncmFwaHknXG5cbmV4cG9ydCBjb25zdCB1c2VQYWdpbmF0aW9uQmVoYXZpb3IgPSAoeyBwYWdlOiBpbnB1dFBhZ2UgPSAxIH0gPSB7fSkgPT4ge1xuICBjb25zdCBbcGFnZSwgc2V0UGFnZV0gPSB1c2VTdGF0ZShpbnB1dFBhZ2UpXG5cbiAgY29uc3Qgb25OZXh0UGFnZSA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBzZXRQYWdlKHBhZ2UgPT4gcGFnZSArIDEpXG4gIH0sIFtdKVxuXG4gIGNvbnN0IG9uUHJldmlvdXNQYWdlID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIHNldFBhZ2UocGFnZSA9PiBwYWdlIC0gMSlcbiAgfSwgW10pXG5cbiAgY29uc3Qgb25QYWdlQ2hhbmdlID0gdXNlQ2FsbGJhY2soaW5kZXggPT4ge1xuICAgIHNldFBhZ2UoaW5kZXgpXG4gIH0sIFtdKVxuXG4gIHJldHVybiB7XG4gICAgcGFnZSxcbiAgICBvbk5leHRQYWdlLFxuICAgIG9uUGFnZUNoYW5nZSxcbiAgICBvblByZXZpb3VzUGFnZVxuICB9XG59XG5cbmNvbnN0IE1BWF9IQU5ETEVTX1RPX1NIT1cgPSA3XG5cbi8qIGVzbGludC1kaXNhYmxlIHJlYWN0L3Byb3AtdHlwZXMgKi9cbmNvbnN0IFBhZ2luYXRpb25CdXR0b24gPSAoeyBpc1NlbGVjdGVkLCBvblBhZ2VDaGFuZ2UsIHBhZ2UsIC4uLnJlc3QgfSkgPT4ge1xuICBjb25zdCB7IGNvbG9ycyB9ID0gdXNlVGhlbWUoKVxuICBjb25zdCBpc0VsbGlwc2lzID0gdHlwZW9mIHBhZ2UgPT09ICdzdHJpbmcnICYmIHBhZ2UgPT09ICcuLi4nXG4gIGNvbnN0IHNlbGVjdGVkUHJvcHMgPSB1c2VNZW1vKCgpID0+IHtcbiAgICBpZiAoaXNTZWxlY3RlZCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYmFja2dyb3VuZENvbG9yOiBjb2xvcnMuYmx1ZTUwLFxuICAgICAgICBjb2xvcjogY29sb3JzLmJsdWU0MDBcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHt9XG4gICAgfVxuICB9LCBbaXNTZWxlY3RlZCwgY29sb3JzXSlcblxuICBjb25zdCBvbkNsaWNrID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIG9uUGFnZUNoYW5nZShwYWdlKVxuICB9LCBbcGFnZSwgb25QYWdlQ2hhbmdlXSlcblxuICBpZiAoaXNFbGxpcHNpcykge1xuICAgIHJldHVybiAoXG4gICAgICA8VGV4dFxuICAgICAgICBwYWRkaW5nWD17bWFqb3JTY2FsZSgxKX1cbiAgICAgICAgcGFkZGluZ1k9e21ham9yU2NhbGUoMSl9XG4gICAgICAgIG1pbldpZHRoPXttYWpvclNjYWxlKDQpfVxuICAgICAgICB0ZXh0QWxpZ249XCJjZW50ZXJcIlxuICAgICAgICBhcmlhLWxhYmVsPVwiUGFnaW5hdGlvbiBvdmVyZmxvd1wiXG4gICAgICA+XG4gICAgICAgIHtwYWdlfVxuICAgICAgPC9UZXh0PlxuICAgIClcbiAgfVxuXG4gIHJldHVybiAoXG4gICAgPEJ1dHRvblxuICAgICAgYXJpYS1jdXJyZW50PXtpc1NlbGVjdGVkfVxuICAgICAgYXJpYS1sYWJlbD17YFBhZ2UgJHtwYWdlfWB9XG4gICAgICBvbkNsaWNrPXtvbkNsaWNrfVxuICAgICAgbWluV2lkdGg9e21ham9yU2NhbGUoNCl9XG4gICAgICBwYWRkaW5nWD17bWFqb3JTY2FsZSgxKX1cbiAgICAgIHsuLi5yZXN0fVxuICAgICAgey4uLnNlbGVjdGVkUHJvcHN9XG4gICAgLz5cbiAgKVxufVxuLyogZXNsaW50LWVuYWJsZSByZWFjdC9wcm9wLXR5cGVzICovXG5cbmNvbnN0IHJhbmdlID0gKHN0YXJ0LCBzdG9wKSA9PiB7XG4gIGNvbnN0IG91dHB1dCA9IFtdXG4gIGZvciAobGV0IGkgPSBzdGFydDsgaSA8PSBzdG9wOyBpKyspIHtcbiAgICBvdXRwdXQucHVzaChpKVxuICB9XG5cbiAgcmV0dXJuIG91dHB1dFxufVxuXG5jb25zdCBnZXRQYWdpbmF0aW9uQnV0dG9uQ29udGVudCA9ICh7IHBhZ2UsIHRvdGFsUGFnZXMgfSkgPT4ge1xuICBpZiAodG90YWxQYWdlcyA8PSBNQVhfSEFORExFU19UT19TSE9XKSB7XG4gICAgcmV0dXJuIHJhbmdlKDEsIHRvdGFsUGFnZXMpXG4gIH1cblxuICBpZiAodG90YWxQYWdlcyA+IE1BWF9IQU5ETEVTX1RPX1NIT1cgJiYgcGFnZSA8PSA0KSB7XG4gICAgcmV0dXJuIFsuLi5yYW5nZSgxLCA1KSwgJy4uLicsIHRvdGFsUGFnZXNdXG4gIH1cblxuICBpZiAodG90YWxQYWdlcyAtIHBhZ2UgPCA0KSB7XG4gICAgcmV0dXJuIFsxLCAnLi4uJywgLi4ucmFuZ2UodG90YWxQYWdlcyAtIDQsIHRvdGFsUGFnZXMpXVxuICB9XG5cbiAgcmV0dXJuIFsxLCAnLi4uJywgLi4ucmFuZ2UocGFnZSAtIDEsIHBhZ2UgKyAxKSwgJy4uLicsIHRvdGFsUGFnZXNdXG59XG5cbmNvbnN0IG5vb3AgPSAoKSA9PiB7fVxuXG5jb25zdCBQYWdpbmF0aW9uID0gbWVtbyhcbiAgZm9yd2FyZFJlZihmdW5jdGlvbiBQYWdpbmF0aW9uKFxuICAgIHsgb25OZXh0UGFnZSA9IG5vb3AsIG9uUGFnZUNoYW5nZSA9IG5vb3AsIG9uUHJldmlvdXNQYWdlID0gbm9vcCwgcGFnZSA9IDEsIHRvdGFsUGFnZXMsIC4uLnJlc3QgfSxcbiAgICByZWZcbiAgKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIDxQYW5lIGlzPVwibmF2XCIgcm9sZT1cIm5hdmlnYXRpb25cIiBhcmlhLWxhYmVsPVwiUGFnaW5hdGlvblwiIHsuLi5yZXN0fSByZWY9e3JlZn0+XG4gICAgICAgIDxQYW5lIGlzPVwidWxcIiBkaXNwbGF5PVwiZmxleFwiIGFsaWduSXRlbXM9XCJjZW50ZXJcIiBwYWRkaW5nPXswfT5cbiAgICAgICAgICA8UGFuZSBpcz1cImxpXCIgbGlzdFN0eWxlPVwibm9uZVwiPlxuICAgICAgICAgICAgPEljb25CdXR0b24gYXBwZWFyYW5jZT1cIm1pbmltYWxcIiBpY29uPXtDaGV2cm9uTGVmdEljb259IGRpc2FibGVkPXtwYWdlID09PSAxfSBvbkNsaWNrPXtvblByZXZpb3VzUGFnZX0gLz5cbiAgICAgICAgICA8L1BhbmU+XG4gICAgICAgICAge3RvdGFsUGFnZXNcbiAgICAgICAgICAgID8gZ2V0UGFnaW5hdGlvbkJ1dHRvbkNvbnRlbnQoeyB0b3RhbFBhZ2VzLCBwYWdlIH0pLm1hcCgodmFsLCBpKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgaXNTZWxlY3RlZCA9IHZhbCA9PT0gcGFnZVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICAgIDxQYW5lIGlzPVwibGlcIiBsaXN0U3R5bGU9XCJub25lXCIga2V5PXtgJHt2YWx9LSR7aX1gfT5cbiAgICAgICAgICAgICAgICAgICAgPFBhZ2luYXRpb25CdXR0b25cbiAgICAgICAgICAgICAgICAgICAgICBhcHBlYXJhbmNlPVwibWluaW1hbFwiXG4gICAgICAgICAgICAgICAgICAgICAgaXNTZWxlY3RlZD17aXNTZWxlY3RlZH1cbiAgICAgICAgICAgICAgICAgICAgICBwYWdlPXt2YWx9XG4gICAgICAgICAgICAgICAgICAgICAgb25QYWdlQ2hhbmdlPXtvblBhZ2VDaGFuZ2V9XG4gICAgICAgICAgICAgICAgICAgICAgbWFyZ2luWD17bWlub3JTY2FsZSgxKSAvIDJ9XG4gICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICB7dmFsfVxuICAgICAgICAgICAgICAgICAgICA8L1BhZ2luYXRpb25CdXR0b24+XG4gICAgICAgICAgICAgICAgICA8L1BhbmU+XG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgOiBudWxsfVxuICAgICAgICAgIDxQYW5lIGlzPVwibGlcIiBsaXN0U3R5bGU9XCJub25lXCI+XG4gICAgICAgICAgICA8SWNvbkJ1dHRvblxuICAgICAgICAgICAgICBhcHBlYXJhbmNlPVwibWluaW1hbFwiXG4gICAgICAgICAgICAgIGljb249e0NoZXZyb25SaWdodEljb259XG4gICAgICAgICAgICAgIGRpc2FibGVkPXt0b3RhbFBhZ2VzID8gcGFnZSA9PT0gdG90YWxQYWdlcyA6IHVuZGVmaW5lZH1cbiAgICAgICAgICAgICAgb25DbGljaz17b25OZXh0UGFnZX1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgPC9QYW5lPlxuICAgICAgICA8L1BhbmU+XG4gICAgICA8L1BhbmU+XG4gICAgKVxuICB9KVxuKVxuXG5QYWdpbmF0aW9uLnByb3BUeXBlcyA9IHtcbiAgLyoqXG4gICAqIFRoZSBjdXJyZW50IHBhZ2UgdGhhdCBhIHVzZXIgaXMgb24gLSBkZWZhdWx0cyB0byAxLlxuICAgKi9cbiAgcGFnZTogUHJvcFR5cGVzLm51bWJlci5pc1JlcXVpcmVkLFxuICAvKipcbiAgICogVGhlIHRvdGFsIG51bWJlciBvZiBwYWdlcyB0byByZW5kZXIuIElmIG9tbWl0dGVkLCB0aGUgcGFnZSBudW1iZXJzIHdpbGwgbm90IGJlIHNob3duIHRvIHRoZSBlbmQgdXNlci5cbiAgICovXG4gIHRvdGFsUGFnZXM6IFByb3BUeXBlcy5udW1iZXIsXG4gIC8qKlxuICAgKiBDYWxsYmFjayBoYW5kbGVyIHdoZW4gdGhlIG5leHQgcGFnZSBidXR0b24gaXMgY2xpY2tlZC5cbiAgICovXG4gIG9uTmV4dFBhZ2U6IFByb3BUeXBlcy5mdW5jLFxuICAvKipcbiAgICogQ2FsbGJhY2sgaGFuZGxlciB3aGVuIHRoZSBwcmV2aW91cyBwYWdlIGJ1dHRvbiBpcyBjbGlja2VkLlxuICAgKi9cbiAgb25QcmV2aW91c1BhZ2U6IFByb3BUeXBlcy5mdW5jLFxuICAvKipcbiAgICogQ2FsbGJhY2sgaGFuZGxlciB3aGVuIGEgc3BlY2lmaWMgcGFnZSAjIGlzIGNsaWNrZWRcbiAgICovXG4gIG9uUGFnZUNoYW5nZTogUHJvcFR5cGVzLmZ1bmNcbn1cblxuZXhwb3J0IGRlZmF1bHQgUGFnaW5hdGlvblxuIl19
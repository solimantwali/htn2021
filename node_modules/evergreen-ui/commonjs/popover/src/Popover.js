"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _typeof = require("@babel/runtime/helpers/typeof");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _react = _interopRequireWildcard(require("react"));

var _classnames = _interopRequireDefault(require("classnames"));

var _glamor = require("glamor");

var _propTypes = _interopRequireDefault(require("prop-types"));

var _constants = require("../../constants");

var _hooks = require("../../hooks");

var _positioner = require("../../positioner");

var _tooltip = require("../../tooltip");

var _PopoverStateless = _interopRequireDefault(require("./PopoverStateless"));

var _excluded = ["animationDuration", "bringFocusInside", "children", "content", "display", "minHeight", "minWidth", "onBodyClick", "onClose", "onCloseComplete", "onOpen", "onOpenComplete", "position", "shouldCloseOnExternalClick", "statelessProps", "trigger"];

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { "default": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj["default"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var noop = function noop() {};

var emptyProps = {};
var Popover = /*#__PURE__*/(0, _react.memo)( /*#__PURE__*/(0, _react.forwardRef)(function Popover(_ref, forwardedRef) {
  var _ref$animationDuratio = _ref.animationDuration,
      animationDuration = _ref$animationDuratio === void 0 ? 300 : _ref$animationDuratio,
      _ref$bringFocusInside = _ref.bringFocusInside,
      shouldBringFocusInside = _ref$bringFocusInside === void 0 ? false : _ref$bringFocusInside,
      children = _ref.children,
      content = _ref.content,
      display = _ref.display,
      _ref$minHeight = _ref.minHeight,
      minHeight = _ref$minHeight === void 0 ? 40 : _ref$minHeight,
      _ref$minWidth = _ref.minWidth,
      minWidth = _ref$minWidth === void 0 ? 200 : _ref$minWidth,
      _ref$onBodyClick = _ref.onBodyClick,
      onBodyClick = _ref$onBodyClick === void 0 ? noop : _ref$onBodyClick,
      _ref$onClose = _ref.onClose,
      onClose = _ref$onClose === void 0 ? noop : _ref$onClose,
      _ref$onCloseComplete = _ref.onCloseComplete,
      onCloseComplete = _ref$onCloseComplete === void 0 ? noop : _ref$onCloseComplete,
      _ref$onOpen = _ref.onOpen,
      onOpen = _ref$onOpen === void 0 ? noop : _ref$onOpen,
      _ref$onOpenComplete = _ref.onOpenComplete,
      onOpenComplete = _ref$onOpenComplete === void 0 ? noop : _ref$onOpenComplete,
      _ref$position = _ref.position,
      position = _ref$position === void 0 ? _constants.Position.BOTTOM : _ref$position,
      _ref$shouldCloseOnExt = _ref.shouldCloseOnExternalClick,
      shouldCloseOnExternalClick = _ref$shouldCloseOnExt === void 0 ? true : _ref$shouldCloseOnExt,
      _ref$statelessProps = _ref.statelessProps,
      statelessProps = _ref$statelessProps === void 0 ? emptyProps : _ref$statelessProps,
      _ref$trigger = _ref.trigger,
      trigger = _ref$trigger === void 0 ? 'click' : _ref$trigger,
      props = (0, _objectWithoutProperties2["default"])(_ref, _excluded);

  var _useState = (0, _react.useState)(props.isShown),
      _useState2 = (0, _slicedToArray2["default"])(_useState, 2),
      isShown = _useState2[0],
      setIsShown = _useState2[1];

  var popoverNode = (0, _react.useRef)();
  var setPopoverNode = (0, _hooks.useMergedRef)(popoverNode);
  var targetRef = (0, _react.useRef)();
  var setTargetRef = (0, _hooks.useMergedRef)(targetRef);
  (0, _react.useImperativeHandle)(forwardedRef, function () {
    return {
      open: open,
      close: close
    };
  }, [popoverNode.current]);
  /**
   * Methods borrowed from BlueprintJS
   * https://github.com/palantir/blueprint/blob/release/2.0.0/packages/core/src/components/overlay/overlay.tsx
   */

  var bringFocusInside = (0, _react.useCallback)(function (e) {
    if (isShown && e) {
      e.preventDefault();
    } // Always delay focus manipulation to just before repaint to prevent scroll jumping


    return requestAnimationFrame(function () {
      // Container ref may be undefined between component mounting and Portal rendering
      // ActiveElement may be undefined in some rare cases in IE
      if (popoverNode.current == null || // eslint-disable-line eqeqeq, no-eq-null
      document.activeElement == null || // eslint-disable-line eqeqeq, no-eq-null
      !isShown) {
        return;
      }

      var isFocusOutsideModal = !popoverNode.current.contains(document.activeElement);

      if (isFocusOutsideModal) {
        // Element marked autofocus has higher priority than the other elements
        var autofocusElement = popoverNode.current.querySelector('[autofocus]:not([disabled])');

        if (autofocusElement) {
          // Return early to avoid unnecessary dom queries
          return autofocusElement.focus();
        }

        var wrapperElement = popoverNode.current.querySelector('[tabindex]:not([disabled])');

        if (wrapperElement) {
          return wrapperElement.focus();
        }

        var buttonElements = popoverNode.current.querySelectorAll('button:not([disabled]), a:not([disabled]), [role="menuitem"]:not([disabled]), [role="menuitemradio"]:not([disabled])');

        if (buttonElements.length > 0) {
          return buttonElements[0].focus();
        }
      }
    });
  }, [isShown, popoverNode.current]);
  var bringFocusBackToTarget = (0, _react.useCallback)(function () {
    return requestAnimationFrame(function () {
      if (targetRef.current == null || // eslint-disable-line eqeqeq, no-eq-null
      popoverNode.current == null || // eslint-disable-line eqeqeq, no-eq-null
      document.activeElement == null // eslint-disable-line eqeqeq, no-eq-null
      ) {
        return;
      }

      var isFocusInsideModal = popoverNode.current.contains(document.activeElement); // Bring back focus on the target.

      if (document.activeElement === document.body || isFocusInsideModal) {
        targetRef.current.focus();
      }
    });
  }, [popoverNode.current, targetRef.current]);
  var open = (0, _react.useCallback)(function () {
    if (isShown) {
      return;
    }

    setIsShown(true);
    onOpen();
  }, [setIsShown, onOpen, isShown]);
  var close = (0, _react.useCallback)(function () {
    if (!isShown) {
      return;
    }

    setIsShown(false);
    bringFocusBackToTarget();
    onClose();
  }, [setIsShown, bringFocusBackToTarget, onClose, isShown]); // If `props.isShown` is a boolean, treat as a controlled component
  // `open` and `close` should be applied when it changes

  (0, _react.useEffect)(function () {
    if (typeof props.isShown !== 'boolean' || props.isShown === isShown) {
      return;
    }

    if (props.isShown) {
      open();
    } else {
      close();
    }
  }, [props.isShown, isShown]);
  var toggle = (0, _react.useCallback)(function () {
    return isShown ? close() : open();
  }, [isShown, close, open]);
  var handleOpenHover = (0, _react.useMemo)(function () {
    return trigger === 'hover' ? open : undefined;
  }, [trigger, open]);
  var handleCloseHover = (0, _react.useMemo)(function () {
    return trigger === 'hover' ? close : undefined;
  }, [trigger, close]);
  var handleKeyDown = (0, _react.useCallback)(function (event) {
    return event.key === 'ArrowDown' ? bringFocusInside(event) : undefined;
  }, [bringFocusInside]);
  var onEsc = (0, _react.useCallback)(function (event) {
    return event.key === 'Escape' ? close() : undefined;
  }, [close]);
  var handleBodyClick = (0, _react.useCallback)(function (event) {
    // Ignore clicks on the popover or button
    if (targetRef.current && targetRef.current.contains(event.target)) {
      return;
    }

    if (popoverNode.current && popoverNode.current.contains(event.target)) {
      return;
    } // Notify body click


    onBodyClick(event);

    if (shouldCloseOnExternalClick !== false) {
      close();
    }
  }, [onBodyClick, shouldCloseOnExternalClick, close, targetRef.current, popoverNode.current]);
  var handleOpenComplete = (0, _react.useCallback)(function () {
    if (shouldBringFocusInside) bringFocusInside();
    onOpenComplete();
  }, [shouldBringFocusInside, bringFocusInside, onOpenComplete]);
  (0, _react.useEffect)(function () {
    if (isShown) {
      document.body.addEventListener('click', handleBodyClick, false);
      document.body.addEventListener('keydown', onEsc, false);
    } else {
      document.body.removeEventListener('click', handleBodyClick, false);
      document.body.removeEventListener('keydown', onEsc, false);
    }

    return function () {
      document.body.removeEventListener('click', handleBodyClick, false);
      document.body.removeEventListener('keydown', onEsc, false);
    };
  }, [isShown, handleBodyClick, onEsc]);
  var renderTarget = (0, _react.useCallback)(function (_ref2) {
    var getRef = _ref2.getRef,
        isShown = _ref2.isShown;
    var isTooltipInside = children && children.type === _tooltip.Tooltip;

    var getTargetRef = function getTargetRef(ref) {
      setTargetRef(ref);
      getRef(ref);
    };
    /**
     * When a function is passed, you can control the Popover manually.
     */


    if (typeof children === 'function') {
      return children({
        getRef: getTargetRef,
        isShown: isShown,
        toggle: toggle
      });
    }

    var popoverTargetProps = {
      onClick: toggle,
      onMouseEnter: handleOpenHover,
      onKeyDown: handleKeyDown,
      role: 'button',
      'aria-expanded': isShown,
      'aria-haspopup': true
    };
    /**
     * Tooltips can be used within a Popover (not the other way around)
     * In this case the children is the Tooltip instead of a button.
     * Pass the properties to the Tooltip and let the Tooltip
     * add the properties to the target.
     */

    if (isTooltipInside) {
      return /*#__PURE__*/_react["default"].cloneElement(children, {
        popoverProps: _objectSpread({
          getTargetRef: getTargetRef,
          isShown: isShown
        }, popoverTargetProps)
      });
    }
    /**
     * With normal usage only popover props end up on the target.
     */


    return /*#__PURE__*/_react["default"].cloneElement(children, _objectSpread({
      ref: getTargetRef
    }, popoverTargetProps));
  }, [children, setTargetRef, toggle, handleOpenHover, handleKeyDown]); // If `props.isShown` is a boolean, popover is controlled manually, not via mouse events

  var shown = typeof props.isShown === 'boolean' ? props.isShown : isShown;
  var contentToRender = (0, _react.useMemo)(function () {
    return typeof content === 'function' ? content({
      close: close
    }) : content;
  }, [content, close]);
  return /*#__PURE__*/_react["default"].createElement(_positioner.Positioner, {
    target: renderTarget,
    isShown: shown,
    position: position,
    animationDuration: animationDuration,
    onOpenComplete: handleOpenComplete,
    onCloseComplete: onCloseComplete
  }, function (_ref3) {
    var css = _ref3.css,
        getRef = _ref3.getRef,
        state = _ref3.state,
        style = _ref3.style;
    return /*#__PURE__*/_react["default"].createElement(_PopoverStateless["default"], (0, _extends2["default"])({
      ref: function ref(_ref4) {
        setPopoverNode(_ref4);
        getRef(_ref4);
      },
      "data-state": state,
      display: display,
      minWidth: minWidth,
      minHeight: minHeight
    }, statelessProps, {
      className: (0, _classnames["default"])(statelessProps.className, (0, _glamor.css)(css, style, statelessProps.style).toString()) // Overwrite `statelessProps.style` since we are including it via className
      ,
      style: undefined,
      onMouseLeave: handleCloseHover
    }), contentToRender);
  });
}));
Popover.propTypes = {
  /**
   * The position the Popover is on. Smart positioning might override this.
   */
  position: _propTypes["default"].oneOf([_constants.Position.TOP, _constants.Position.TOP_LEFT, _constants.Position.TOP_RIGHT, _constants.Position.BOTTOM, _constants.Position.BOTTOM_LEFT, _constants.Position.BOTTOM_RIGHT, _constants.Position.LEFT, _constants.Position.RIGHT]),

  /**
   * When true, the Popover is manually shown.
   */
  isShown: _propTypes["default"].bool,

  /**
   * Open the Popover based on click or hover. Default is click.
   */
  trigger: _propTypes["default"].oneOf(['click', 'hover']),

  /**
   * The content of the Popover.
   */
  content: _propTypes["default"].oneOfType([_propTypes["default"].node, _propTypes["default"].func]).isRequired,

  /**
   * The target button of the Popover.
   * When a function the following arguments are passed:
   * ({ toggle: Function -> Void, getRef: Function -> Ref, isShown: Bool })
   */
  children: _propTypes["default"].oneOfType([_propTypes["default"].element, _propTypes["default"].func]).isRequired,

  /**
   * The display property passed to the Popover card.
   */
  display: _propTypes["default"].string,

  /**
   * The min width of the Popover card.
   */
  minWidth: _propTypes["default"].oneOfType([_propTypes["default"].number, _propTypes["default"].string]),

  /**
   * The min height of the Popover card.
   */
  minHeight: _propTypes["default"].oneOfType([_propTypes["default"].number, _propTypes["default"].string]),

  /**
   * Properties passed through to the Popover card.
   */
  statelessProps: _propTypes["default"].shape(_PopoverStateless["default"].propTypes),

  /**
   * Duration of the animation.
   */
  animationDuration: _propTypes["default"].number,

  /**
   * Function called when the Popover opens.
   */
  onOpen: _propTypes["default"].func,

  /**
   * Function fired when Popover closes.
   */
  onClose: _propTypes["default"].func,

  /**
   * Function that will be called when the enter transition is complete.
   */
  onOpenComplete: _propTypes["default"].func,

  /**
   * Function that will be called when the exit transition is complete.
   */
  onCloseComplete: _propTypes["default"].func,

  /**
   * Function that will be called when the body is clicked.
   */
  onBodyClick: _propTypes["default"].func,

  /**
   * When true, bring focus inside of the Popover on open.
   */
  bringFocusInside: _propTypes["default"].bool,

  /**
   * Boolean indicating if clicking outside the dialog should close the dialog.
   */
  shouldCloseOnExternalClick: _propTypes["default"].bool
};
var _default = Popover;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9wb3BvdmVyL3NyYy9Qb3BvdmVyLmpzIl0sIm5hbWVzIjpbIm5vb3AiLCJlbXB0eVByb3BzIiwiUG9wb3ZlciIsImZvcndhcmRlZFJlZiIsImFuaW1hdGlvbkR1cmF0aW9uIiwiYnJpbmdGb2N1c0luc2lkZSIsInNob3VsZEJyaW5nRm9jdXNJbnNpZGUiLCJjaGlsZHJlbiIsImNvbnRlbnQiLCJkaXNwbGF5IiwibWluSGVpZ2h0IiwibWluV2lkdGgiLCJvbkJvZHlDbGljayIsIm9uQ2xvc2UiLCJvbkNsb3NlQ29tcGxldGUiLCJvbk9wZW4iLCJvbk9wZW5Db21wbGV0ZSIsInBvc2l0aW9uIiwiUG9zaXRpb24iLCJCT1RUT00iLCJzaG91bGRDbG9zZU9uRXh0ZXJuYWxDbGljayIsInN0YXRlbGVzc1Byb3BzIiwidHJpZ2dlciIsInByb3BzIiwiaXNTaG93biIsInNldElzU2hvd24iLCJwb3BvdmVyTm9kZSIsInNldFBvcG92ZXJOb2RlIiwidGFyZ2V0UmVmIiwic2V0VGFyZ2V0UmVmIiwib3BlbiIsImNsb3NlIiwiY3VycmVudCIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImRvY3VtZW50IiwiYWN0aXZlRWxlbWVudCIsImlzRm9jdXNPdXRzaWRlTW9kYWwiLCJjb250YWlucyIsImF1dG9mb2N1c0VsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiZm9jdXMiLCJ3cmFwcGVyRWxlbWVudCIsImJ1dHRvbkVsZW1lbnRzIiwicXVlcnlTZWxlY3RvckFsbCIsImxlbmd0aCIsImJyaW5nRm9jdXNCYWNrVG9UYXJnZXQiLCJpc0ZvY3VzSW5zaWRlTW9kYWwiLCJib2R5IiwidG9nZ2xlIiwiaGFuZGxlT3BlbkhvdmVyIiwidW5kZWZpbmVkIiwiaGFuZGxlQ2xvc2VIb3ZlciIsImhhbmRsZUtleURvd24iLCJldmVudCIsImtleSIsIm9uRXNjIiwiaGFuZGxlQm9keUNsaWNrIiwidGFyZ2V0IiwiaGFuZGxlT3BlbkNvbXBsZXRlIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJyZW5kZXJUYXJnZXQiLCJnZXRSZWYiLCJpc1Rvb2x0aXBJbnNpZGUiLCJ0eXBlIiwiVG9vbHRpcCIsImdldFRhcmdldFJlZiIsInJlZiIsInBvcG92ZXJUYXJnZXRQcm9wcyIsIm9uQ2xpY2siLCJvbk1vdXNlRW50ZXIiLCJvbktleURvd24iLCJyb2xlIiwiUmVhY3QiLCJjbG9uZUVsZW1lbnQiLCJwb3BvdmVyUHJvcHMiLCJzaG93biIsImNvbnRlbnRUb1JlbmRlciIsImNzcyIsInN0YXRlIiwic3R5bGUiLCJjbGFzc05hbWUiLCJ0b1N0cmluZyIsInByb3BUeXBlcyIsIlByb3BUeXBlcyIsIm9uZU9mIiwiVE9QIiwiVE9QX0xFRlQiLCJUT1BfUklHSFQiLCJCT1RUT01fTEVGVCIsIkJPVFRPTV9SSUdIVCIsIkxFRlQiLCJSSUdIVCIsImJvb2wiLCJvbmVPZlR5cGUiLCJub2RlIiwiZnVuYyIsImlzUmVxdWlyZWQiLCJlbGVtZW50Iiwic3RyaW5nIiwibnVtYmVyIiwic2hhcGUiLCJQb3BvdmVyU3RhdGVsZXNzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7Ozs7OztBQUVBLElBQU1BLElBQUksR0FBRyxTQUFQQSxJQUFPLEdBQU0sQ0FBRSxDQUFyQjs7QUFDQSxJQUFNQyxVQUFVLEdBQUcsRUFBbkI7QUFFQSxJQUFNQyxPQUFPLGdCQUFHLCtCQUNkLHVCQUFXLFNBQVNBLE9BQVQsT0FvQlRDLFlBcEJTLEVBcUJUO0FBQUEsbUNBbkJFQyxpQkFtQkY7QUFBQSxNQW5CRUEsaUJBbUJGLHNDQW5Cc0IsR0FtQnRCO0FBQUEsbUNBbEJFQyxnQkFrQkY7QUFBQSxNQWxCb0JDLHNCQWtCcEIsc0NBbEI2QyxLQWtCN0M7QUFBQSxNQWpCRUMsUUFpQkYsUUFqQkVBLFFBaUJGO0FBQUEsTUFoQkVDLE9BZ0JGLFFBaEJFQSxPQWdCRjtBQUFBLE1BZkVDLE9BZUYsUUFmRUEsT0FlRjtBQUFBLDRCQWRFQyxTQWNGO0FBQUEsTUFkRUEsU0FjRiwrQkFkYyxFQWNkO0FBQUEsMkJBYkVDLFFBYUY7QUFBQSxNQWJFQSxRQWFGLDhCQWJhLEdBYWI7QUFBQSw4QkFaRUMsV0FZRjtBQUFBLE1BWkVBLFdBWUYsaUNBWmdCWixJQVloQjtBQUFBLDBCQVhFYSxPQVdGO0FBQUEsTUFYRUEsT0FXRiw2QkFYWWIsSUFXWjtBQUFBLGtDQVZFYyxlQVVGO0FBQUEsTUFWRUEsZUFVRixxQ0FWb0JkLElBVXBCO0FBQUEseUJBVEVlLE1BU0Y7QUFBQSxNQVRFQSxNQVNGLDRCQVRXZixJQVNYO0FBQUEsaUNBUkVnQixjQVFGO0FBQUEsTUFSRUEsY0FRRixvQ0FSbUJoQixJQVFuQjtBQUFBLDJCQVBFaUIsUUFPRjtBQUFBLE1BUEVBLFFBT0YsOEJBUGFDLG9CQUFTQyxNQU90QjtBQUFBLG1DQU5FQywwQkFNRjtBQUFBLE1BTkVBLDBCQU1GLHNDQU4rQixJQU0vQjtBQUFBLGlDQUxFQyxjQUtGO0FBQUEsTUFMRUEsY0FLRixvQ0FMbUJwQixVQUtuQjtBQUFBLDBCQUpFcUIsT0FJRjtBQUFBLE1BSkVBLE9BSUYsNkJBSlksT0FJWjtBQUFBLE1BSEtDLEtBR0w7O0FBQ0Esa0JBQThCLHFCQUFTQSxLQUFLLENBQUNDLE9BQWYsQ0FBOUI7QUFBQTtBQUFBLE1BQU9BLE9BQVA7QUFBQSxNQUFnQkMsVUFBaEI7O0FBQ0EsTUFBTUMsV0FBVyxHQUFHLG9CQUFwQjtBQUNBLE1BQU1DLGNBQWMsR0FBRyx5QkFBYUQsV0FBYixDQUF2QjtBQUNBLE1BQU1FLFNBQVMsR0FBRyxvQkFBbEI7QUFDQSxNQUFNQyxZQUFZLEdBQUcseUJBQWFELFNBQWIsQ0FBckI7QUFFQSxrQ0FDRXpCLFlBREYsRUFFRTtBQUFBLFdBQU87QUFDTDJCLE1BQUFBLElBQUksRUFBSkEsSUFESztBQUVMQyxNQUFBQSxLQUFLLEVBQUxBO0FBRkssS0FBUDtBQUFBLEdBRkYsRUFNRSxDQUFDTCxXQUFXLENBQUNNLE9BQWIsQ0FORjtBQVNBO0FBQ0o7QUFDQTtBQUNBOztBQUNJLE1BQU0zQixnQkFBZ0IsR0FBRyx3QkFDdkIsVUFBQTRCLENBQUMsRUFBSTtBQUNILFFBQUlULE9BQU8sSUFBSVMsQ0FBZixFQUFrQjtBQUNoQkEsTUFBQUEsQ0FBQyxDQUFDQyxjQUFGO0FBQ0QsS0FIRSxDQUlIOzs7QUFFQSxXQUFPQyxxQkFBcUIsQ0FBQyxZQUFNO0FBQ2pDO0FBRUE7QUFFQSxVQUNFVCxXQUFXLENBQUNNLE9BQVosSUFBdUIsSUFBdkIsSUFBK0I7QUFDL0JJLE1BQUFBLFFBQVEsQ0FBQ0MsYUFBVCxJQUEwQixJQUQxQixJQUNrQztBQUNsQyxPQUFDYixPQUhILEVBSUU7QUFDQTtBQUNEOztBQUVELFVBQU1jLG1CQUFtQixHQUFHLENBQUNaLFdBQVcsQ0FBQ00sT0FBWixDQUFvQk8sUUFBcEIsQ0FBNkJILFFBQVEsQ0FBQ0MsYUFBdEMsQ0FBN0I7O0FBQ0EsVUFBSUMsbUJBQUosRUFBeUI7QUFDdkI7QUFDQSxZQUFNRSxnQkFBZ0IsR0FBR2QsV0FBVyxDQUFDTSxPQUFaLENBQW9CUyxhQUFwQixDQUFrQyw2QkFBbEMsQ0FBekI7O0FBQ0EsWUFBSUQsZ0JBQUosRUFBc0I7QUFDcEI7QUFDQSxpQkFBT0EsZ0JBQWdCLENBQUNFLEtBQWpCLEVBQVA7QUFDRDs7QUFFRCxZQUFNQyxjQUFjLEdBQUdqQixXQUFXLENBQUNNLE9BQVosQ0FBb0JTLGFBQXBCLENBQWtDLDRCQUFsQyxDQUF2Qjs7QUFDQSxZQUFJRSxjQUFKLEVBQW9CO0FBQ2xCLGlCQUFPQSxjQUFjLENBQUNELEtBQWYsRUFBUDtBQUNEOztBQUVELFlBQU1FLGNBQWMsR0FBR2xCLFdBQVcsQ0FBQ00sT0FBWixDQUFvQmEsZ0JBQXBCLENBQ3JCLHNIQURxQixDQUF2Qjs7QUFHQSxZQUFJRCxjQUFjLENBQUNFLE1BQWYsR0FBd0IsQ0FBNUIsRUFBK0I7QUFDN0IsaUJBQU9GLGNBQWMsQ0FBQyxDQUFELENBQWQsQ0FBa0JGLEtBQWxCLEVBQVA7QUFDRDtBQUNGO0FBQ0YsS0FsQzJCLENBQTVCO0FBbUNELEdBMUNzQixFQTJDdkIsQ0FBQ2xCLE9BQUQsRUFBVUUsV0FBVyxDQUFDTSxPQUF0QixDQTNDdUIsQ0FBekI7QUE4Q0EsTUFBTWUsc0JBQXNCLEdBQUcsd0JBQVksWUFBTTtBQUMvQyxXQUFPWixxQkFBcUIsQ0FBQyxZQUFNO0FBQ2pDLFVBQ0VQLFNBQVMsQ0FBQ0ksT0FBVixJQUFxQixJQUFyQixJQUE2QjtBQUM3Qk4sTUFBQUEsV0FBVyxDQUFDTSxPQUFaLElBQXVCLElBRHZCLElBQytCO0FBQy9CSSxNQUFBQSxRQUFRLENBQUNDLGFBQVQsSUFBMEIsSUFINUIsQ0FHaUM7QUFIakMsUUFJRTtBQUNBO0FBQ0Q7O0FBRUQsVUFBTVcsa0JBQWtCLEdBQUd0QixXQUFXLENBQUNNLE9BQVosQ0FBb0JPLFFBQXBCLENBQTZCSCxRQUFRLENBQUNDLGFBQXRDLENBQTNCLENBVGlDLENBV2pDOztBQUNBLFVBQUlELFFBQVEsQ0FBQ0MsYUFBVCxLQUEyQkQsUUFBUSxDQUFDYSxJQUFwQyxJQUE0Q0Qsa0JBQWhELEVBQW9FO0FBQ2xFcEIsUUFBQUEsU0FBUyxDQUFDSSxPQUFWLENBQWtCVSxLQUFsQjtBQUNEO0FBQ0YsS0FmMkIsQ0FBNUI7QUFnQkQsR0FqQjhCLEVBaUI1QixDQUFDaEIsV0FBVyxDQUFDTSxPQUFiLEVBQXNCSixTQUFTLENBQUNJLE9BQWhDLENBakI0QixDQUEvQjtBQW1CQSxNQUFNRixJQUFJLEdBQUcsd0JBQVksWUFBTTtBQUM3QixRQUFJTixPQUFKLEVBQWE7QUFDWDtBQUNEOztBQUVEQyxJQUFBQSxVQUFVLENBQUMsSUFBRCxDQUFWO0FBQ0FWLElBQUFBLE1BQU07QUFDUCxHQVBZLEVBT1YsQ0FBQ1UsVUFBRCxFQUFhVixNQUFiLEVBQXFCUyxPQUFyQixDQVBVLENBQWI7QUFTQSxNQUFNTyxLQUFLLEdBQUcsd0JBQVksWUFBTTtBQUM5QixRQUFJLENBQUNQLE9BQUwsRUFBYztBQUNaO0FBQ0Q7O0FBRURDLElBQUFBLFVBQVUsQ0FBQyxLQUFELENBQVY7QUFDQXNCLElBQUFBLHNCQUFzQjtBQUN0QmxDLElBQUFBLE9BQU87QUFDUixHQVJhLEVBUVgsQ0FBQ1ksVUFBRCxFQUFhc0Isc0JBQWIsRUFBcUNsQyxPQUFyQyxFQUE4Q1csT0FBOUMsQ0FSVyxDQUFkLENBOUZBLENBd0dBO0FBQ0E7O0FBQ0Esd0JBQVUsWUFBTTtBQUNkLFFBQUksT0FBT0QsS0FBSyxDQUFDQyxPQUFiLEtBQXlCLFNBQXpCLElBQXNDRCxLQUFLLENBQUNDLE9BQU4sS0FBa0JBLE9BQTVELEVBQXFFO0FBQ25FO0FBQ0Q7O0FBRUQsUUFBSUQsS0FBSyxDQUFDQyxPQUFWLEVBQW1CO0FBQ2pCTSxNQUFBQSxJQUFJO0FBQ0wsS0FGRCxNQUVPO0FBQ0xDLE1BQUFBLEtBQUs7QUFDTjtBQUNGLEdBVkQsRUFVRyxDQUFDUixLQUFLLENBQUNDLE9BQVAsRUFBZ0JBLE9BQWhCLENBVkg7QUFZQSxNQUFNMEIsTUFBTSxHQUFHLHdCQUFZLFlBQU07QUFDL0IsV0FBTzFCLE9BQU8sR0FBR08sS0FBSyxFQUFSLEdBQWFELElBQUksRUFBL0I7QUFDRCxHQUZjLEVBRVosQ0FBQ04sT0FBRCxFQUFVTyxLQUFWLEVBQWlCRCxJQUFqQixDQUZZLENBQWY7QUFJQSxNQUFNcUIsZUFBZSxHQUFHLG9CQUFRLFlBQU07QUFDcEMsV0FBTzdCLE9BQU8sS0FBSyxPQUFaLEdBQXNCUSxJQUF0QixHQUE2QnNCLFNBQXBDO0FBQ0QsR0FGdUIsRUFFckIsQ0FBQzlCLE9BQUQsRUFBVVEsSUFBVixDQUZxQixDQUF4QjtBQUlBLE1BQU11QixnQkFBZ0IsR0FBRyxvQkFBUSxZQUFNO0FBQ3JDLFdBQU8vQixPQUFPLEtBQUssT0FBWixHQUFzQlMsS0FBdEIsR0FBOEJxQixTQUFyQztBQUNELEdBRndCLEVBRXRCLENBQUM5QixPQUFELEVBQVVTLEtBQVYsQ0FGc0IsQ0FBekI7QUFJQSxNQUFNdUIsYUFBYSxHQUFHLHdCQUNwQixVQUFBQyxLQUFLLEVBQUk7QUFDUCxXQUFPQSxLQUFLLENBQUNDLEdBQU4sS0FBYyxXQUFkLEdBQTRCbkQsZ0JBQWdCLENBQUNrRCxLQUFELENBQTVDLEdBQXNESCxTQUE3RDtBQUNELEdBSG1CLEVBSXBCLENBQUMvQyxnQkFBRCxDQUpvQixDQUF0QjtBQU9BLE1BQU1vRCxLQUFLLEdBQUcsd0JBQ1osVUFBQUYsS0FBSyxFQUFJO0FBQ1AsV0FBT0EsS0FBSyxDQUFDQyxHQUFOLEtBQWMsUUFBZCxHQUF5QnpCLEtBQUssRUFBOUIsR0FBbUNxQixTQUExQztBQUNELEdBSFcsRUFJWixDQUFDckIsS0FBRCxDQUpZLENBQWQ7QUFPQSxNQUFNMkIsZUFBZSxHQUFHLHdCQUN0QixVQUFBSCxLQUFLLEVBQUk7QUFDUDtBQUNBLFFBQUkzQixTQUFTLENBQUNJLE9BQVYsSUFBcUJKLFNBQVMsQ0FBQ0ksT0FBVixDQUFrQk8sUUFBbEIsQ0FBMkJnQixLQUFLLENBQUNJLE1BQWpDLENBQXpCLEVBQW1FO0FBQ2pFO0FBQ0Q7O0FBRUQsUUFBSWpDLFdBQVcsQ0FBQ00sT0FBWixJQUF1Qk4sV0FBVyxDQUFDTSxPQUFaLENBQW9CTyxRQUFwQixDQUE2QmdCLEtBQUssQ0FBQ0ksTUFBbkMsQ0FBM0IsRUFBdUU7QUFDckU7QUFDRCxLQVJNLENBVVA7OztBQUNBL0MsSUFBQUEsV0FBVyxDQUFDMkMsS0FBRCxDQUFYOztBQUVBLFFBQUluQywwQkFBMEIsS0FBSyxLQUFuQyxFQUEwQztBQUN4Q1csTUFBQUEsS0FBSztBQUNOO0FBQ0YsR0FqQnFCLEVBa0J0QixDQUFDbkIsV0FBRCxFQUFjUSwwQkFBZCxFQUEwQ1csS0FBMUMsRUFBaURILFNBQVMsQ0FBQ0ksT0FBM0QsRUFBb0VOLFdBQVcsQ0FBQ00sT0FBaEYsQ0FsQnNCLENBQXhCO0FBcUJBLE1BQU00QixrQkFBa0IsR0FBRyx3QkFBWSxZQUFNO0FBQzNDLFFBQUl0RCxzQkFBSixFQUE0QkQsZ0JBQWdCO0FBQzVDVyxJQUFBQSxjQUFjO0FBQ2YsR0FIMEIsRUFHeEIsQ0FBQ1Ysc0JBQUQsRUFBeUJELGdCQUF6QixFQUEyQ1csY0FBM0MsQ0FId0IsQ0FBM0I7QUFLQSx3QkFBVSxZQUFNO0FBQ2QsUUFBSVEsT0FBSixFQUFhO0FBQ1hZLE1BQUFBLFFBQVEsQ0FBQ2EsSUFBVCxDQUFjWSxnQkFBZCxDQUErQixPQUEvQixFQUF3Q0gsZUFBeEMsRUFBeUQsS0FBekQ7QUFDQXRCLE1BQUFBLFFBQVEsQ0FBQ2EsSUFBVCxDQUFjWSxnQkFBZCxDQUErQixTQUEvQixFQUEwQ0osS0FBMUMsRUFBaUQsS0FBakQ7QUFDRCxLQUhELE1BR087QUFDTHJCLE1BQUFBLFFBQVEsQ0FBQ2EsSUFBVCxDQUFjYSxtQkFBZCxDQUFrQyxPQUFsQyxFQUEyQ0osZUFBM0MsRUFBNEQsS0FBNUQ7QUFDQXRCLE1BQUFBLFFBQVEsQ0FBQ2EsSUFBVCxDQUFjYSxtQkFBZCxDQUFrQyxTQUFsQyxFQUE2Q0wsS0FBN0MsRUFBb0QsS0FBcEQ7QUFDRDs7QUFFRCxXQUFPLFlBQU07QUFDWHJCLE1BQUFBLFFBQVEsQ0FBQ2EsSUFBVCxDQUFjYSxtQkFBZCxDQUFrQyxPQUFsQyxFQUEyQ0osZUFBM0MsRUFBNEQsS0FBNUQ7QUFDQXRCLE1BQUFBLFFBQVEsQ0FBQ2EsSUFBVCxDQUFjYSxtQkFBZCxDQUFrQyxTQUFsQyxFQUE2Q0wsS0FBN0MsRUFBb0QsS0FBcEQ7QUFDRCxLQUhEO0FBSUQsR0FiRCxFQWFHLENBQUNqQyxPQUFELEVBQVVrQyxlQUFWLEVBQTJCRCxLQUEzQixDQWJIO0FBZUEsTUFBTU0sWUFBWSxHQUFHLHdCQUNuQixpQkFBeUI7QUFBQSxRQUF0QkMsTUFBc0IsU0FBdEJBLE1BQXNCO0FBQUEsUUFBZHhDLE9BQWMsU0FBZEEsT0FBYztBQUN2QixRQUFNeUMsZUFBZSxHQUFHMUQsUUFBUSxJQUFJQSxRQUFRLENBQUMyRCxJQUFULEtBQWtCQyxnQkFBdEQ7O0FBRUEsUUFBTUMsWUFBWSxHQUFHLFNBQWZBLFlBQWUsQ0FBQUMsR0FBRyxFQUFJO0FBQzFCeEMsTUFBQUEsWUFBWSxDQUFDd0MsR0FBRCxDQUFaO0FBQ0FMLE1BQUFBLE1BQU0sQ0FBQ0ssR0FBRCxDQUFOO0FBQ0QsS0FIRDtBQUtBO0FBQ1I7QUFDQTs7O0FBQ1EsUUFBSSxPQUFPOUQsUUFBUCxLQUFvQixVQUF4QixFQUFvQztBQUNsQyxhQUFPQSxRQUFRLENBQUM7QUFDZHlELFFBQUFBLE1BQU0sRUFBRUksWUFETTtBQUVkNUMsUUFBQUEsT0FBTyxFQUFQQSxPQUZjO0FBR2QwQixRQUFBQSxNQUFNLEVBQU5BO0FBSGMsT0FBRCxDQUFmO0FBS0Q7O0FBRUQsUUFBTW9CLGtCQUFrQixHQUFHO0FBQ3pCQyxNQUFBQSxPQUFPLEVBQUVyQixNQURnQjtBQUV6QnNCLE1BQUFBLFlBQVksRUFBRXJCLGVBRlc7QUFHekJzQixNQUFBQSxTQUFTLEVBQUVuQixhQUhjO0FBSXpCb0IsTUFBQUEsSUFBSSxFQUFFLFFBSm1CO0FBS3pCLHVCQUFpQmxELE9BTFE7QUFNekIsdUJBQWlCO0FBTlEsS0FBM0I7QUFTQTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBQ1EsUUFBSXlDLGVBQUosRUFBcUI7QUFDbkIsMEJBQU9VLGtCQUFNQyxZQUFOLENBQW1CckUsUUFBbkIsRUFBNkI7QUFDbENzRSxRQUFBQSxZQUFZO0FBQ1ZULFVBQUFBLFlBQVksRUFBWkEsWUFEVTtBQUVWNUMsVUFBQUEsT0FBTyxFQUFQQTtBQUZVLFdBTVA4QyxrQkFOTztBQURzQixPQUE3QixDQUFQO0FBVUQ7QUFFRDtBQUNSO0FBQ0E7OztBQUNRLHdCQUFPSyxrQkFBTUMsWUFBTixDQUFtQnJFLFFBQW5CO0FBQ0w4RCxNQUFBQSxHQUFHLEVBQUVEO0FBREEsT0FFRkUsa0JBRkUsRUFBUDtBQUlELEdBdkRrQixFQXdEbkIsQ0FBQy9ELFFBQUQsRUFBV3NCLFlBQVgsRUFBeUJxQixNQUF6QixFQUFpQ0MsZUFBakMsRUFBa0RHLGFBQWxELENBeERtQixDQUFyQixDQXpMQSxDQW9QQTs7QUFDQSxNQUFNd0IsS0FBSyxHQUFHLE9BQU92RCxLQUFLLENBQUNDLE9BQWIsS0FBeUIsU0FBekIsR0FBcUNELEtBQUssQ0FBQ0MsT0FBM0MsR0FBcURBLE9BQW5FO0FBRUEsTUFBTXVELGVBQWUsR0FBRyxvQkFBUSxZQUFNO0FBQ3BDLFdBQU8sT0FBT3ZFLE9BQVAsS0FBbUIsVUFBbkIsR0FBZ0NBLE9BQU8sQ0FBQztBQUFFdUIsTUFBQUEsS0FBSyxFQUFMQTtBQUFGLEtBQUQsQ0FBdkMsR0FBcUR2QixPQUE1RDtBQUNELEdBRnVCLEVBRXJCLENBQUNBLE9BQUQsRUFBVXVCLEtBQVYsQ0FGcUIsQ0FBeEI7QUFJQSxzQkFDRSxnQ0FBQyxzQkFBRDtBQUNFLElBQUEsTUFBTSxFQUFFZ0MsWUFEVjtBQUVFLElBQUEsT0FBTyxFQUFFZSxLQUZYO0FBR0UsSUFBQSxRQUFRLEVBQUU3RCxRQUhaO0FBSUUsSUFBQSxpQkFBaUIsRUFBRWIsaUJBSnJCO0FBS0UsSUFBQSxjQUFjLEVBQUV3RCxrQkFMbEI7QUFNRSxJQUFBLGVBQWUsRUFBRTlDO0FBTm5CLEtBUUc7QUFBQSxRQUFHa0UsR0FBSCxTQUFHQSxHQUFIO0FBQUEsUUFBUWhCLE1BQVIsU0FBUUEsTUFBUjtBQUFBLFFBQWdCaUIsS0FBaEIsU0FBZ0JBLEtBQWhCO0FBQUEsUUFBdUJDLEtBQXZCLFNBQXVCQSxLQUF2QjtBQUFBLHdCQUNDLGdDQUFDLDRCQUFEO0FBQ0UsTUFBQSxHQUFHLEVBQUUsYUFBQWIsS0FBRyxFQUFJO0FBQ1YxQyxRQUFBQSxjQUFjLENBQUMwQyxLQUFELENBQWQ7QUFDQUwsUUFBQUEsTUFBTSxDQUFDSyxLQUFELENBQU47QUFDRCxPQUpIO0FBS0Usb0JBQVlZLEtBTGQ7QUFNRSxNQUFBLE9BQU8sRUFBRXhFLE9BTlg7QUFPRSxNQUFBLFFBQVEsRUFBRUUsUUFQWjtBQVFFLE1BQUEsU0FBUyxFQUFFRDtBQVJiLE9BU01XLGNBVE47QUFVRSxNQUFBLFNBQVMsRUFBRSw0QkFBR0EsY0FBYyxDQUFDOEQsU0FBbEIsRUFBNkIsaUJBQVVILEdBQVYsRUFBZUUsS0FBZixFQUFzQjdELGNBQWMsQ0FBQzZELEtBQXJDLEVBQTRDRSxRQUE1QyxFQUE3QixDQVZiLENBV0U7QUFYRjtBQVlFLE1BQUEsS0FBSyxFQUFFaEMsU0FaVDtBQWFFLE1BQUEsWUFBWSxFQUFFQztBQWJoQixRQWVHMEIsZUFmSCxDQUREO0FBQUEsR0FSSCxDQURGO0FBOEJELENBOVNELENBRGMsQ0FBaEI7QUFrVEE3RSxPQUFPLENBQUNtRixTQUFSLEdBQW9CO0FBQ2xCO0FBQ0Y7QUFDQTtBQUNFcEUsRUFBQUEsUUFBUSxFQUFFcUUsc0JBQVVDLEtBQVYsQ0FBZ0IsQ0FDeEJyRSxvQkFBU3NFLEdBRGUsRUFFeEJ0RSxvQkFBU3VFLFFBRmUsRUFHeEJ2RSxvQkFBU3dFLFNBSGUsRUFJeEJ4RSxvQkFBU0MsTUFKZSxFQUt4QkQsb0JBQVN5RSxXQUxlLEVBTXhCekUsb0JBQVMwRSxZQU5lLEVBT3hCMUUsb0JBQVMyRSxJQVBlLEVBUXhCM0Usb0JBQVM0RSxLQVJlLENBQWhCLENBSlE7O0FBZWxCO0FBQ0Y7QUFDQTtBQUNFdEUsRUFBQUEsT0FBTyxFQUFFOEQsc0JBQVVTLElBbEJEOztBQW1CbEI7QUFDRjtBQUNBO0FBQ0V6RSxFQUFBQSxPQUFPLEVBQUVnRSxzQkFBVUMsS0FBVixDQUFnQixDQUFDLE9BQUQsRUFBVSxPQUFWLENBQWhCLENBdEJTOztBQXdCbEI7QUFDRjtBQUNBO0FBQ0UvRSxFQUFBQSxPQUFPLEVBQUU4RSxzQkFBVVUsU0FBVixDQUFvQixDQUFDVixzQkFBVVcsSUFBWCxFQUFpQlgsc0JBQVVZLElBQTNCLENBQXBCLEVBQXNEQyxVQTNCN0M7O0FBNkJsQjtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0U1RixFQUFBQSxRQUFRLEVBQUUrRSxzQkFBVVUsU0FBVixDQUFvQixDQUFDVixzQkFBVWMsT0FBWCxFQUFvQmQsc0JBQVVZLElBQTlCLENBQXBCLEVBQXlEQyxVQWxDakQ7O0FBb0NsQjtBQUNGO0FBQ0E7QUFDRTFGLEVBQUFBLE9BQU8sRUFBRTZFLHNCQUFVZSxNQXZDRDs7QUF5Q2xCO0FBQ0Y7QUFDQTtBQUNFMUYsRUFBQUEsUUFBUSxFQUFFMkUsc0JBQVVVLFNBQVYsQ0FBb0IsQ0FBQ1Ysc0JBQVVnQixNQUFYLEVBQW1CaEIsc0JBQVVlLE1BQTdCLENBQXBCLENBNUNROztBQThDbEI7QUFDRjtBQUNBO0FBQ0UzRixFQUFBQSxTQUFTLEVBQUU0RSxzQkFBVVUsU0FBVixDQUFvQixDQUFDVixzQkFBVWdCLE1BQVgsRUFBbUJoQixzQkFBVWUsTUFBN0IsQ0FBcEIsQ0FqRE87O0FBbURsQjtBQUNGO0FBQ0E7QUFDRWhGLEVBQUFBLGNBQWMsRUFBRWlFLHNCQUFVaUIsS0FBVixDQUFnQkMsNkJBQWlCbkIsU0FBakMsQ0F0REU7O0FBd0RsQjtBQUNGO0FBQ0E7QUFDRWpGLEVBQUFBLGlCQUFpQixFQUFFa0Ysc0JBQVVnQixNQTNEWDs7QUE2RGxCO0FBQ0Y7QUFDQTtBQUNFdkYsRUFBQUEsTUFBTSxFQUFFdUUsc0JBQVVZLElBaEVBOztBQWtFbEI7QUFDRjtBQUNBO0FBQ0VyRixFQUFBQSxPQUFPLEVBQUV5RSxzQkFBVVksSUFyRUQ7O0FBdUVsQjtBQUNGO0FBQ0E7QUFDRWxGLEVBQUFBLGNBQWMsRUFBRXNFLHNCQUFVWSxJQTFFUjs7QUE0RWxCO0FBQ0Y7QUFDQTtBQUNFcEYsRUFBQUEsZUFBZSxFQUFFd0Usc0JBQVVZLElBL0VUOztBQWlGbEI7QUFDRjtBQUNBO0FBQ0V0RixFQUFBQSxXQUFXLEVBQUUwRSxzQkFBVVksSUFwRkw7O0FBc0ZsQjtBQUNGO0FBQ0E7QUFDRTdGLEVBQUFBLGdCQUFnQixFQUFFaUYsc0JBQVVTLElBekZWOztBQTJGbEI7QUFDRjtBQUNBO0FBQ0UzRSxFQUFBQSwwQkFBMEIsRUFBRWtFLHNCQUFVUztBQTlGcEIsQ0FBcEI7ZUFpR2U3RixPIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IG1lbW8sIGZvcndhcmRSZWYsIHVzZVJlZiwgdXNlU3RhdGUsIHVzZUVmZmVjdCwgdXNlSW1wZXJhdGl2ZUhhbmRsZSwgdXNlQ2FsbGJhY2ssIHVzZU1lbW8gfSBmcm9tICdyZWFjdCdcbmltcG9ydCBjeCBmcm9tICdjbGFzc25hbWVzJ1xuaW1wb3J0IHsgY3NzIGFzIGdsYW1vckNzcyB9IGZyb20gJ2dsYW1vcidcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcydcbmltcG9ydCB7IFBvc2l0aW9uIH0gZnJvbSAnLi4vLi4vY29uc3RhbnRzJ1xuaW1wb3J0IHsgdXNlTWVyZ2VkUmVmIH0gZnJvbSAnLi4vLi4vaG9va3MnXG5pbXBvcnQgeyBQb3NpdGlvbmVyIH0gZnJvbSAnLi4vLi4vcG9zaXRpb25lcidcbmltcG9ydCB7IFRvb2x0aXAgfSBmcm9tICcuLi8uLi90b29sdGlwJ1xuaW1wb3J0IFBvcG92ZXJTdGF0ZWxlc3MgZnJvbSAnLi9Qb3BvdmVyU3RhdGVsZXNzJ1xuXG5jb25zdCBub29wID0gKCkgPT4ge31cbmNvbnN0IGVtcHR5UHJvcHMgPSB7fVxuXG5jb25zdCBQb3BvdmVyID0gbWVtbyhcbiAgZm9yd2FyZFJlZihmdW5jdGlvbiBQb3BvdmVyKFxuICAgIHtcbiAgICAgIGFuaW1hdGlvbkR1cmF0aW9uID0gMzAwLFxuICAgICAgYnJpbmdGb2N1c0luc2lkZTogc2hvdWxkQnJpbmdGb2N1c0luc2lkZSA9IGZhbHNlLFxuICAgICAgY2hpbGRyZW4sXG4gICAgICBjb250ZW50LFxuICAgICAgZGlzcGxheSxcbiAgICAgIG1pbkhlaWdodCA9IDQwLFxuICAgICAgbWluV2lkdGggPSAyMDAsXG4gICAgICBvbkJvZHlDbGljayA9IG5vb3AsXG4gICAgICBvbkNsb3NlID0gbm9vcCxcbiAgICAgIG9uQ2xvc2VDb21wbGV0ZSA9IG5vb3AsXG4gICAgICBvbk9wZW4gPSBub29wLFxuICAgICAgb25PcGVuQ29tcGxldGUgPSBub29wLFxuICAgICAgcG9zaXRpb24gPSBQb3NpdGlvbi5CT1RUT00sXG4gICAgICBzaG91bGRDbG9zZU9uRXh0ZXJuYWxDbGljayA9IHRydWUsXG4gICAgICBzdGF0ZWxlc3NQcm9wcyA9IGVtcHR5UHJvcHMsXG4gICAgICB0cmlnZ2VyID0gJ2NsaWNrJyxcbiAgICAgIC4uLnByb3BzXG4gICAgfSxcbiAgICBmb3J3YXJkZWRSZWZcbiAgKSB7XG4gICAgY29uc3QgW2lzU2hvd24sIHNldElzU2hvd25dID0gdXNlU3RhdGUocHJvcHMuaXNTaG93bilcbiAgICBjb25zdCBwb3BvdmVyTm9kZSA9IHVzZVJlZigpXG4gICAgY29uc3Qgc2V0UG9wb3Zlck5vZGUgPSB1c2VNZXJnZWRSZWYocG9wb3Zlck5vZGUpXG4gICAgY29uc3QgdGFyZ2V0UmVmID0gdXNlUmVmKClcbiAgICBjb25zdCBzZXRUYXJnZXRSZWYgPSB1c2VNZXJnZWRSZWYodGFyZ2V0UmVmKVxuXG4gICAgdXNlSW1wZXJhdGl2ZUhhbmRsZShcbiAgICAgIGZvcndhcmRlZFJlZixcbiAgICAgICgpID0+ICh7XG4gICAgICAgIG9wZW4sXG4gICAgICAgIGNsb3NlXG4gICAgICB9KSxcbiAgICAgIFtwb3BvdmVyTm9kZS5jdXJyZW50XVxuICAgIClcblxuICAgIC8qKlxuICAgICAqIE1ldGhvZHMgYm9ycm93ZWQgZnJvbSBCbHVlcHJpbnRKU1xuICAgICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9wYWxhbnRpci9ibHVlcHJpbnQvYmxvYi9yZWxlYXNlLzIuMC4wL3BhY2thZ2VzL2NvcmUvc3JjL2NvbXBvbmVudHMvb3ZlcmxheS9vdmVybGF5LnRzeFxuICAgICAqL1xuICAgIGNvbnN0IGJyaW5nRm9jdXNJbnNpZGUgPSB1c2VDYWxsYmFjayhcbiAgICAgIGUgPT4ge1xuICAgICAgICBpZiAoaXNTaG93biAmJiBlKSB7XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgIH1cbiAgICAgICAgLy8gQWx3YXlzIGRlbGF5IGZvY3VzIG1hbmlwdWxhdGlvbiB0byBqdXN0IGJlZm9yZSByZXBhaW50IHRvIHByZXZlbnQgc2Nyb2xsIGp1bXBpbmdcblxuICAgICAgICByZXR1cm4gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHtcbiAgICAgICAgICAvLyBDb250YWluZXIgcmVmIG1heSBiZSB1bmRlZmluZWQgYmV0d2VlbiBjb21wb25lbnQgbW91bnRpbmcgYW5kIFBvcnRhbCByZW5kZXJpbmdcblxuICAgICAgICAgIC8vIEFjdGl2ZUVsZW1lbnQgbWF5IGJlIHVuZGVmaW5lZCBpbiBzb21lIHJhcmUgY2FzZXMgaW4gSUVcblxuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgIHBvcG92ZXJOb2RlLmN1cnJlbnQgPT0gbnVsbCB8fCAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGVxZXFlcSwgbm8tZXEtbnVsbFxuICAgICAgICAgICAgZG9jdW1lbnQuYWN0aXZlRWxlbWVudCA9PSBudWxsIHx8IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgZXFlcWVxLCBuby1lcS1udWxsXG4gICAgICAgICAgICAhaXNTaG93blxuICAgICAgICAgICkge1xuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29uc3QgaXNGb2N1c091dHNpZGVNb2RhbCA9ICFwb3BvdmVyTm9kZS5jdXJyZW50LmNvbnRhaW5zKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpXG4gICAgICAgICAgaWYgKGlzRm9jdXNPdXRzaWRlTW9kYWwpIHtcbiAgICAgICAgICAgIC8vIEVsZW1lbnQgbWFya2VkIGF1dG9mb2N1cyBoYXMgaGlnaGVyIHByaW9yaXR5IHRoYW4gdGhlIG90aGVyIGVsZW1lbnRzXG4gICAgICAgICAgICBjb25zdCBhdXRvZm9jdXNFbGVtZW50ID0gcG9wb3Zlck5vZGUuY3VycmVudC5xdWVyeVNlbGVjdG9yKCdbYXV0b2ZvY3VzXTpub3QoW2Rpc2FibGVkXSknKVxuICAgICAgICAgICAgaWYgKGF1dG9mb2N1c0VsZW1lbnQpIHtcbiAgICAgICAgICAgICAgLy8gUmV0dXJuIGVhcmx5IHRvIGF2b2lkIHVubmVjZXNzYXJ5IGRvbSBxdWVyaWVzXG4gICAgICAgICAgICAgIHJldHVybiBhdXRvZm9jdXNFbGVtZW50LmZvY3VzKClcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3Qgd3JhcHBlckVsZW1lbnQgPSBwb3BvdmVyTm9kZS5jdXJyZW50LnF1ZXJ5U2VsZWN0b3IoJ1t0YWJpbmRleF06bm90KFtkaXNhYmxlZF0pJylcbiAgICAgICAgICAgIGlmICh3cmFwcGVyRWxlbWVudCkge1xuICAgICAgICAgICAgICByZXR1cm4gd3JhcHBlckVsZW1lbnQuZm9jdXMoKVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBidXR0b25FbGVtZW50cyA9IHBvcG92ZXJOb2RlLmN1cnJlbnQucXVlcnlTZWxlY3RvckFsbChcbiAgICAgICAgICAgICAgJ2J1dHRvbjpub3QoW2Rpc2FibGVkXSksIGE6bm90KFtkaXNhYmxlZF0pLCBbcm9sZT1cIm1lbnVpdGVtXCJdOm5vdChbZGlzYWJsZWRdKSwgW3JvbGU9XCJtZW51aXRlbXJhZGlvXCJdOm5vdChbZGlzYWJsZWRdKSdcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIGlmIChidXR0b25FbGVtZW50cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgIHJldHVybiBidXR0b25FbGVtZW50c1swXS5mb2N1cygpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgfSxcbiAgICAgIFtpc1Nob3duLCBwb3BvdmVyTm9kZS5jdXJyZW50XVxuICAgIClcblxuICAgIGNvbnN0IGJyaW5nRm9jdXNCYWNrVG9UYXJnZXQgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgICByZXR1cm4gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIHRhcmdldFJlZi5jdXJyZW50ID09IG51bGwgfHwgLy8gZXNsaW50LWRpc2FibGUtbGluZSBlcWVxZXEsIG5vLWVxLW51bGxcbiAgICAgICAgICBwb3BvdmVyTm9kZS5jdXJyZW50ID09IG51bGwgfHwgLy8gZXNsaW50LWRpc2FibGUtbGluZSBlcWVxZXEsIG5vLWVxLW51bGxcbiAgICAgICAgICBkb2N1bWVudC5hY3RpdmVFbGVtZW50ID09IG51bGwgLy8gZXNsaW50LWRpc2FibGUtbGluZSBlcWVxZXEsIG5vLWVxLW51bGxcbiAgICAgICAgKSB7XG4gICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBpc0ZvY3VzSW5zaWRlTW9kYWwgPSBwb3BvdmVyTm9kZS5jdXJyZW50LmNvbnRhaW5zKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpXG5cbiAgICAgICAgLy8gQnJpbmcgYmFjayBmb2N1cyBvbiB0aGUgdGFyZ2V0LlxuICAgICAgICBpZiAoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCA9PT0gZG9jdW1lbnQuYm9keSB8fCBpc0ZvY3VzSW5zaWRlTW9kYWwpIHtcbiAgICAgICAgICB0YXJnZXRSZWYuY3VycmVudC5mb2N1cygpXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSwgW3BvcG92ZXJOb2RlLmN1cnJlbnQsIHRhcmdldFJlZi5jdXJyZW50XSlcblxuICAgIGNvbnN0IG9wZW4gPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgICBpZiAoaXNTaG93bikge1xuICAgICAgICByZXR1cm5cbiAgICAgIH1cblxuICAgICAgc2V0SXNTaG93bih0cnVlKVxuICAgICAgb25PcGVuKClcbiAgICB9LCBbc2V0SXNTaG93biwgb25PcGVuLCBpc1Nob3duXSlcblxuICAgIGNvbnN0IGNsb3NlID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgaWYgKCFpc1Nob3duKSB7XG4gICAgICAgIHJldHVyblxuICAgICAgfVxuXG4gICAgICBzZXRJc1Nob3duKGZhbHNlKVxuICAgICAgYnJpbmdGb2N1c0JhY2tUb1RhcmdldCgpXG4gICAgICBvbkNsb3NlKClcbiAgICB9LCBbc2V0SXNTaG93biwgYnJpbmdGb2N1c0JhY2tUb1RhcmdldCwgb25DbG9zZSwgaXNTaG93bl0pXG5cbiAgICAvLyBJZiBgcHJvcHMuaXNTaG93bmAgaXMgYSBib29sZWFuLCB0cmVhdCBhcyBhIGNvbnRyb2xsZWQgY29tcG9uZW50XG4gICAgLy8gYG9wZW5gIGFuZCBgY2xvc2VgIHNob3VsZCBiZSBhcHBsaWVkIHdoZW4gaXQgY2hhbmdlc1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICBpZiAodHlwZW9mIHByb3BzLmlzU2hvd24gIT09ICdib29sZWFuJyB8fCBwcm9wcy5pc1Nob3duID09PSBpc1Nob3duKSB7XG4gICAgICAgIHJldHVyblxuICAgICAgfVxuXG4gICAgICBpZiAocHJvcHMuaXNTaG93bikge1xuICAgICAgICBvcGVuKClcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNsb3NlKClcbiAgICAgIH1cbiAgICB9LCBbcHJvcHMuaXNTaG93biwgaXNTaG93bl0pXG5cbiAgICBjb25zdCB0b2dnbGUgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgICByZXR1cm4gaXNTaG93biA/IGNsb3NlKCkgOiBvcGVuKClcbiAgICB9LCBbaXNTaG93biwgY2xvc2UsIG9wZW5dKVxuXG4gICAgY29uc3QgaGFuZGxlT3BlbkhvdmVyID0gdXNlTWVtbygoKSA9PiB7XG4gICAgICByZXR1cm4gdHJpZ2dlciA9PT0gJ2hvdmVyJyA/IG9wZW4gOiB1bmRlZmluZWRcbiAgICB9LCBbdHJpZ2dlciwgb3Blbl0pXG5cbiAgICBjb25zdCBoYW5kbGVDbG9zZUhvdmVyID0gdXNlTWVtbygoKSA9PiB7XG4gICAgICByZXR1cm4gdHJpZ2dlciA9PT0gJ2hvdmVyJyA/IGNsb3NlIDogdW5kZWZpbmVkXG4gICAgfSwgW3RyaWdnZXIsIGNsb3NlXSlcblxuICAgIGNvbnN0IGhhbmRsZUtleURvd24gPSB1c2VDYWxsYmFjayhcbiAgICAgIGV2ZW50ID0+IHtcbiAgICAgICAgcmV0dXJuIGV2ZW50LmtleSA9PT0gJ0Fycm93RG93bicgPyBicmluZ0ZvY3VzSW5zaWRlKGV2ZW50KSA6IHVuZGVmaW5lZFxuICAgICAgfSxcbiAgICAgIFticmluZ0ZvY3VzSW5zaWRlXVxuICAgIClcblxuICAgIGNvbnN0IG9uRXNjID0gdXNlQ2FsbGJhY2soXG4gICAgICBldmVudCA9PiB7XG4gICAgICAgIHJldHVybiBldmVudC5rZXkgPT09ICdFc2NhcGUnID8gY2xvc2UoKSA6IHVuZGVmaW5lZFxuICAgICAgfSxcbiAgICAgIFtjbG9zZV1cbiAgICApXG5cbiAgICBjb25zdCBoYW5kbGVCb2R5Q2xpY2sgPSB1c2VDYWxsYmFjayhcbiAgICAgIGV2ZW50ID0+IHtcbiAgICAgICAgLy8gSWdub3JlIGNsaWNrcyBvbiB0aGUgcG9wb3ZlciBvciBidXR0b25cbiAgICAgICAgaWYgKHRhcmdldFJlZi5jdXJyZW50ICYmIHRhcmdldFJlZi5jdXJyZW50LmNvbnRhaW5zKGV2ZW50LnRhcmdldCkpIHtcbiAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwb3BvdmVyTm9kZS5jdXJyZW50ICYmIHBvcG92ZXJOb2RlLmN1cnJlbnQuY29udGFpbnMoZXZlbnQudGFyZ2V0KSkge1xuICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG5cbiAgICAgICAgLy8gTm90aWZ5IGJvZHkgY2xpY2tcbiAgICAgICAgb25Cb2R5Q2xpY2soZXZlbnQpXG5cbiAgICAgICAgaWYgKHNob3VsZENsb3NlT25FeHRlcm5hbENsaWNrICE9PSBmYWxzZSkge1xuICAgICAgICAgIGNsb3NlKClcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIFtvbkJvZHlDbGljaywgc2hvdWxkQ2xvc2VPbkV4dGVybmFsQ2xpY2ssIGNsb3NlLCB0YXJnZXRSZWYuY3VycmVudCwgcG9wb3Zlck5vZGUuY3VycmVudF1cbiAgICApXG5cbiAgICBjb25zdCBoYW5kbGVPcGVuQ29tcGxldGUgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgICBpZiAoc2hvdWxkQnJpbmdGb2N1c0luc2lkZSkgYnJpbmdGb2N1c0luc2lkZSgpXG4gICAgICBvbk9wZW5Db21wbGV0ZSgpXG4gICAgfSwgW3Nob3VsZEJyaW5nRm9jdXNJbnNpZGUsIGJyaW5nRm9jdXNJbnNpZGUsIG9uT3BlbkNvbXBsZXRlXSlcblxuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICBpZiAoaXNTaG93bikge1xuICAgICAgICBkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlQm9keUNsaWNrLCBmYWxzZSlcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgb25Fc2MsIGZhbHNlKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUJvZHlDbGljaywgZmFsc2UpXG4gICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIG9uRXNjLCBmYWxzZSlcbiAgICAgIH1cblxuICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUJvZHlDbGljaywgZmFsc2UpXG4gICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIG9uRXNjLCBmYWxzZSlcbiAgICAgIH1cbiAgICB9LCBbaXNTaG93biwgaGFuZGxlQm9keUNsaWNrLCBvbkVzY10pXG5cbiAgICBjb25zdCByZW5kZXJUYXJnZXQgPSB1c2VDYWxsYmFjayhcbiAgICAgICh7IGdldFJlZiwgaXNTaG93biB9KSA9PiB7XG4gICAgICAgIGNvbnN0IGlzVG9vbHRpcEluc2lkZSA9IGNoaWxkcmVuICYmIGNoaWxkcmVuLnR5cGUgPT09IFRvb2x0aXBcblxuICAgICAgICBjb25zdCBnZXRUYXJnZXRSZWYgPSByZWYgPT4ge1xuICAgICAgICAgIHNldFRhcmdldFJlZihyZWYpXG4gICAgICAgICAgZ2V0UmVmKHJlZilcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGVuIGEgZnVuY3Rpb24gaXMgcGFzc2VkLCB5b3UgY2FuIGNvbnRyb2wgdGhlIFBvcG92ZXIgbWFudWFsbHkuXG4gICAgICAgICAqL1xuICAgICAgICBpZiAodHlwZW9mIGNoaWxkcmVuID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgcmV0dXJuIGNoaWxkcmVuKHtcbiAgICAgICAgICAgIGdldFJlZjogZ2V0VGFyZ2V0UmVmLFxuICAgICAgICAgICAgaXNTaG93bixcbiAgICAgICAgICAgIHRvZ2dsZVxuICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBwb3BvdmVyVGFyZ2V0UHJvcHMgPSB7XG4gICAgICAgICAgb25DbGljazogdG9nZ2xlLFxuICAgICAgICAgIG9uTW91c2VFbnRlcjogaGFuZGxlT3BlbkhvdmVyLFxuICAgICAgICAgIG9uS2V5RG93bjogaGFuZGxlS2V5RG93bixcbiAgICAgICAgICByb2xlOiAnYnV0dG9uJyxcbiAgICAgICAgICAnYXJpYS1leHBhbmRlZCc6IGlzU2hvd24sXG4gICAgICAgICAgJ2FyaWEtaGFzcG9wdXAnOiB0cnVlXG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogVG9vbHRpcHMgY2FuIGJlIHVzZWQgd2l0aGluIGEgUG9wb3ZlciAobm90IHRoZSBvdGhlciB3YXkgYXJvdW5kKVxuICAgICAgICAgKiBJbiB0aGlzIGNhc2UgdGhlIGNoaWxkcmVuIGlzIHRoZSBUb29sdGlwIGluc3RlYWQgb2YgYSBidXR0b24uXG4gICAgICAgICAqIFBhc3MgdGhlIHByb3BlcnRpZXMgdG8gdGhlIFRvb2x0aXAgYW5kIGxldCB0aGUgVG9vbHRpcFxuICAgICAgICAgKiBhZGQgdGhlIHByb3BlcnRpZXMgdG8gdGhlIHRhcmdldC5cbiAgICAgICAgICovXG4gICAgICAgIGlmIChpc1Rvb2x0aXBJbnNpZGUpIHtcbiAgICAgICAgICByZXR1cm4gUmVhY3QuY2xvbmVFbGVtZW50KGNoaWxkcmVuLCB7XG4gICAgICAgICAgICBwb3BvdmVyUHJvcHM6IHtcbiAgICAgICAgICAgICAgZ2V0VGFyZ2V0UmVmLFxuICAgICAgICAgICAgICBpc1Nob3duLFxuXG4gICAgICAgICAgICAgIC8vIFRoZXNlIHByb3BldGllcyB3aWxsIGJlIHNwcmVhZCBhcyBgcG9wb3ZlclRhcmdldFByb3BzYFxuICAgICAgICAgICAgICAvLyBpbiB0aGUgVG9vbHRpcCBjb21wb25lbnQuXG4gICAgICAgICAgICAgIC4uLnBvcG92ZXJUYXJnZXRQcm9wc1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogV2l0aCBub3JtYWwgdXNhZ2Ugb25seSBwb3BvdmVyIHByb3BzIGVuZCB1cCBvbiB0aGUgdGFyZ2V0LlxuICAgICAgICAgKi9cbiAgICAgICAgcmV0dXJuIFJlYWN0LmNsb25lRWxlbWVudChjaGlsZHJlbiwge1xuICAgICAgICAgIHJlZjogZ2V0VGFyZ2V0UmVmLFxuICAgICAgICAgIC4uLnBvcG92ZXJUYXJnZXRQcm9wc1xuICAgICAgICB9KVxuICAgICAgfSxcbiAgICAgIFtjaGlsZHJlbiwgc2V0VGFyZ2V0UmVmLCB0b2dnbGUsIGhhbmRsZU9wZW5Ib3ZlciwgaGFuZGxlS2V5RG93bl1cbiAgICApXG5cbiAgICAvLyBJZiBgcHJvcHMuaXNTaG93bmAgaXMgYSBib29sZWFuLCBwb3BvdmVyIGlzIGNvbnRyb2xsZWQgbWFudWFsbHksIG5vdCB2aWEgbW91c2UgZXZlbnRzXG4gICAgY29uc3Qgc2hvd24gPSB0eXBlb2YgcHJvcHMuaXNTaG93biA9PT0gJ2Jvb2xlYW4nID8gcHJvcHMuaXNTaG93biA6IGlzU2hvd25cblxuICAgIGNvbnN0IGNvbnRlbnRUb1JlbmRlciA9IHVzZU1lbW8oKCkgPT4ge1xuICAgICAgcmV0dXJuIHR5cGVvZiBjb250ZW50ID09PSAnZnVuY3Rpb24nID8gY29udGVudCh7IGNsb3NlIH0pIDogY29udGVudFxuICAgIH0sIFtjb250ZW50LCBjbG9zZV0pXG5cbiAgICByZXR1cm4gKFxuICAgICAgPFBvc2l0aW9uZXJcbiAgICAgICAgdGFyZ2V0PXtyZW5kZXJUYXJnZXR9XG4gICAgICAgIGlzU2hvd249e3Nob3dufVxuICAgICAgICBwb3NpdGlvbj17cG9zaXRpb259XG4gICAgICAgIGFuaW1hdGlvbkR1cmF0aW9uPXthbmltYXRpb25EdXJhdGlvbn1cbiAgICAgICAgb25PcGVuQ29tcGxldGU9e2hhbmRsZU9wZW5Db21wbGV0ZX1cbiAgICAgICAgb25DbG9zZUNvbXBsZXRlPXtvbkNsb3NlQ29tcGxldGV9XG4gICAgICA+XG4gICAgICAgIHsoeyBjc3MsIGdldFJlZiwgc3RhdGUsIHN0eWxlIH0pID0+IChcbiAgICAgICAgICA8UG9wb3ZlclN0YXRlbGVzc1xuICAgICAgICAgICAgcmVmPXtyZWYgPT4ge1xuICAgICAgICAgICAgICBzZXRQb3BvdmVyTm9kZShyZWYpXG4gICAgICAgICAgICAgIGdldFJlZihyZWYpXG4gICAgICAgICAgICB9fVxuICAgICAgICAgICAgZGF0YS1zdGF0ZT17c3RhdGV9XG4gICAgICAgICAgICBkaXNwbGF5PXtkaXNwbGF5fVxuICAgICAgICAgICAgbWluV2lkdGg9e21pbldpZHRofVxuICAgICAgICAgICAgbWluSGVpZ2h0PXttaW5IZWlnaHR9XG4gICAgICAgICAgICB7Li4uc3RhdGVsZXNzUHJvcHN9XG4gICAgICAgICAgICBjbGFzc05hbWU9e2N4KHN0YXRlbGVzc1Byb3BzLmNsYXNzTmFtZSwgZ2xhbW9yQ3NzKGNzcywgc3R5bGUsIHN0YXRlbGVzc1Byb3BzLnN0eWxlKS50b1N0cmluZygpKX1cbiAgICAgICAgICAgIC8vIE92ZXJ3cml0ZSBgc3RhdGVsZXNzUHJvcHMuc3R5bGVgIHNpbmNlIHdlIGFyZSBpbmNsdWRpbmcgaXQgdmlhIGNsYXNzTmFtZVxuICAgICAgICAgICAgc3R5bGU9e3VuZGVmaW5lZH1cbiAgICAgICAgICAgIG9uTW91c2VMZWF2ZT17aGFuZGxlQ2xvc2VIb3Zlcn1cbiAgICAgICAgICA+XG4gICAgICAgICAgICB7Y29udGVudFRvUmVuZGVyfVxuICAgICAgICAgIDwvUG9wb3ZlclN0YXRlbGVzcz5cbiAgICAgICAgKX1cbiAgICAgIDwvUG9zaXRpb25lcj5cbiAgICApXG4gIH0pXG4pXG5cblBvcG92ZXIucHJvcFR5cGVzID0ge1xuICAvKipcbiAgICogVGhlIHBvc2l0aW9uIHRoZSBQb3BvdmVyIGlzIG9uLiBTbWFydCBwb3NpdGlvbmluZyBtaWdodCBvdmVycmlkZSB0aGlzLlxuICAgKi9cbiAgcG9zaXRpb246IFByb3BUeXBlcy5vbmVPZihbXG4gICAgUG9zaXRpb24uVE9QLFxuICAgIFBvc2l0aW9uLlRPUF9MRUZULFxuICAgIFBvc2l0aW9uLlRPUF9SSUdIVCxcbiAgICBQb3NpdGlvbi5CT1RUT00sXG4gICAgUG9zaXRpb24uQk9UVE9NX0xFRlQsXG4gICAgUG9zaXRpb24uQk9UVE9NX1JJR0hULFxuICAgIFBvc2l0aW9uLkxFRlQsXG4gICAgUG9zaXRpb24uUklHSFRcbiAgXSksXG5cbiAgLyoqXG4gICAqIFdoZW4gdHJ1ZSwgdGhlIFBvcG92ZXIgaXMgbWFudWFsbHkgc2hvd24uXG4gICAqL1xuICBpc1Nob3duOiBQcm9wVHlwZXMuYm9vbCxcbiAgLyoqXG4gICAqIE9wZW4gdGhlIFBvcG92ZXIgYmFzZWQgb24gY2xpY2sgb3IgaG92ZXIuIERlZmF1bHQgaXMgY2xpY2suXG4gICAqL1xuICB0cmlnZ2VyOiBQcm9wVHlwZXMub25lT2YoWydjbGljaycsICdob3ZlciddKSxcblxuICAvKipcbiAgICogVGhlIGNvbnRlbnQgb2YgdGhlIFBvcG92ZXIuXG4gICAqL1xuICBjb250ZW50OiBQcm9wVHlwZXMub25lT2ZUeXBlKFtQcm9wVHlwZXMubm9kZSwgUHJvcFR5cGVzLmZ1bmNdKS5pc1JlcXVpcmVkLFxuXG4gIC8qKlxuICAgKiBUaGUgdGFyZ2V0IGJ1dHRvbiBvZiB0aGUgUG9wb3Zlci5cbiAgICogV2hlbiBhIGZ1bmN0aW9uIHRoZSBmb2xsb3dpbmcgYXJndW1lbnRzIGFyZSBwYXNzZWQ6XG4gICAqICh7IHRvZ2dsZTogRnVuY3Rpb24gLT4gVm9pZCwgZ2V0UmVmOiBGdW5jdGlvbiAtPiBSZWYsIGlzU2hvd246IEJvb2wgfSlcbiAgICovXG4gIGNoaWxkcmVuOiBQcm9wVHlwZXMub25lT2ZUeXBlKFtQcm9wVHlwZXMuZWxlbWVudCwgUHJvcFR5cGVzLmZ1bmNdKS5pc1JlcXVpcmVkLFxuXG4gIC8qKlxuICAgKiBUaGUgZGlzcGxheSBwcm9wZXJ0eSBwYXNzZWQgdG8gdGhlIFBvcG92ZXIgY2FyZC5cbiAgICovXG4gIGRpc3BsYXk6IFByb3BUeXBlcy5zdHJpbmcsXG5cbiAgLyoqXG4gICAqIFRoZSBtaW4gd2lkdGggb2YgdGhlIFBvcG92ZXIgY2FyZC5cbiAgICovXG4gIG1pbldpZHRoOiBQcm9wVHlwZXMub25lT2ZUeXBlKFtQcm9wVHlwZXMubnVtYmVyLCBQcm9wVHlwZXMuc3RyaW5nXSksXG5cbiAgLyoqXG4gICAqIFRoZSBtaW4gaGVpZ2h0IG9mIHRoZSBQb3BvdmVyIGNhcmQuXG4gICAqL1xuICBtaW5IZWlnaHQ6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1Byb3BUeXBlcy5udW1iZXIsIFByb3BUeXBlcy5zdHJpbmddKSxcblxuICAvKipcbiAgICogUHJvcGVydGllcyBwYXNzZWQgdGhyb3VnaCB0byB0aGUgUG9wb3ZlciBjYXJkLlxuICAgKi9cbiAgc3RhdGVsZXNzUHJvcHM6IFByb3BUeXBlcy5zaGFwZShQb3BvdmVyU3RhdGVsZXNzLnByb3BUeXBlcyksXG5cbiAgLyoqXG4gICAqIER1cmF0aW9uIG9mIHRoZSBhbmltYXRpb24uXG4gICAqL1xuICBhbmltYXRpb25EdXJhdGlvbjogUHJvcFR5cGVzLm51bWJlcixcblxuICAvKipcbiAgICogRnVuY3Rpb24gY2FsbGVkIHdoZW4gdGhlIFBvcG92ZXIgb3BlbnMuXG4gICAqL1xuICBvbk9wZW46IFByb3BUeXBlcy5mdW5jLFxuXG4gIC8qKlxuICAgKiBGdW5jdGlvbiBmaXJlZCB3aGVuIFBvcG92ZXIgY2xvc2VzLlxuICAgKi9cbiAgb25DbG9zZTogUHJvcFR5cGVzLmZ1bmMsXG5cbiAgLyoqXG4gICAqIEZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBjYWxsZWQgd2hlbiB0aGUgZW50ZXIgdHJhbnNpdGlvbiBpcyBjb21wbGV0ZS5cbiAgICovXG4gIG9uT3BlbkNvbXBsZXRlOiBQcm9wVHlwZXMuZnVuYyxcblxuICAvKipcbiAgICogRnVuY3Rpb24gdGhhdCB3aWxsIGJlIGNhbGxlZCB3aGVuIHRoZSBleGl0IHRyYW5zaXRpb24gaXMgY29tcGxldGUuXG4gICAqL1xuICBvbkNsb3NlQ29tcGxldGU6IFByb3BUeXBlcy5mdW5jLFxuXG4gIC8qKlxuICAgKiBGdW5jdGlvbiB0aGF0IHdpbGwgYmUgY2FsbGVkIHdoZW4gdGhlIGJvZHkgaXMgY2xpY2tlZC5cbiAgICovXG4gIG9uQm9keUNsaWNrOiBQcm9wVHlwZXMuZnVuYyxcblxuICAvKipcbiAgICogV2hlbiB0cnVlLCBicmluZyBmb2N1cyBpbnNpZGUgb2YgdGhlIFBvcG92ZXIgb24gb3Blbi5cbiAgICovXG4gIGJyaW5nRm9jdXNJbnNpZGU6IFByb3BUeXBlcy5ib29sLFxuXG4gIC8qKlxuICAgKiBCb29sZWFuIGluZGljYXRpbmcgaWYgY2xpY2tpbmcgb3V0c2lkZSB0aGUgZGlhbG9nIHNob3VsZCBjbG9zZSB0aGUgZGlhbG9nLlxuICAgKi9cbiAgc2hvdWxkQ2xvc2VPbkV4dGVybmFsQ2xpY2s6IFByb3BUeXBlcy5ib29sXG59XG5cbmV4cG9ydCBkZWZhdWx0IFBvcG92ZXJcbiJdfQ==
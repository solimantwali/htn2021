"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _typeof = require("@babel/runtime/helpers/typeof");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _uiBox = require("ui-box");

var _autocomplete = require("../../autocomplete");

var _buttons = require("../../buttons");

var _group = require("../../group");

var _icons = require("../../icons");

var _textInput = require("../../text-input");

var _excluded = ["autocompleteProps", "buttonProps", "height", "initialSelectedItem", "inputProps", "isLoading", "itemToString", "items", "onChange", "openOnFocus", "placeholder", "selectedItem", "size", "width"];

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { "default": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj["default"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var Combobox = /*#__PURE__*/(0, _react.memo)(function Combobox(props) {
  var autocompleteProps = props.autocompleteProps,
      buttonProps = props.buttonProps,
      height = props.height,
      initialSelectedItem = props.initialSelectedItem,
      inputProps = props.inputProps,
      _props$isLoading = props.isLoading,
      isLoading = _props$isLoading === void 0 ? false : _props$isLoading,
      itemToString = props.itemToString,
      items = props.items,
      onChange = props.onChange,
      _props$openOnFocus = props.openOnFocus,
      openOnFocus = _props$openOnFocus === void 0 ? false : _props$openOnFocus,
      placeholder = props.placeholder,
      selectedItem = props.selectedItem,
      _props$size = props.size,
      size = _props$size === void 0 ? 'medium' : _props$size,
      _props$width = props.width,
      width = _props$width === void 0 ? 240 : _props$width,
      rest = (0, _objectWithoutProperties2["default"])(props, _excluded);
  var disabled = props.disabled || isLoading;

  var _useState = (0, _react.useState)(false),
      _useState2 = (0, _slicedToArray2["default"])(_useState, 2),
      isOpenedByButton = _useState2[0],
      setIsOpenedByButton = _useState2[1];

  var handleStateChange = (0, _react.useCallback)(function (changes, stateAndHelpers) {
    if (Object.prototype.hasOwnProperty.call(changes, 'isOpen')) {
      if (!changes.isOpen) {
        setIsOpenedByButton(false);
      }
    }

    if (autocompleteProps && typeof autocompleteProps.onStateChange === 'function') {
      autocompleteProps.onStateChange(changes, stateAndHelpers);
    }
  }, [autocompleteProps]);
  return /*#__PURE__*/_react["default"].createElement(_autocomplete.Autocomplete, (0, _extends2["default"])({
    items: items,
    selectedItem: selectedItem,
    initialSelectedItem: initialSelectedItem,
    itemToString: itemToString,
    onChange: onChange,
    isFilterDisabled: isOpenedByButton
  }, autocompleteProps, {
    onStateChange: handleStateChange
  }), function (_ref) {
    var clearSelection = _ref.clearSelection,
        getInputProps = _ref.getInputProps,
        getRef = _ref.getRef,
        getToggleButtonProps = _ref.getToggleButtonProps,
        inputValue = _ref.inputValue,
        isShown = _ref.isShown,
        openMenu = _ref.openMenu;
    return /*#__PURE__*/_react["default"].createElement(_group.Group, (0, _extends2["default"])({
      ref: getRef,
      size: size,
      width: width
    }, rest), /*#__PURE__*/_react["default"].createElement(_textInput.TextInput, (0, _extends2["default"])({
      width: 0,
      flex: 1,
      height: height,
      value: inputValue,
      borderTopRightRadius: 0,
      borderBottomRightRadius: 0,
      disabled: disabled
    }, getInputProps(_objectSpread(_objectSpread({}, inputProps), {}, {
      placeholder: placeholder,
      onFocus: function onFocus() {
        if (openOnFocus) openMenu();
      },
      onChange: function onChange(e) {
        if (isOpenedByButton) {
          setIsOpenedByButton(false);
        }

        if (e.target.value.trim() === '') {
          // Prevent the selected item from sticking around
          clearSelection();
        }
      }
    })))), /*#__PURE__*/_react["default"].createElement(_buttons.IconButton, (0, _extends2["default"])({
      color: "muted",
      icon: isLoading ? undefined : _icons.CaretDownIcon,
      appearance: "default",
      height: height,
      marginLeft: -1,
      paddingLeft: isLoading ? 12 : 0,
      paddingRight: 0,
      borderTopLeftRadius: 0,
      borderBottomLeftRadius: 0,
      disabled: disabled,
      isLoading: isLoading
    }, getToggleButtonProps(_objectSpread(_objectSpread({}, buttonProps), {}, {
      onClick: function onClick() {
        if (!isShown) {
          setIsOpenedByButton(true);
        }
      }
    })))));
  });
});
Combobox.propTypes = _objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread({}, _uiBox.dimensions.propTypes), _uiBox.spacing.propTypes), _uiBox.position.propTypes), _uiBox.layout.propTypes), {}, {
  /**
   * The options to show in the menu.
   */
  items: _propTypes["default"].array.isRequired,

  /**
   * The selected item when controlled.
   */
  selectedItem: _propTypes["default"].any,

  /**
   * Function called when value changes.
   */
  onChange: _propTypes["default"].func,

  /**
   * When true, open the autocomplete on focus.
   */
  openOnFocus: _propTypes["default"].bool,

  /**
   * Default selected item when uncontrolled.
   */
  initialSelectedItem: _propTypes["default"].any,

  /**
   * The placeholder text when there is no value present.
   */
  placeholder: _propTypes["default"].string,

  /**
   * In case the array of items is not an array of strings,
   * this function is used on each item to return the string that will be shown on the filter
   */
  itemToString: _propTypes["default"].func,

  /**
   * Properties forwarded to the input. Use with caution.
   */
  inputProps: _propTypes["default"].object,

  /**
   * Properties forwarded to the button. Use with caution.
   */
  buttonProps: _propTypes["default"].object,

  /**
   * Properties forwarded to the autocomplete component. Use with caution.
   */
  autocompleteProps: _propTypes["default"].object,

  /**
   * Makes the input element disabled.
   */
  disabled: _propTypes["default"].bool,

  /**
   * When true, show a loading spinner. This also disables the button.
   */
  isLoading: _propTypes["default"].bool,
  size: _propTypes["default"].oneOf(['small', 'medium', 'large'])
});
var _default = Combobox;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21ib2JveC9zcmMvQ29tYm9ib3guanMiXSwibmFtZXMiOlsiQ29tYm9ib3giLCJwcm9wcyIsImF1dG9jb21wbGV0ZVByb3BzIiwiYnV0dG9uUHJvcHMiLCJoZWlnaHQiLCJpbml0aWFsU2VsZWN0ZWRJdGVtIiwiaW5wdXRQcm9wcyIsImlzTG9hZGluZyIsIml0ZW1Ub1N0cmluZyIsIml0ZW1zIiwib25DaGFuZ2UiLCJvcGVuT25Gb2N1cyIsInBsYWNlaG9sZGVyIiwic2VsZWN0ZWRJdGVtIiwic2l6ZSIsIndpZHRoIiwicmVzdCIsImRpc2FibGVkIiwiaXNPcGVuZWRCeUJ1dHRvbiIsInNldElzT3BlbmVkQnlCdXR0b24iLCJoYW5kbGVTdGF0ZUNoYW5nZSIsImNoYW5nZXMiLCJzdGF0ZUFuZEhlbHBlcnMiLCJPYmplY3QiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJpc09wZW4iLCJvblN0YXRlQ2hhbmdlIiwiY2xlYXJTZWxlY3Rpb24iLCJnZXRJbnB1dFByb3BzIiwiZ2V0UmVmIiwiZ2V0VG9nZ2xlQnV0dG9uUHJvcHMiLCJpbnB1dFZhbHVlIiwiaXNTaG93biIsIm9wZW5NZW51Iiwib25Gb2N1cyIsImUiLCJ0YXJnZXQiLCJ2YWx1ZSIsInRyaW0iLCJ1bmRlZmluZWQiLCJDYXJldERvd25JY29uIiwib25DbGljayIsInByb3BUeXBlcyIsImRpbWVuc2lvbnMiLCJzcGFjaW5nIiwicG9zaXRpb24iLCJsYXlvdXQiLCJQcm9wVHlwZXMiLCJhcnJheSIsImlzUmVxdWlyZWQiLCJhbnkiLCJmdW5jIiwiYm9vbCIsInN0cmluZyIsIm9iamVjdCIsIm9uZU9mIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7Ozs7OztBQUVBLElBQU1BLFFBQVEsZ0JBQUcsaUJBQUssU0FBU0EsUUFBVCxDQUFrQkMsS0FB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Qjs7QUFpRUU7QUFDRjtBQUNBO0FBQ0UvQyxFQUFBQSxTQUFTLEVBQUUwQyxzQkFBVUssSUFwRXZCO0FBc0VFeEMsRUFBQUEsSUFBSSxFQUFFbUMsc0JBQVVRLEtBQVYsQ0FBZ0IsQ0FBQyxPQUFELEVBQVUsUUFBVixFQUFvQixPQUFwQixDQUFoQjtBQXRFUjtlQXlFZXpELFEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgbWVtbywgdXNlU3RhdGUsIHVzZUNhbGxiYWNrIH0gZnJvbSAncmVhY3QnXG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnXG5pbXBvcnQgeyBkaW1lbnNpb25zLCBzcGFjaW5nLCBwb3NpdGlvbiwgbGF5b3V0IH0gZnJvbSAndWktYm94J1xuaW1wb3J0IHsgQXV0b2NvbXBsZXRlIH0gZnJvbSAnLi4vLi4vYXV0b2NvbXBsZXRlJ1xuaW1wb3J0IHsgSWNvbkJ1dHRvbiB9IGZyb20gJy4uLy4uL2J1dHRvbnMnXG5pbXBvcnQgeyBHcm91cCB9IGZyb20gJy4uLy4uL2dyb3VwJ1xuaW1wb3J0IHsgQ2FyZXREb3duSWNvbiB9IGZyb20gJy4uLy4uL2ljb25zJ1xuaW1wb3J0IHsgVGV4dElucHV0IH0gZnJvbSAnLi4vLi4vdGV4dC1pbnB1dCdcblxuY29uc3QgQ29tYm9ib3ggPSBtZW1vKGZ1bmN0aW9uIENvbWJvYm94KHByb3BzKSB7XG4gIGNvbnN0IHtcbiAgICBhdXRvY29tcGxldGVQcm9wcyxcbiAgICBidXR0b25Qcm9wcyxcbiAgICBoZWlnaHQsXG4gICAgaW5pdGlhbFNlbGVjdGVkSXRlbSxcbiAgICBpbnB1dFByb3BzLFxuICAgIGlzTG9hZGluZyA9IGZhbHNlLFxuICAgIGl0ZW1Ub1N0cmluZyxcbiAgICBpdGVtcyxcbiAgICBvbkNoYW5nZSxcbiAgICBvcGVuT25Gb2N1cyA9IGZhbHNlLFxuICAgIHBsYWNlaG9sZGVyLFxuICAgIHNlbGVjdGVkSXRlbSxcbiAgICBzaXplID0gJ21lZGl1bScsXG4gICAgd2lkdGggPSAyNDAsXG4gICAgLi4ucmVzdFxuICB9ID0gcHJvcHNcblxuICBjb25zdCBkaXNhYmxlZCA9IHByb3BzLmRpc2FibGVkIHx8IGlzTG9hZGluZ1xuXG4gIGNvbnN0IFtpc09wZW5lZEJ5QnV0dG9uLCBzZXRJc09wZW5lZEJ5QnV0dG9uXSA9IHVzZVN0YXRlKGZhbHNlKVxuXG4gIGNvbnN0IGhhbmRsZVN0YXRlQ2hhbmdlID0gdXNlQ2FsbGJhY2soXG4gICAgKGNoYW5nZXMsIHN0YXRlQW5kSGVscGVycykgPT4ge1xuICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChjaGFuZ2VzLCAnaXNPcGVuJykpIHtcbiAgICAgICAgaWYgKCFjaGFuZ2VzLmlzT3Blbikge1xuICAgICAgICAgIHNldElzT3BlbmVkQnlCdXR0b24oZmFsc2UpXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKGF1dG9jb21wbGV0ZVByb3BzICYmIHR5cGVvZiBhdXRvY29tcGxldGVQcm9wcy5vblN0YXRlQ2hhbmdlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGF1dG9jb21wbGV0ZVByb3BzLm9uU3RhdGVDaGFuZ2UoY2hhbmdlcywgc3RhdGVBbmRIZWxwZXJzKVxuICAgICAgfVxuICAgIH0sXG4gICAgW2F1dG9jb21wbGV0ZVByb3BzXVxuICApXG5cbiAgcmV0dXJuIChcbiAgICA8QXV0b2NvbXBsZXRlXG4gICAgICBpdGVtcz17aXRlbXN9XG4gICAgICBzZWxlY3RlZEl0ZW09e3NlbGVjdGVkSXRlbX1cbiAgICAgIGluaXRpYWxTZWxlY3RlZEl0ZW09e2luaXRpYWxTZWxlY3RlZEl0ZW19XG4gICAgICBpdGVtVG9TdHJpbmc9e2l0ZW1Ub1N0cmluZ31cbiAgICAgIG9uQ2hhbmdlPXtvbkNoYW5nZX1cbiAgICAgIGlzRmlsdGVyRGlzYWJsZWQ9e2lzT3BlbmVkQnlCdXR0b259XG4gICAgICB7Li4uYXV0b2NvbXBsZXRlUHJvcHN9XG4gICAgICBvblN0YXRlQ2hhbmdlPXtoYW5kbGVTdGF0ZUNoYW5nZX1cbiAgICA+XG4gICAgICB7KHsgY2xlYXJTZWxlY3Rpb24sIGdldElucHV0UHJvcHMsIGdldFJlZiwgZ2V0VG9nZ2xlQnV0dG9uUHJvcHMsIGlucHV0VmFsdWUsIGlzU2hvd24sIG9wZW5NZW51IH0pID0+IChcbiAgICAgICAgPEdyb3VwIHJlZj17Z2V0UmVmfSBzaXplPXtzaXplfSB3aWR0aD17d2lkdGh9IHsuLi5yZXN0fT5cbiAgICAgICAgICA8VGV4dElucHV0XG4gICAgICAgICAgICB3aWR0aD17MH1cbiAgICAgICAgICAgIGZsZXg9ezF9XG4gICAgICAgICAgICBoZWlnaHQ9e2hlaWdodH1cbiAgICAgICAgICAgIHZhbHVlPXtpbnB1dFZhbHVlfVxuICAgICAgICAgICAgYm9yZGVyVG9wUmlnaHRSYWRpdXM9ezB9XG4gICAgICAgICAgICBib3JkZXJCb3R0b21SaWdodFJhZGl1cz17MH1cbiAgICAgICAgICAgIGRpc2FibGVkPXtkaXNhYmxlZH1cbiAgICAgICAgICAgIHsuLi5nZXRJbnB1dFByb3BzKHtcbiAgICAgICAgICAgICAgLi4uaW5wdXRQcm9wcyxcbiAgICAgICAgICAgICAgcGxhY2Vob2xkZXIsXG4gICAgICAgICAgICAgIG9uRm9jdXM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAob3Blbk9uRm9jdXMpIG9wZW5NZW51KClcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgb25DaGFuZ2U6IGUgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChpc09wZW5lZEJ5QnV0dG9uKSB7XG4gICAgICAgICAgICAgICAgICBzZXRJc09wZW5lZEJ5QnV0dG9uKGZhbHNlKVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChlLnRhcmdldC52YWx1ZS50cmltKCkgPT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAvLyBQcmV2ZW50IHRoZSBzZWxlY3RlZCBpdGVtIGZyb20gc3RpY2tpbmcgYXJvdW5kXG4gICAgICAgICAgICAgICAgICBjbGVhclNlbGVjdGlvbigpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KX1cbiAgICAgICAgICAvPlxuICAgICAgICAgIDxJY29uQnV0dG9uXG4gICAgICAgICAgICBjb2xvcj1cIm11dGVkXCJcbiAgICAgICAgICAgIGljb249e2lzTG9hZGluZyA/IHVuZGVmaW5lZCA6IENhcmV0RG93bkljb259XG4gICAgICAgICAgICBhcHBlYXJhbmNlPVwiZGVmYXVsdFwiXG4gICAgICAgICAgICBoZWlnaHQ9e2hlaWdodH1cbiAgICAgICAgICAgIG1hcmdpbkxlZnQ9ey0xfVxuICAgICAgICAgICAgcGFkZGluZ0xlZnQ9e2lzTG9hZGluZyA/IDEyIDogMH1cbiAgICAgICAgICAgIHBhZGRpbmdSaWdodD17MH1cbiAgICAgICAgICAgIGJvcmRlclRvcExlZnRSYWRpdXM9ezB9XG4gICAgICAgICAgICBib3JkZXJCb3R0b21MZWZ0UmFkaXVzPXswfVxuICAgICAgICAgICAgZGlzYWJsZWQ9e2Rpc2FibGVkfVxuICAgICAgICAgICAgaXNMb2FkaW5nPXtpc0xvYWRpbmd9XG4gICAgICAgICAgICB7Li4uZ2V0VG9nZ2xlQnV0dG9uUHJvcHMoe1xuICAgICAgICAgICAgICAuLi5idXR0b25Qcm9wcyxcbiAgICAgICAgICAgICAgb25DbGljazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghaXNTaG93bikge1xuICAgICAgICAgICAgICAgICAgc2V0SXNPcGVuZWRCeUJ1dHRvbih0cnVlKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSl9XG4gICAgICAgICAgLz5cbiAgICAgICAgPC9Hcm91cD5cbiAgICAgICl9XG4gICAgPC9BdXRvY29tcGxldGU+XG4gIClcbn0pXG5cbkNvbWJvYm94LnByb3BUeXBlcyA9IHtcbiAgLyoqXG4gICAqIEltcGxlbWVudHMgc29tZSBBUElzIGZyb20gdWktYm94LlxuICAgKi9cbiAgLi4uZGltZW5zaW9ucy5wcm9wVHlwZXMsXG4gIC4uLnNwYWNpbmcucHJvcFR5cGVzLFxuICAuLi5wb3NpdGlvbi5wcm9wVHlwZXMsXG4gIC4uLmxheW91dC5wcm9wVHlwZXMsXG5cbiAgLyoqXG4gICAqIFRoZSBvcHRpb25zIHRvIHNob3cgaW4gdGhlIG1lbnUuXG4gICAqL1xuICBpdGVtczogUHJvcFR5cGVzLmFycmF5LmlzUmVxdWlyZWQsXG5cbiAgLyoqXG4gICAqIFRoZSBzZWxlY3RlZCBpdGVtIHdoZW4gY29udHJvbGxlZC5cbiAgICovXG4gIHNlbGVjdGVkSXRlbTogUHJvcFR5cGVzLmFueSxcblxuICAvKipcbiAgICogRnVuY3Rpb24gY2FsbGVkIHdoZW4gdmFsdWUgY2hhbmdlcy5cbiAgICovXG4gIG9uQ2hhbmdlOiBQcm9wVHlwZXMuZnVuYyxcblxuICAvKipcbiAgICogV2hlbiB0cnVlLCBvcGVuIHRoZSBhdXRvY29tcGxldGUgb24gZm9jdXMuXG4gICAqL1xuICBvcGVuT25Gb2N1czogUHJvcFR5cGVzLmJvb2wsXG5cbiAgLyoqXG4gICAqIERlZmF1bHQgc2VsZWN0ZWQgaXRlbSB3aGVuIHVuY29udHJvbGxlZC5cbiAgICovXG4gIGluaXRpYWxTZWxlY3RlZEl0ZW06IFByb3BUeXBlcy5hbnksXG5cbiAgLyoqXG4gICAqIFRoZSBwbGFjZWhvbGRlciB0ZXh0IHdoZW4gdGhlcmUgaXMgbm8gdmFsdWUgcHJlc2VudC5cbiAgICovXG4gIHBsYWNlaG9sZGVyOiBQcm9wVHlwZXMuc3RyaW5nLFxuXG4gIC8qKlxuICAgKiBJbiBjYXNlIHRoZSBhcnJheSBvZiBpdGVtcyBpcyBub3QgYW4gYXJyYXkgb2Ygc3RyaW5ncyxcbiAgICogdGhpcyBmdW5jdGlvbiBpcyB1c2VkIG9uIGVhY2ggaXRlbSB0byByZXR1cm4gdGhlIHN0cmluZyB0aGF0IHdpbGwgYmUgc2hvd24gb24gdGhlIGZpbHRlclxuICAgKi9cbiAgaXRlbVRvU3RyaW5nOiBQcm9wVHlwZXMuZnVuYyxcblxuICAvKipcbiAgICogUHJvcGVydGllcyBmb3J3YXJkZWQgdG8gdGhlIGlucHV0LiBVc2Ugd2l0aCBjYXV0aW9uLlxuICAgKi9cbiAgaW5wdXRQcm9wczogUHJvcFR5cGVzLm9iamVjdCxcblxuICAvKipcbiAgICogUHJvcGVydGllcyBmb3J3YXJkZWQgdG8gdGhlIGJ1dHRvbi4gVXNlIHdpdGggY2F1dGlvbi5cbiAgICovXG4gIGJ1dHRvblByb3BzOiBQcm9wVHlwZXMub2JqZWN0LFxuXG4gIC8qKlxuICAgKiBQcm9wZXJ0aWVzIGZvcndhcmRlZCB0byB0aGUgYXV0b2NvbXBsZXRlIGNvbXBvbmVudC4gVXNlIHdpdGggY2F1dGlvbi5cbiAgICovXG4gIGF1dG9jb21wbGV0ZVByb3BzOiBQcm9wVHlwZXMub2JqZWN0LFxuXG4gIC8qKlxuICAgKiBNYWtlcyB0aGUgaW5wdXQgZWxlbWVudCBkaXNhYmxlZC5cbiAgICovXG4gIGRpc2FibGVkOiBQcm9wVHlwZXMuYm9vbCxcblxuICAvKipcbiAgICogV2hlbiB0cnVlLCBzaG93IGEgbG9hZGluZyBzcGlubmVyLiBUaGlzIGFsc28gZGlzYWJsZXMgdGhlIGJ1dHRvbi5cbiAgICovXG4gIGlzTG9hZGluZzogUHJvcFR5cGVzLmJvb2wsXG5cbiAgc2l6ZTogUHJvcFR5cGVzLm9uZU9mKFsnc21hbGwnLCAnbWVkaXVtJywgJ2xhcmdlJ10pXG59XG5cbmV4cG9ydCBkZWZhdWx0IENvbWJvYm94XG4iXX0=
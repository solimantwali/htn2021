import _extends from "@babel/runtime/helpers/esm/extends";
import _slicedToArray from "@babel/runtime/helpers/esm/slicedToArray";
import _objectWithoutProperties from "@babel/runtime/helpers/esm/objectWithoutProperties";
var _excluded = ["addOnBlur", "disabled", "height", "separator", "values", "tagSubmitKey", "tagProps", "onAdd", "onChange", "onRemove", "onBlur", "onFocus", "onInputChange", "className", "inputProps", "inputRef"],
    _excluded2 = ["className"];

/**
 * @overview TagInput accepts multiple values that can be individually removed
 */
import React, { memo, forwardRef, useState } from 'react';
import cx from 'classnames';
import PropTypes from 'prop-types';
import Box from 'ui-box';
import { useId, useStyleConfig } from '../../hooks';
import safeInvoke from '../../lib/safe-invoke';
import { majorScale } from '../../scales';
import { TextInput } from '../../text-input';
import Tag from './Tag';
var GET_KEY_FOR_TAG_DELIMITER = {
  enter: 'Enter',
  space: ' '
};
var emptyProps = {};
var emptyArray = [];
var internalStyles = {
  alignItems: 'center',
  display: 'inline-flex',
  flexWrap: 'wrap'
};
var pseudoSelectors = {
  _focused: '&[aria-activedescendant]',
  _disabled: '&[aria-disabled="true"]'
};
var TagInput = /*#__PURE__*/memo( /*#__PURE__*/forwardRef(function TagInput(props, ref) {
  var _props$addOnBlur = props.addOnBlur,
      addOnBlur = _props$addOnBlur === void 0 ? false : _props$addOnBlur,
      _props$disabled = props.disabled,
      disabled = _props$disabled === void 0 ? false : _props$disabled,
      _props$height = props.height,
      height = _props$height === void 0 ? 32 : _props$height,
      _props$separator = props.separator,
      separator = _props$separator === void 0 ? /[,\n\r]/ : _props$separator,
      _props$values = props.values,
      values = _props$values === void 0 ? emptyArray : _props$values,
      _props$tagSubmitKey = props.tagSubmitKey,
      tagSubmitKey = _props$tagSubmitKey === void 0 ? 'enter' : _props$tagSubmitKey,
      _props$tagProps = props.tagProps,
      tagProps = _props$tagProps === void 0 ? emptyProps : _props$tagProps,
      onAdd = props.onAdd,
      onChange = props.onChange,
      onRemove = props.onRemove,
      onBlur = props.onBlur,
      onFocus = props.onFocus,
      onInputChange = props.onInputChange,
      className = props.className,
      _props$inputProps = props.inputProps,
      inputProps = _props$inputProps === void 0 ? emptyProps : _props$inputProps,
      inputRef = props.inputRef,
      rest = _objectWithoutProperties(props, _excluded);

  var _useState = useState(''),
      _useState2 = _slicedToArray(_useState, 2),
      inputValue = _useState2[0],
      setInputValue = _useState2[1];

  var _useState3 = useState(false),
      _useState4 = _slicedToArray(_useState3, 2),
      isFocused = _useState4[0],
      setIsFocused = _useState4[1];

  var id = useId('TagInput');

  var getValues = function getValues() {
    var inputValue = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';
    return separator ? inputValue.split(separator).map(function (v) {
      return v.trim();
    }).filter(function (v) {
      return v.length > 0;
    }) : [inputValue];
  };

  var addTags = function addTags() {
    var value = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';
    var newValues = getValues(value);
    var shouldClearInput = safeInvoke(onAdd, newValues);

    if (typeof onChange === 'function') {
      shouldClearInput = shouldClearInput || onChange(values.concat(newValues));
    }

    if (shouldClearInput !== false) {
      setInputValue('');
    }
  };

  var removeTagAtIndex = function removeTagAtIndex(index) {
    safeInvoke(onRemove, values[index], index); // Remove item at index as a new array

    var newValues = values.filter(function (_, i) {
      return i !== index;
    });
    safeInvoke(onChange, newValues);
  };

  var handleBackspaceToRemove = function handleBackspaceToRemove() {
    removeTagAtIndex(values.length - 1);
  };

  var handleBlur = function handleBlur(event) {
    var container = event.target;
    requestAnimationFrame(function () {
      if (!container.contains(document.activeElement)) {
        if (addOnBlur && inputValue) {
          addTags(inputValue);
        }

        setIsFocused(false);
      }
    });
    safeInvoke(onBlur, event);
  };

  var handleInputChange = function handleInputChange(event) {
    setInputValue(event.target.value);
    safeInvoke(onInputChange, event);
  };

  var handleInputFocus = function handleInputFocus(event) {
    setIsFocused(true);
    safeInvoke(onFocus, event);
  };

  var handleKeyDown = function handleKeyDown(event) {
    var _event$target = event.target,
        selectionEnd = _event$target.selectionEnd,
        value = _event$target.value;
    var key = GET_KEY_FOR_TAG_DELIMITER[tagSubmitKey];

    if (event.key === key) {
      event.preventDefault();
      addTags(value);
    } else if (event.key === 'Backspace' && selectionEnd === 0) {
      handleBackspaceToRemove(event);
    }
  };

  var handleRemoveTag = function handleRemoveTag(event) {
    // Using data attribute to simplify callback logic -- one handler for all children
    var index = Number(event.currentTarget.parentElement.getAttribute('data-tag-index'));
    removeTagAtIndex(index);
  };

  var maybeRenderTag = function maybeRenderTag(tag, index) {
    if (!tag) {
      return null;
    }

    var propsForElement = safeInvoke(tagProps, tag, index) || tagProps;
    return /*#__PURE__*/React.createElement(Tag, _extends({
      key: "".concat(tag, ":").concat(index),
      "data-tag-index": index,
      marginX: majorScale(1),
      onRemove: disabled ? null : handleRemoveTag,
      isRemovable: !disabled
    }, propsForElement), tag);
  };

  var _useStyleConfig = useStyleConfig('TagInput', {
    appearance: 'default',
    height: height
  }, pseudoSelectors, internalStyles),
      themedContainerClassName = _useStyleConfig.className,
      boxProps = _objectWithoutProperties(_useStyleConfig, _excluded2);

  return /*#__PURE__*/React.createElement(Box, _extends({
    "aria-disabled": disabled || undefined,
    "aria-activedescendant": isFocused ? id : undefined,
    className: cx(themedContainerClassName, className),
    ref: ref,
    onBlur: handleBlur
  }, boxProps, rest), values.map(maybeRenderTag), /*#__PURE__*/React.createElement(TextInput, _extends({
    appearance: "none",
    id: id,
    disabled: disabled,
    flexGrow: "1",
    height: height - 4,
    width: "auto",
    type: "text",
    value: inputValue
  }, inputProps, {
    ref: inputRef,
    onChange: handleInputChange,
    onFocus: handleInputFocus,
    onKeyDown: handleKeyDown
  })));
}));
TagInput.propTypes = {
  /** Whether or not the inputValue should be added to the tags when the input blurs. */
  addOnBlur: PropTypes.bool,

  /** The class name to apply to the container component. */
  className: PropTypes.string,

  /** Whether or not the input should be disabled. */
  disabled: PropTypes.bool,

  /** The vertical size of the input */
  height: PropTypes.number,

  /** Props to pass to the input component. Note that `ref` and `key` are not supported. See `inputRef`. */
  inputProps: PropTypes.object,

  /**
   * Ref handler for the input element.
   * (input: HTMLInputElement | null) => void
   */
  inputRef: PropTypes.func,

  /**
   * Callback invoked when new tags are added.
   * Returning `false` will prevent clearing the input.
   * (values: Array) => void | false
   */
  onAdd: PropTypes.func,

  /**
   * Callback invoked when focus on the input blurs.
   * (event) => void
   */
  onBlur: PropTypes.func,

  /**
   * Callback invoked when the tag values change.
   * Returning `false` will prevent clearing the input.
   * (values: Array) => void | false
   */
  onChange: PropTypes.func,

  /**
   * Callback invoked when the input receives focus.
   * (event) => void
   */
  onFocus: PropTypes.func,

  /**
   * Callback invoked when the value of the input is changed. Shorthand for `inputProps={{ onChange }}`.
   * (event) => void
   */
  onInputChange: PropTypes.func,

  /**
   * Callback invoked when a tag is removed.
   * Receives value and index of removed tag.
   * (value: string | node, index: number) => void
   */
  onRemove: PropTypes.func,

  /** Value or RegExp to split on pasted text or on enter keypress */
  separator: PropTypes.oneOfType([PropTypes.string, PropTypes.instanceOf(RegExp), PropTypes.oneOf([false])]),

  /** Provide props to tag component (actually `Badge`, for now). */
  tagProps: PropTypes.oneOfType([PropTypes.object, PropTypes.func]),

  /** Key to press in order to submit a new tag while typing.  */
  tagSubmitKey: PropTypes.oneOf(['enter', 'space']),

  /** Controlled tag values. Each value is rendered inside a tag. */
  values: PropTypes.arrayOf(PropTypes.node)
};
export default TagInput;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy90YWctaW5wdXQvc3JjL1RhZ0lucHV0LmpzIl0sIm5hbWVzIjpbIlJlYWN0IiwibWVtbyIsImZvcndhcmRSZWYiLCJ1c2VTdGF0ZSIsImN4IiwiUHJvcFR5cGVzIiwiQm94IiwidXNlSWQiLCJ1c2VTdHlsZUNvbmZpZyIsInNhZmVJbnZva2UiLCJtYWpvclNjYWxlIiwiVGV4dElucHV0IiwiVGFnIiwiR0VUX0tFWV9GT1JfVEFHX0RFTElNSVRFUiIsImVudGVyIiwic3BhY2UiLCJlbXB0eVByb3BzIiwiZW1wdHlBcnJheSIsImludGVybmFsU3R5bGVzIiwiYWxpZ25JdGVtcyIsImRpc3BsYXkiLCJmbGV4V3JhcCIsInBzZXVkb1NlbGVjdG9ycyIsIl9mb2N1c2VkIiwiX2Rpc2FibGVkIiwiVGFnSW5wdXQiLCJwcm9wcyIsInJlZiIsImFkZE9uQmx1ciIsImRpc2FibGVkIiwiaGVpZ2h0Iiwic2VwYXJhdG9yIiwidmFsdWVzIiwidGFnU3VibWl0S2V5IiwidGFnUHJvcHMiLCJvbkFkZCIsIm9uQ2hhbmdlIiwib25SZW1vdmUiLCJvbkJsdXIiLCJvbkZvY3VzIiwib25JbnB1dENoYW5nZSIsImNsYXNzTmFtZSIsImlucHV0UHJvcHMiLCJpbnB1dFJlZiIsInJlc3QiLCJpbnB1dFZhbHVlIiwic2V0SW5wdXRWYWx1ZSIsImlzRm9jdXNlZCIsInNldElzRm9jdXNlZCIsImlkIiwiZ2V0VmFsdWVzIiwic3BsaXQiLCJtYXAiLCJ2IiwidHJpbSIsImZpbHRlciIsImxlbmd0aCIsImFkZFRhZ3MiLCJ2YWx1ZSIsIm5ld1ZhbHVlcyIsInNob3VsZENsZWFySW5wdXQiLCJjb25jYXQiLCJyZW1vdmVUYWdBdEluZGV4IiwiaW5kZXgiLCJfIiwiaSIsImhhbmRsZUJhY2tzcGFjZVRvUmVtb3ZlIiwiaGFuZGxlQmx1ciIsImV2ZW50IiwiY29udGFpbmVyIiwidGFyZ2V0IiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwiY29udGFpbnMiLCJkb2N1bWVudCIsImFjdGl2ZUVsZW1lbnQiLCJoYW5kbGVJbnB1dENoYW5nZSIsImhhbmRsZUlucHV0Rm9jdXMiLCJoYW5kbGVLZXlEb3duIiwic2VsZWN0aW9uRW5kIiwia2V5IiwicHJldmVudERlZmF1bHQiLCJoYW5kbGVSZW1vdmVUYWciLCJOdW1iZXIiLCJjdXJyZW50VGFyZ2V0IiwicGFyZW50RWxlbWVudCIsImdldEF0dHJpYnV0ZSIsIm1heWJlUmVuZGVyVGFnIiwidGFnIiwicHJvcHNGb3JFbGVtZW50IiwiYXBwZWFyYW5jZSIsInRoZW1lZENvbnRhaW5lckNsYXNzTmFtZSIsImJveFByb3BzIiwidW5kZWZpbmVkIiwicHJvcFR5cGVzIiwiYm9vbCIsInN0cmluZyIsIm51bWJlciIsIm9iamVjdCIsImZ1bmMiLCJvbmVPZlR5cGUiLCJpbnN0YW5jZU9mIiwiUmVnRXhwIiwib25lT2YiLCJhcnJheU9mIiwibm9kZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBRUEsT0FBT0EsS0FBUCxJQUFnQkMsSUFBaEIsRUFBc0JDLFVBQXRCLEVBQWtDQyxRQUFsQyxRQUFrRCxPQUFsRDtBQUNBLE9BQU9DLEVBQVAsTUFBZSxZQUFmO0FBQ0EsT0FBT0MsU0FBUCxNQUFzQixZQUF0QjtBQUNBLE9BQU9DLEdBQVAsTUFBZ0IsUUFBaEI7QUFDQSxTQUFTQyxLQUFULEVBQWdCQyxjQUFoQixRQUFzQyxhQUF0QztBQUNBLE9BQU9DLFVBQVAsTUFBdUIsdUJBQXZCO0FBQ0EsU0FBU0MsVUFBVCxRQUEyQixjQUEzQjtBQUNBLFNBQVNDLFNBQVQsUUFBMEIsa0JBQTFCO0FBQ0EsT0FBT0MsR0FBUCxNQUFnQixPQUFoQjtBQUVBLElBQU1DLHlCQUF5QixHQUFHO0FBQ2hDQyxFQUFBQSxLQUFLLEVBQUUsT0FEeUI7QUFFaENDLEVBQUFBLEtBQUssRUFBRTtBQUZ5QixDQUFsQztBQUtBLElBQU1DLFVBQVUsR0FBRyxFQUFuQjtBQUNBLElBQU1DLFVBQVUsR0FBRyxFQUFuQjtBQUVBLElBQU1DLGNBQWMsR0FB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KiBAb3ZlcnZpZXcgVGFnSW5wdXQgYWNjZXB0cyBtdWx0aXBsZSB2YWx1ZXMgdGhhdCBjYW4gYmUgaW5kaXZpZHVhbGx5IHJlbW92ZWRcbiAqL1xuXG5pbXBvcnQgUmVhY3QsIHsgbWVtbywgZm9yd2FyZFJlZiwgdXNlU3RhdGUgfSBmcm9tICdyZWFjdCdcbmltcG9ydCBjeCBmcm9tICdjbGFzc25hbWVzJ1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJ1xuaW1wb3J0IEJveCBmcm9tICd1aS1ib3gnXG5pbXBvcnQgeyB1c2VJZCwgdXNlU3R5bGVDb25maWcgfSBmcm9tICcuLi8uLi9ob29rcydcbmltcG9ydCBzYWZlSW52b2tlIGZyb20gJy4uLy4uL2xpYi9zYWZlLWludm9rZSdcbmltcG9ydCB7IG1ham9yU2NhbGUgfSBmcm9tICcuLi8uLi9zY2FsZXMnXG5pbXBvcnQgeyBUZXh0SW5wdXQgfSBmcm9tICcuLi8uLi90ZXh0LWlucHV0J1xuaW1wb3J0IFRhZyBmcm9tICcuL1RhZydcblxuY29uc3QgR0VUX0tFWV9GT1JfVEFHX0RFTElNSVRFUiA9IHtcbiAgZW50ZXI6ICdFbnRlcicsXG4gIHNwYWNlOiAnICdcbn1cblxuY29uc3QgZW1wdHlQcm9wcyA9IHt9XG5jb25zdCBlbXB0eUFycmF5ID0gW11cblxuY29uc3QgaW50ZXJuYWxTdHlsZXMgPSB7XG4gIGFsaWduSXRlbXM6ICdjZW50ZXInLFxuICBkaXNwbGF5OiAnaW5saW5lLWZsZXgnLFxuICBmbGV4V3JhcDogJ3dyYXAnXG59XG5cbmNvbnN0IHBzZXVkb1NlbGVjdG9ycyA9IHtcbiAgX2ZvY3VzZWQ6ICcmW2FyaWEtYWN0aXZlZGVzY2VuZGFudF0nLFxuICBfZGlzYWJsZWQ6ICcmW2FyaWEtZGlzYWJsZWQ9XCJ0cnVlXCJdJ1xufVxuXG5jb25zdCBUYWdJbnB1dCA9IG1lbW8oXG4gIGZvcndhcmRSZWYoZnVuY3Rpb24gVGFnSW5wdXQocHJvcHMsIHJlZikge1xuICAgIGNvbnN0IHtcbiAgICAgIGFkZE9uQmx1ciA9IGZhbHNlLFxuICAgICAgZGlzYWJsZWQgPSBmYWxzZSxcbiAgICAgIGhlaWdodCA9IDMyLFxuICAgICAgc2VwYXJhdG9yID0gL1ssXFxuXFxyXS8sXG4gICAgICB2YWx1ZXMgPSBlbXB0eUFycmF5LFxuICAgICAgdGFnU3VibWl0S2V5ID0gJ2VudGVyJyxcbiAgICAgIHRhZ1Byb3BzID0gZW1wdHlQcm9wcyxcbiAgICAgIG9uQWRkLFxuICAgICAgb25DaGFuZ2UsXG4gICAgICBvblJlbW92ZSxcbiAgICAgIG9uQmx1cixcbiAgICAgIG9uRm9jdXMsXG4gICAgICBvbklucHV0Q2hhbmdlLFxuICAgICAgY2xhc3NOYW1lLFxuICAgICAgaW5wdXRQcm9wcyA9IGVtcHR5UHJvcHMsXG4gICAgICBpbnB1dFJlZixcbiAgICAgIC4uLnJlc3RcbiAgICB9ID0gcHJvcHNcbiAgICBjb25zdCBbaW5wdXRWYWx1ZSwgc2V0SW5wdXRWYWx1ZV0gPSB1c2VTdGF0ZSgnJylcbiAgICBjb25zdCBbaXNGb2N1c2VkLCBzZXRJc0ZvY3VzZWRdID0gdXNlU3RhdGUoZmFsc2UpXG4gICAgY29uc3QgaWQgPSB1c2VJZCgnVGFnSW5wdXQnKVxuXG4gICAgY29uc3QgZ2V0VmFsdWVzID0gKGlucHV0VmFsdWUgPSAnJykgPT5cbiAgICAgIHNlcGFyYXRvclxuICAgICAgICA/IGlucHV0VmFsdWVcbiAgICAgICAgICAgIC5zcGxpdChzZXBhcmF0b3IpXG4gICAgICAgICAgICAubWFwKHYgPT4gdi50cmltKCkpXG4gICAgICAgICAgICAuZmlsdGVyKHYgPT4gdi5sZW5ndGggPiAwKVxuICAgICAgICA6IFtpbnB1dFZhbHVlXVxuXG4gICAgY29uc3QgYWRkVGFncyA9ICh2YWx1ZSA9ICcnKSA9PiB7XG4gICAgICBjb25zdCBuZXdWYWx1ZXMgPSBnZXRWYWx1ZXModmFsdWUpXG4gICAgICBsZXQgc2hvdWxkQ2xlYXJJbnB1dCA9IHNhZmVJbnZva2Uob25BZGQsIG5ld1ZhbHVlcylcblxuICAgICAgaWYgKHR5cGVvZiBvbkNoYW5nZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICBzaG91bGRDbGVhcklucHV0ID0gc2hvdWxkQ2xlYXJJbnB1dCB8fCBvbkNoYW5nZSh2YWx1ZXMuY29uY2F0KG5ld1ZhbHVlcykpXG4gICAgICB9XG5cbiAgICAgIGlmIChzaG91bGRDbGVhcklucHV0ICE9PSBmYWxzZSkge1xuICAgICAgICBzZXRJbnB1dFZhbHVlKCcnKVxuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IHJlbW92ZVRhZ0F0SW5kZXggPSBpbmRleCA9PiB7XG4gICAgICBzYWZlSW52b2tlKG9uUmVtb3ZlLCB2YWx1ZXNbaW5kZXhdLCBpbmRleClcblxuICAgICAgLy8gUmVtb3ZlIGl0ZW0gYXQgaW5kZXggYXMgYSBuZXcgYXJyYXlcbiAgICAgIGNvbnN0IG5ld1ZhbHVlcyA9IHZhbHVlcy5maWx0ZXIoKF8sIGkpID0+IGkgIT09IGluZGV4KVxuICAgICAgc2FmZUludm9rZShvbkNoYW5nZSwgbmV3VmFsdWVzKVxuICAgIH1cblxuICAgIGNvbnN0IGhhbmRsZUJhY2tzcGFjZVRvUmVtb3ZlID0gKCkgPT4ge1xuICAgICAgcmVtb3ZlVGFnQXRJbmRleCh2YWx1ZXMubGVuZ3RoIC0gMSlcbiAgICB9XG5cbiAgICBjb25zdCBoYW5kbGVCbHVyID0gZXZlbnQgPT4ge1xuICAgICAgY29uc3QgY29udGFpbmVyID0gZXZlbnQudGFyZ2V0XG5cbiAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XG4gICAgICAgIGlmICghY29udGFpbmVyLmNvbnRhaW5zKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpKSB7XG4gICAgICAgICAgaWYgKGFkZE9uQmx1ciAmJiBpbnB1dFZhbHVlKSB7XG4gICAgICAgICAgICBhZGRUYWdzKGlucHV0VmFsdWUpXG4gICAgICAgICAgfVxuXG4gICAgICAgICAgc2V0SXNGb2N1c2VkKGZhbHNlKVxuICAgICAgICB9XG4gICAgICB9KVxuXG4gICAgICBzYWZlSW52b2tlKG9uQmx1ciwgZXZlbnQpXG4gICAgfVxuXG4gICAgY29uc3QgaGFuZGxlSW5wdXRDaGFuZ2UgPSBldmVudCA9PiB7XG4gICAgICBzZXRJbnB1dFZhbHVlKGV2ZW50LnRhcmdldC52YWx1ZSlcbiAgICAgIHNhZmVJbnZva2Uob25JbnB1dENoYW5nZSwgZXZlbnQpXG4gICAgfVxuXG4gICAgY29uc3QgaGFuZGxlSW5wdXRGb2N1cyA9IGV2ZW50ID0+IHtcbiAgICAgIHNldElzRm9jdXNlZCh0cnVlKVxuICAgICAgc2FmZUludm9rZShvbkZvY3VzLCBldmVudClcbiAgICB9XG5cbiAgICBjb25zdCBoYW5kbGVLZXlEb3duID0gZXZlbnQgPT4ge1xuICAgICAgY29uc3QgeyBzZWxlY3Rpb25FbmQsIHZhbHVlIH0gPSBldmVudC50YXJnZXRcbiAgICAgIGNvbnN0IGtleSA9IEdFVF9LRVlfRk9SX1RBR19ERUxJTUlURVJbdGFnU3VibWl0S2V5XVxuXG4gICAgICBpZiAoZXZlbnQua2V5ID09PSBrZXkpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKVxuICAgICAgICBhZGRUYWdzKHZhbHVlKVxuICAgICAgfSBlbHNlIGlmIChldmVudC5rZXkgPT09ICdCYWNrc3BhY2UnICYmIHNlbGVjdGlvbkVuZCA9PT0gMCkge1xuICAgICAgICBoYW5kbGVCYWNrc3BhY2VUb1JlbW92ZShldmVudClcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBoYW5kbGVSZW1vdmVUYWcgPSBldmVudCA9PiB7XG4gICAgICAvLyBVc2luZyBkYXRhIGF0dHJpYnV0ZSB0byBzaW1wbGlmeSBjYWxsYmFjayBsb2dpYyAtLSBvbmUgaGFuZGxlciBmb3IgYWxsIGNoaWxkcmVuXG4gICAgICBjb25zdCBpbmRleCA9IE51bWJlcihldmVudC5jdXJyZW50VGFyZ2V0LnBhcmVudEVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLXRhZy1pbmRleCcpKVxuICAgICAgcmVtb3ZlVGFnQXRJbmRleChpbmRleClcbiAgICB9XG5cbiAgICBjb25zdCBtYXliZVJlbmRlclRhZyA9ICh0YWcsIGluZGV4KSA9PiB7XG4gICAgICBpZiAoIXRhZykge1xuICAgICAgICByZXR1cm4gbnVsbFxuICAgICAgfVxuXG4gICAgICBjb25zdCBwcm9wc0ZvckVsZW1lbnQgPSBzYWZlSW52b2tlKHRhZ1Byb3BzLCB0YWcsIGluZGV4KSB8fCB0YWdQcm9wc1xuXG4gICAgICByZXR1cm4gKFxuICAgICAgICA8VGFnXG4gICAgICAgICAga2V5PXtgJHt0YWd9OiR7aW5kZXh9YH1cbiAgICAgICAgICBkYXRhLXRhZy1pbmRleD17aW5kZXh9XG4gICAgICAgICAgbWFyZ2luWD17bWFqb3JTY2FsZSgxKX1cbiAgICAgICAgICBvblJlbW92ZT17ZGlzYWJsZWQgPyBudWxsIDogaGFuZGxlUmVtb3ZlVGFnfVxuICAgICAgICAgIGlzUmVtb3ZhYmxlPXshZGlzYWJsZWR9XG4gICAgICAgICAgey4uLnByb3BzRm9yRWxlbWVudH1cbiAgICAgICAgPlxuICAgICAgICAgIHt0YWd9XG4gICAgICAgIDwvVGFnPlxuICAgICAgKVxuICAgIH1cblxuICAgIGNvbnN0IHsgY2xhc3NOYW1lOiB0aGVtZWRDb250YWluZXJDbGFzc05hbWUsIC4uLmJveFByb3BzIH0gPSB1c2VTdHlsZUNvbmZpZyhcbiAgICAgICdUYWdJbnB1dCcsXG4gICAgICB7IGFwcGVhcmFuY2U6ICdkZWZhdWx0JywgaGVpZ2h0IH0sXG4gICAgICBwc2V1ZG9TZWxlY3RvcnMsXG4gICAgICBpbnRlcm5hbFN0eWxlc1xuICAgIClcblxuICAgIHJldHVybiAoXG4gICAgICA8Qm94XG4gICAgICAgIGFyaWEtZGlzYWJsZWQ9e2Rpc2FibGVkIHx8IHVuZGVmaW5lZH1cbiAgICAgICAgYXJpYS1hY3RpdmVkZXNjZW5kYW50PXtpc0ZvY3VzZWQgPyBpZCA6IHVuZGVmaW5lZH1cbiAgICAgICAgY2xhc3NOYW1lPXtjeCh0aGVtZWRDb250YWluZXJDbGFzc05hbWUsIGNsYXNzTmFtZSl9XG4gICAgICAgIHJlZj17cmVmfVxuICAgICAgICBvbkJsdXI9e2hhbmRsZUJsdXJ9XG4gICAgICAgIHsuLi5ib3hQcm9wc31cbiAgICAgICAgey4uLnJlc3R9XG4gICAgICA+XG4gICAgICAgIHt2YWx1ZXMubWFwKG1heWJlUmVuZGVyVGFnKX1cbiAgICAgICAgPFRleHRJbnB1dFxuICAgICAgICAgIGFwcGVhcmFuY2U9XCJub25lXCJcbiAgICAgICAgICBpZD17aWR9XG4gICAgICAgICAgZGlzYWJsZWQ9e2Rpc2FibGVkfVxuICAgICAgICAgIGZsZXhHcm93PVwiMVwiXG4gICAgICAgICAgaGVpZ2h0PXtoZWlnaHQgLSA0fVxuICAgICAgICAgIHdpZHRoPVwiYXV0b1wiXG4gICAgICAgICAgdHlwZT1cInRleHRcIlxuICAgICAgICAgIHZhbHVlPXtpbnB1dFZhbHVlfVxuICAgICAgICAgIHsuLi5pbnB1dFByb3BzfVxuICAgICAgICAgIHJlZj17aW5wdXRSZWZ9XG4gICAgICAgICAgb25DaGFuZ2U9e2hhbmRsZUlucHV0Q2hhbmdlfVxuICAgICAgICAgIG9uRm9jdXM9e2hhbmRsZUlucHV0Rm9jdXN9XG4gICAgICAgICAgb25LZXlEb3duPXtoYW5kbGVLZXlEb3dufVxuICAgICAgICAvPlxuICAgICAgPC9Cb3g+XG4gICAgKVxuICB9KVxuKVxuXG5UYWdJbnB1dC5wcm9wVHlwZXMgPSB7XG4gIC8qKiBXaGV0aGVyIG9yIG5vdCB0aGUgaW5wdXRWYWx1ZSBzaG91bGQgYmUgYWRkZWQgdG8gdGhlIHRhZ3Mgd2hlbiB0aGUgaW5wdXQgYmx1cnMuICovXG4gIGFkZE9uQmx1cjogUHJvcFR5cGVzLmJvb2wsXG4gIC8qKiBUaGUgY2xhc3MgbmFtZSB0byBhcHBseSB0byB0aGUgY29udGFpbmVyIGNvbXBvbmVudC4gKi9cbiAgY2xhc3NOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAvKiogV2hldGhlciBvciBub3QgdGhlIGlucHV0IHNob3VsZCBiZSBkaXNhYmxlZC4gKi9cbiAgZGlzYWJsZWQ6IFByb3BUeXBlcy5ib29sLFxuICAvKiogVGhlIHZlcnRpY2FsIHNpemUgb2YgdGhlIGlucHV0ICovXG4gIGhlaWdodDogUHJvcFR5cGVzLm51bWJlcixcbiAgLyoqIFByb3BzIHRvIHBhc3MgdG8gdGhlIGlucHV0IGNvbXBvbmVudC4gTm90ZSB0aGF0IGByZWZgIGFuZCBga2V5YCBhcmUgbm90IHN1cHBvcnRlZC4gU2VlIGBpbnB1dFJlZmAuICovXG4gIGlucHV0UHJvcHM6IFByb3BUeXBlcy5vYmplY3QsXG4gIC8qKlxuICAgKiBSZWYgaGFuZGxlciBmb3IgdGhlIGlucHV0IGVsZW1lbnQuXG4gICAqIChpbnB1dDogSFRNTElucHV0RWxlbWVudCB8IG51bGwpID0+IHZvaWRcbiAgICovXG4gIGlucHV0UmVmOiBQcm9wVHlwZXMuZnVuYyxcbiAgLyoqXG4gICAqIENhbGxiYWNrIGludm9rZWQgd2hlbiBuZXcgdGFncyBhcmUgYWRkZWQuXG4gICAqIFJldHVybmluZyBgZmFsc2VgIHdpbGwgcHJldmVudCBjbGVhcmluZyB0aGUgaW5wdXQuXG4gICAqICh2YWx1ZXM6IEFycmF5KSA9PiB2b2lkIHwgZmFsc2VcbiAgICovXG4gIG9uQWRkOiBQcm9wVHlwZXMuZnVuYyxcbiAgLyoqXG4gICAqIENhbGxiYWNrIGludm9rZWQgd2hlbiBmb2N1cyBvbiB0aGUgaW5wdXQgYmx1cnMuXG4gICAqIChldmVudCkgPT4gdm9pZFxuICAgKi9cbiAgb25CbHVyOiBQcm9wVHlwZXMuZnVuYyxcbiAgLyoqXG4gICAqIENhbGxiYWNrIGludm9rZWQgd2hlbiB0aGUgdGFnIHZhbHVlcyBjaGFuZ2UuXG4gICAqIFJldHVybmluZyBgZmFsc2VgIHdpbGwgcHJldmVudCBjbGVhcmluZyB0aGUgaW5wdXQuXG4gICAqICh2YWx1ZXM6IEFycmF5KSA9PiB2b2lkIHwgZmFsc2VcbiAgICovXG4gIG9uQ2hhbmdlOiBQcm9wVHlwZXMuZnVuYyxcbiAgLyoqXG4gICAqIENhbGxiYWNrIGludm9rZWQgd2hlbiB0aGUgaW5wdXQgcmVjZWl2ZXMgZm9jdXMuXG4gICAqIChldmVudCkgPT4gdm9pZFxuICAgKi9cbiAgb25Gb2N1czogUHJvcFR5cGVzLmZ1bmMsXG4gIC8qKlxuICAgKiBDYWxsYmFjayBpbnZva2VkIHdoZW4gdGhlIHZhbHVlIG9mIHRoZSBpbnB1dCBpcyBjaGFuZ2VkLiBTaG9ydGhhbmQgZm9yIGBpbnB1dFByb3BzPXt7IG9uQ2hhbmdlIH19YC5cbiAgICogKGV2ZW50KSA9PiB2b2lkXG4gICAqL1xuICBvbklucHV0Q2hhbmdlOiBQcm9wVHlwZXMuZnVuYyxcbiAgLyoqXG4gICAqIENhbGxiYWNrIGludm9rZWQgd2hlbiBhIHRhZyBpcyByZW1vdmVkLlxuICAgKiBSZWNlaXZlcyB2YWx1ZSBhbmQgaW5kZXggb2YgcmVtb3ZlZCB0YWcuXG4gICAqICh2YWx1ZTogc3RyaW5nIHwgbm9kZSwgaW5kZXg6IG51bWJlcikgPT4gdm9pZFxuICAgKi9cbiAgb25SZW1vdmU6IFByb3BUeXBlcy5mdW5jLFxuICAvKiogVmFsdWUgb3IgUmVnRXhwIHRvIHNwbGl0IG9uIHBhc3RlZCB0ZXh0IG9yIG9uIGVudGVyIGtleXByZXNzICovXG4gIHNlcGFyYXRvcjogUHJvcFR5cGVzLm9uZU9mVHlwZShbUHJvcFR5cGVzLnN0cmluZywgUHJvcFR5cGVzLmluc3RhbmNlT2YoUmVnRXhwKSwgUHJvcFR5cGVzLm9uZU9mKFtmYWxzZV0pXSksXG4gIC8qKiBQcm92aWRlIHByb3BzIHRvIHRhZyBjb21wb25lbnQgKGFjdHVhbGx5IGBCYWRnZWAsIGZvciBub3cpLiAqL1xuICB0YWdQcm9wczogUHJvcFR5cGVzLm9uZU9mVHlwZShbUHJvcFR5cGVzLm9iamVjdCwgUHJvcFR5cGVzLmZ1bmNdKSxcbiAgLyoqIEtleSB0byBwcmVzcyBpbiBvcmRlciB0byBzdWJtaXQgYSBuZXcgdGFnIHdoaWxlIHR5cGluZy4gICovXG4gIHRhZ1N1Ym1pdEtleTogUHJvcFR5cGVzLm9uZU9mKFsnZW50ZXInLCAnc3BhY2UnXSksXG4gIC8qKiBDb250cm9sbGVkIHRhZyB2YWx1ZXMuIEVhY2ggdmFsdWUgaXMgcmVuZGVyZWQgaW5zaWRlIGEgdGFnLiAqL1xuICB2YWx1ZXM6IFByb3BUeXBlcy5hcnJheU9mKFByb3BUeXBlcy5ub2RlKVxufVxuXG5leHBvcnQgZGVmYXVsdCBUYWdJbnB1dFxuIl19
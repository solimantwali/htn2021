import _toConsumableArray from "@babel/runtime/helpers/esm/toConsumableArray";
import _extends from "@babel/runtime/helpers/esm/extends";
import _objectWithoutProperties from "@babel/runtime/helpers/esm/objectWithoutProperties";
import _slicedToArray from "@babel/runtime/helpers/esm/slicedToArray";
var _excluded = ["isSelected", "onPageChange", "page"],
    _excluded2 = ["onNextPage", "onPageChange", "onPreviousPage", "page", "totalPages"];
import React, { useState, useCallback, useMemo, memo, forwardRef } from 'react';
import PropTypes from 'prop-types';
import { Button, IconButton } from '../../buttons';
import { ChevronLeftIcon, ChevronRightIcon } from '../../icons';
import { Pane } from '../../layers';
import { majorScale, minorScale } from '../../scales';
import { useTheme } from '../../theme';
import { Text } from '../../typography';
export var usePaginationBehavior = function usePaginationBehavior() {
  var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
      _ref$page = _ref.page,
      inputPage = _ref$page === void 0 ? 1 : _ref$page;

  var _useState = useState(inputPage),
      _useState2 = _slicedToArray(_useState, 2),
      page = _useState2[0],
      setPage = _useState2[1];

  var onNextPage = useCallback(function () {
    setPage(function (page) {
      return page + 1;
    });
  }, []);
  var onPreviousPage = useCallback(function () {
    setPage(function (page) {
      return page - 1;
    });
  }, []);
  var onPageChange = useCallback(function (index) {
    setPage(index);
  }, []);
  return {
    page: page,
    onNextPage: onNextPage,
    onPageChange: onPageChange,
    onPreviousPage: onPreviousPage
  };
};
var MAX_HANDLES_TO_SHOW = 7;
/* eslint-disable react/prop-types */

var PaginationButton = function PaginationButton(_ref2) {
  var isSelected = _ref2.isSelected,
      onPageChange = _ref2.onPageChange,
      page = _ref2.page,
      rest = _objectWithoutProperties(_ref2, _excluded);

  var _useTheme = useTheme(),
      colors = _useTheme.colors;

  var isEllipsis = typeof page === 'string' && page === '...';
  var selectedProps = useMemo(function () {
    if (isSelected) {
      return {
        backgroundColor: colors.blue50,
        color: colors.blue400
      };
    } else {
      return {};
    }
  }, [isSelected, colors]);
  var onClick = useCallback(function () {
    onPageChange(page);
  }, [page, onPageChange]);

  if (isEllipsis) {
    return /*#__PURE__*/React.createElement(Text, {
      paddingX: majorScale(1),
      paddingY: majorScale(1),
      minWidth: majorScale(4),
      textAlign: "center",
      "aria-label": "Pagination overflow"
    }, page);
  }

  return /*#__PURE__*/React.createElement(Button, _extends({
    "aria-current": isSelected,
    "aria-label": "Page ".concat(page),
    onClick: onClick,
    minWidth: majorScale(4),
    paddingX: majorScale(1)
  }, rest, selectedProps));
};

PaginationButton.displayName = "PaginationButton";

/* eslint-enable react/prop-types */
var range = function range(start, stop) {
  var output = [];

  for (var i = start; i <= stop; i++) {
    output.push(i);
  }

  return output;
};

var getPaginationButtonContent = function getPaginationButtonContent(_ref3) {
  var page = _ref3.page,
      totalPages = _ref3.totalPages;

  if (totalPages <= MAX_HANDLES_TO_SHOW) {
    return range(1, totalPages);
  }

  if (totalPages > MAX_HANDLES_TO_SHOW && page <= 4) {
    return [].concat(_toConsumableArray(range(1, 5)), ['...', totalPages]);
  }

  if (totalPages - page < 4) {
    return [1, '...'].concat(_toConsumableArray(range(totalPages - 4, totalPages)));
  }

  return [1, '...'].concat(_toConsumableArray(range(page - 1, page + 1)), ['...', totalPages]);
};

var noop = function noop() {};

var Pagination = /*#__PURE__*/memo( /*#__PURE__*/forwardRef(function Pagination(_ref4, ref) {
  var _ref4$onNextPage = _ref4.onNextPage,
      onNextPage = _ref4$onNextPage === void 0 ? noop : _ref4$onNextPage,
      _ref4$onPageChange = _ref4.onPageChange,
      onPageChange = _ref4$onPageChange === void 0 ? noop : _ref4$onPageChange,
      _ref4$onPreviousPage = _ref4.onPreviousPage,
      onPreviousPage = _ref4$onPreviousPage === void 0 ? noop : _ref4$onPreviousPage,
      _ref4$page = _ref4.page,
      page = _ref4$page === void 0 ? 1 : _ref4$page,
      totalPages = _ref4.totalPages,
      rest = _objectWithoutProperties(_ref4, _excluded2);

  return /*#__PURE__*/React.createElement(Pane, _extends({
    is: "nav",
    role: "navigation",
    "aria-label": "Pagination"
  }, rest, {
    ref: ref
  }), /*#__PURE__*/React.createElement(Pane, {
    is: "ul",
    display: "flex",
    alignItems: "center",
    padding: 0
  }, /*#__PURE__*/React.createElement(Pane, {
    is: "li",
    listStyle: "none"
  }, /*#__PURE__*/React.createElement(IconButton, {
    appearance: "minimal",
    icon: ChevronLeftIcon,
    disabled: page === 1,
    onClick: onPreviousPage
  })), totalPages ? getPaginationButtonContent({
    totalPages: totalPages,
    page: page
  }).map(function (val, i) {
    var isSelected = val === page;
    return /*#__PURE__*/React.createElement(Pane, {
      is: "li",
      listStyle: "none",
      key: "".concat(val, "-").concat(i)
    }, /*#__PURE__*/React.createElement(PaginationButton, {
      appearance: "minimal",
      isSelected: isSelected,
      page: val,
      onPageChange: onPageChange,
      marginX: minorScale(1) / 2
    }, val));
  }) : null, /*#__PURE__*/React.createElement(Pane, {
    is: "li",
    listStyle: "none"
  }, /*#__PURE__*/React.createElement(IconButton, {
    appearance: "minimal",
    icon: ChevronRightIcon,
    disabled: totalPages ? page === totalPages : undefined,
    onClick: onNextPage
  }))));
}));
Pagination.propTypes = {
  /**
   * The current page that a user is on - defaults to 1.
   */
  page: PropTypes.number.isRequired,

  /**
   * The total number of pages to render. If ommitted, the page numbers will not be shown to the end user.
   */
  totalPages: PropTypes.number,

  /**
   * Callback handler when the next page button is clicked.
   */
  onNextPage: PropTypes.func,

  /**
   * Callback handler when the previous page button is clicked.
   */
  onPreviousPage: PropTypes.func,

  /**
   * Callback handler when a specific page # is clicked
   */
  onPageChange: PropTypes.func
};
export default Pagination;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9wYWdpbmF0aW9uL3NyYy9QYWdpbmF0aW9uLmpzIl0sIm5hbWVzIjpbIlJlYWN0IiwidXNlU3RhdGUiLCJ1c2VDYWxsYmFjayIsInVzZU1lbW8iLCJtZW1vIiwiZm9yd2FyZFJlZiIsIlByb3BUeXBlcyIsIkJ1dHRvbiIsIkljb25CdXR0b24iLCJDaGV2cm9uTGVmdEljb24iLCJDaGV2cm9uUmlnaHRJY29uIiwiUGFuZSIsIm1ham9yU2NhbGUiLCJtaW5vclNjYWxlIiwidXNlVGhlbWUiLCJUZXh0IiwidXNlUGFnaW5hdGlvbkJlaGF2aW9yIiwicGFnZSIsImlucHV0UGFnZSIsInNldFBhZ2UiLCJvbk5leHRQYWdlIiwib25QcmV2aW91c1BhZ2UiLCJvblBhZ2VDaGFuZ2UiLCJpbmRleCIsIk1BWF9IQU5ETEVTX1RPX1NIT1ciLCJQYWdpbmF0aW9uQnV0dG9uIiwiaXNTZWxlY3RlZCIsInJlc3QiLCJjb2xvcnMiLCJpc0VsbGlwc2lzIiwic2VsZWN0ZWRQcm9wcyIsImJhY2tncm91bmRDb2xvciIsImJsdWU1MCIsImNvbG9yIiwiYmx1ZTQwMCIsIm9uQ2xpY2siLCJyYW5nZSIsInN0YXJ0Iiwic3RvcCIsIm91dHB1dCIsImkiLCJwdXNoIiwiZ2V0UGFnaW5hdGlvbkJ1dHRvbkNvbnRlbnQiLCJ0b3RhbFBhZ2VzIiwibm9vcCIsIlBhZ2luYXRpb24iLCJyZWYiLCJtYXAiLCJ2YWwiLCJ1bmRlZmluZWQiLCJwcm9wVHlwZXMiLCJudW1iZXIiLCJpc1JlcXVpcmVkIiwiZnVuYyJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsT0FBT0EsS0FBUCxJQUFnQkMsUUFBaEIsRUFBMEJDLFdBQTFCLEVBQXVDQyxPQUF2QyxFQUFnREMsSUFBaEQsRUFBc0RDLFVBQXRELFFBQXdFLE9BQXhFO0FBQ0EsT0FBT0MsU0FBUCxNQUFzQixZQUF0QjtBQUNBLFNBQVNDLE1BQVQsRUFBaUJDLFVBQWpCLFFBQW1DLGVBQW5DO0FBQ0EsU0FBU0MsZUFBVCxFQUEw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Q0F5QixVQUFVLENBQUNLLFNBQVgsR0FBdUI7QUFDckI7QUFDRjtBQUNBO0FBQ0VqQyxFQUFBQSxJQUFJLEVBQUVYLFNBQVMsQ0FBQzZDLE1BQVYsQ0FBaUJDLFVBSkY7O0FBS3JCO0FBQ0Y7QUFDQTtBQUNFVCxFQUFBQSxVQUFVLEVBQUVyQyxTQUFTLENBQUM2QyxNQVJEOztBQVNyQjtBQUNGO0FBQ0E7QUFDRS9CLEVBQUFBLFVBQVUsRUFBRWQsU0FBUyxDQUFDK0MsSUFaRDs7QUFhckI7QUFDRjtBQUNBO0FBQ0VoQyxFQUFBQSxjQUFjLEVBQUVmLFNBQVMsQ0FBQytDLElBaEJMOztBQWlCckI7QUFDRjtBQUNBO0FBQ0UvQixFQUFBQSxZQUFZLEVBQUVoQixTQUFTLENBQUMrQztBQXBCSCxDQUF2QjtBQXVCQSxlQUFlUixVQUFmIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IHVzZVN0YXRlLCB1c2VDYWxsYmFjaywgdXNlTWVtbywgbWVtbywgZm9yd2FyZFJlZiB9IGZyb20gJ3JlYWN0J1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJ1xuaW1wb3J0IHsgQnV0dG9uLCBJY29uQnV0dG9uIH0gZnJvbSAnLi4vLi4vYnV0dG9ucydcbmltcG9ydCB7IENoZXZyb25MZWZ0SWNvbiwgQ2hldnJvblJpZ2h0SWNvbiB9IGZyb20gJy4uLy4uL2ljb25zJ1xuaW1wb3J0IHsgUGFuZSB9IGZyb20gJy4uLy4uL2xheWVycydcbmltcG9ydCB7IG1ham9yU2NhbGUsIG1pbm9yU2NhbGUgfSBmcm9tICcuLi8uLi9zY2FsZXMnXG5pbXBvcnQgeyB1c2VUaGVtZSB9IGZyb20gJy4uLy4uL3RoZW1lJ1xuaW1wb3J0IHsgVGV4dCB9IGZyb20gJy4uLy4uL3R5cG9ncmFwaHknXG5cbmV4cG9ydCBjb25zdCB1c2VQYWdpbmF0aW9uQmVoYXZpb3IgPSAoeyBwYWdlOiBpbnB1dFBhZ2UgPSAxIH0gPSB7fSkgPT4ge1xuICBjb25zdCBbcGFnZSwgc2V0UGFnZV0gPSB1c2VTdGF0ZShpbnB1dFBhZ2UpXG5cbiAgY29uc3Qgb25OZXh0UGFnZSA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBzZXRQYWdlKHBhZ2UgPT4gcGFnZSArIDEpXG4gIH0sIFtdKVxuXG4gIGNvbnN0IG9uUHJldmlvdXNQYWdlID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIHNldFBhZ2UocGFnZSA9PiBwYWdlIC0gMSlcbiAgfSwgW10pXG5cbiAgY29uc3Qgb25QYWdlQ2hhbmdlID0gdXNlQ2FsbGJhY2soaW5kZXggPT4ge1xuICAgIHNldFBhZ2UoaW5kZXgpXG4gIH0sIFtdKVxuXG4gIHJldHVybiB7XG4gICAgcGFnZSxcbiAgICBvbk5leHRQYWdlLFxuICAgIG9uUGFnZUNoYW5nZSxcbiAgICBvblByZXZpb3VzUGFnZVxuICB9XG59XG5cbmNvbnN0IE1BWF9IQU5ETEVTX1RPX1NIT1cgPSA3XG5cbi8qIGVzbGludC1kaXNhYmxlIHJlYWN0L3Byb3AtdHlwZXMgKi9cbmNvbnN0IFBhZ2luYXRpb25CdXR0b24gPSAoeyBpc1NlbGVjdGVkLCBvblBhZ2VDaGFuZ2UsIHBhZ2UsIC4uLnJlc3QgfSkgPT4ge1xuICBjb25zdCB7IGNvbG9ycyB9ID0gdXNlVGhlbWUoKVxuICBjb25zdCBpc0VsbGlwc2lzID0gdHlwZW9mIHBhZ2UgPT09ICdzdHJpbmcnICYmIHBhZ2UgPT09ICcuLi4nXG4gIGNvbnN0IHNlbGVjdGVkUHJvcHMgPSB1c2VNZW1vKCgpID0+IHtcbiAgICBpZiAoaXNTZWxlY3RlZCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYmFja2dyb3VuZENvbG9yOiBjb2xvcnMuYmx1ZTUwLFxuICAgICAgICBjb2xvcjogY29sb3JzLmJsdWU0MDBcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHt9XG4gICAgfVxuICB9LCBbaXNTZWxlY3RlZCwgY29sb3JzXSlcblxuICBjb25zdCBvbkNsaWNrID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIG9uUGFnZUNoYW5nZShwYWdlKVxuICB9LCBbcGFnZSwgb25QYWdlQ2hhbmdlXSlcblxuICBpZiAoaXNFbGxpcHNpcykge1xuICAgIHJldHVybiAoXG4gICAgICA8VGV4dFxuICAgICAgICBwYWRkaW5nWD17bWFqb3JTY2FsZSgxKX1cbiAgICAgICAgcGFkZGluZ1k9e21ham9yU2NhbGUoMSl9XG4gICAgICAgIG1pbldpZHRoPXttYWpvclNjYWxlKDQpfVxuICAgICAgICB0ZXh0QWxpZ249XCJjZW50ZXJcIlxuICAgICAgICBhcmlhLWxhYmVsPVwiUGFnaW5hdGlvbiBvdmVyZmxvd1wiXG4gICAgICA+XG4gICAgICAgIHtwYWdlfVxuICAgICAgPC9UZXh0PlxuICAgIClcbiAgfVxuXG4gIHJldHVybiAoXG4gICAgPEJ1dHRvblxuICAgICAgYXJpYS1jdXJyZW50PXtpc1NlbGVjdGVkfVxuICAgICAgYXJpYS1sYWJlbD17YFBhZ2UgJHtwYWdlfWB9XG4gICAgICBvbkNsaWNrPXtvbkNsaWNrfVxuICAgICAgbWluV2lkdGg9e21ham9yU2NhbGUoNCl9XG4gICAgICBwYWRkaW5nWD17bWFqb3JTY2FsZSgxKX1cbiAgICAgIHsuLi5yZXN0fVxuICAgICAgey4uLnNlbGVjdGVkUHJvcHN9XG4gICAgLz5cbiAgKVxufVxuLyogZXNsaW50LWVuYWJsZSByZWFjdC9wcm9wLXR5cGVzICovXG5cbmNvbnN0IHJhbmdlID0gKHN0YXJ0LCBzdG9wKSA9PiB7XG4gIGNvbnN0IG91dHB1dCA9IFtdXG4gIGZvciAobGV0IGkgPSBzdGFydDsgaSA8PSBzdG9wOyBpKyspIHtcbiAgICBvdXRwdXQucHVzaChpKVxuICB9XG5cbiAgcmV0dXJuIG91dHB1dFxufVxuXG5jb25zdCBnZXRQYWdpbmF0aW9uQnV0dG9uQ29udGVudCA9ICh7IHBhZ2UsIHRvdGFsUGFnZXMgfSkgPT4ge1xuICBpZiAodG90YWxQYWdlcyA8PSBNQVhfSEFORExFU19UT19TSE9XKSB7XG4gICAgcmV0dXJuIHJhbmdlKDEsIHRvdGFsUGFnZXMpXG4gIH1cblxuICBpZiAodG90YWxQYWdlcyA+IE1BWF9IQU5ETEVTX1RPX1NIT1cgJiYgcGFnZSA8PSA0KSB7XG4gICAgcmV0dXJuIFsuLi5yYW5nZSgxLCA1KSwgJy4uLicsIHRvdGFsUGFnZXNdXG4gIH1cblxuICBpZiAodG90YWxQYWdlcyAtIHBhZ2UgPCA0KSB7XG4gICAgcmV0dXJuIFsxLCAnLi4uJywgLi4ucmFuZ2UodG90YWxQYWdlcyAtIDQsIHRvdGFsUGFnZXMpXVxuICB9XG5cbiAgcmV0dXJuIFsxLCAnLi4uJywgLi4ucmFuZ2UocGFnZSAtIDEsIHBhZ2UgKyAxKSwgJy4uLicsIHRvdGFsUGFnZXNdXG59XG5cbmNvbnN0IG5vb3AgPSAoKSA9PiB7fVxuXG5jb25zdCBQYWdpbmF0aW9uID0gbWVtbyhcbiAgZm9yd2FyZFJlZihmdW5jdGlvbiBQYWdpbmF0aW9uKFxuICAgIHsgb25OZXh0UGFnZSA9IG5vb3AsIG9uUGFnZUNoYW5nZSA9IG5vb3AsIG9uUHJldmlvdXNQYWdlID0gbm9vcCwgcGFnZSA9IDEsIHRvdGFsUGFnZXMsIC4uLnJlc3QgfSxcbiAgICByZWZcbiAgKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIDxQYW5lIGlzPVwibmF2XCIgcm9sZT1cIm5hdmlnYXRpb25cIiBhcmlhLWxhYmVsPVwiUGFnaW5hdGlvblwiIHsuLi5yZXN0fSByZWY9e3JlZn0+XG4gICAgICAgIDxQYW5lIGlzPVwidWxcIiBkaXNwbGF5PVwiZmxleFwiIGFsaWduSXRlbXM9XCJjZW50ZXJcIiBwYWRkaW5nPXswfT5cbiAgICAgICAgICA8UGFuZSBpcz1cImxpXCIgbGlzdFN0eWxlPVwibm9uZVwiPlxuICAgICAgICAgICAgPEljb25CdXR0b24gYXBwZWFyYW5jZT1cIm1pbmltYWxcIiBpY29uPXtDaGV2cm9uTGVmdEljb259IGRpc2FibGVkPXtwYWdlID09PSAxfSBvbkNsaWNrPXtvblByZXZpb3VzUGFnZX0gLz5cbiAgICAgICAgICA8L1BhbmU+XG4gICAgICAgICAge3RvdGFsUGFnZXNcbiAgICAgICAgICAgID8gZ2V0UGFnaW5hdGlvbkJ1dHRvbkNvbnRlbnQoeyB0b3RhbFBhZ2VzLCBwYWdlIH0pLm1hcCgodmFsLCBpKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgaXNTZWxlY3RlZCA9IHZhbCA9PT0gcGFnZVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICAgIDxQYW5lIGlzPVwibGlcIiBsaXN0U3R5bGU9XCJub25lXCIga2V5PXtgJHt2YWx9LSR7aX1gfT5cbiAgICAgICAgICAgICAgICAgICAgPFBhZ2luYXRpb25CdXR0b25cbiAgICAgICAgICAgICAgICAgICAgICBhcHBlYXJhbmNlPVwibWluaW1hbFwiXG4gICAgICAgICAgICAgICAgICAgICAgaXNTZWxlY3RlZD17aXNTZWxlY3RlZH1cbiAgICAgICAgICAgICAgICAgICAgICBwYWdlPXt2YWx9XG4gICAgICAgICAgICAgICAgICAgICAgb25QYWdlQ2hhbmdlPXtvblBhZ2VDaGFuZ2V9XG4gICAgICAgICAgICAgICAgICAgICAgbWFyZ2luWD17bWlub3JTY2FsZSgxKSAvIDJ9XG4gICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICB7dmFsfVxuICAgICAgICAgICAgICAgICAgICA8L1BhZ2luYXRpb25CdXR0b24+XG4gICAgICAgICAgICAgICAgICA8L1BhbmU+XG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgOiBudWxsfVxuICAgICAgICAgIDxQYW5lIGlzPVwibGlcIiBsaXN0U3R5bGU9XCJub25lXCI+XG4gICAgICAgICAgICA8SWNvbkJ1dHRvblxuICAgICAgICAgICAgICBhcHBlYXJhbmNlPVwibWluaW1hbFwiXG4gICAgICAgICAgICAgIGljb249e0NoZXZyb25SaWdodEljb259XG4gICAgICAgICAgICAgIGRpc2FibGVkPXt0b3RhbFBhZ2VzID8gcGFnZSA9PT0gdG90YWxQYWdlcyA6IHVuZGVmaW5lZH1cbiAgICAgICAgICAgICAgb25DbGljaz17b25OZXh0UGFnZX1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgPC9QYW5lPlxuICAgICAgICA8L1BhbmU+XG4gICAgICA8L1BhbmU+XG4gICAgKVxuICB9KVxuKVxuXG5QYWdpbmF0aW9uLnByb3BUeXBlcyA9IHtcbiAgLyoqXG4gICAqIFRoZSBjdXJyZW50IHBhZ2UgdGhhdCBhIHVzZXIgaXMgb24gLSBkZWZhdWx0cyB0byAxLlxuICAgKi9cbiAgcGFnZTogUHJvcFR5cGVzLm51bWJlci5pc1JlcXVpcmVkLFxuICAvKipcbiAgICogVGhlIHRvdGFsIG51bWJlciBvZiBwYWdlcyB0byByZW5kZXIuIElmIG9tbWl0dGVkLCB0aGUgcGFnZSBudW1iZXJzIHdpbGwgbm90IGJlIHNob3duIHRvIHRoZSBlbmQgdXNlci5cbiAgICovXG4gIHRvdGFsUGFnZXM6IFByb3BUeXBlcy5udW1iZXIsXG4gIC8qKlxuICAgKiBDYWxsYmFjayBoYW5kbGVyIHdoZW4gdGhlIG5leHQgcGFnZSBidXR0b24gaXMgY2xpY2tlZC5cbiAgICovXG4gIG9uTmV4dFBhZ2U6IFByb3BUeXBlcy5mdW5jLFxuICAvKipcbiAgICogQ2FsbGJhY2sgaGFuZGxlciB3aGVuIHRoZSBwcmV2aW91cyBwYWdlIGJ1dHRvbiBpcyBjbGlja2VkLlxuICAgKi9cbiAgb25QcmV2aW91c1BhZ2U6IFByb3BUeXBlcy5mdW5jLFxuICAvKipcbiAgICogQ2FsbGJhY2sgaGFuZGxlciB3aGVuIGEgc3BlY2lmaWMgcGFnZSAjIGlzIGNsaWNrZWRcbiAgICovXG4gIG9uUGFnZUNoYW5nZTogUHJvcFR5cGVzLmZ1bmNcbn1cblxuZXhwb3J0IGRlZmF1bHQgUGFnaW5hdGlvblxuIl19
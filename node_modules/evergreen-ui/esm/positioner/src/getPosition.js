import { Position } from '../../constants';
/**
 * Function to create a Rect.
 * @param {Object} dimensions
 * @param {Number} dimensions.width
 * @param {Number} dimensions.height
 * @param {Object} position
 * @param {Number} position.left
 * @param {Number} position.top
 * @return {Object} Rect { width, height, left, top, right, bottom }
 */

var makeRect = function makeRect(_ref, _ref2) {
  var height = _ref.height,
      width = _ref.width;
  var left = _ref2.left,
      top = _ref2.top;
  var ceiledLeft = Math.ceil(left);
  var ceiledTop = Math.ceil(top);
  return {
    width: width,
    height: height,
    left: ceiledLeft,
    top: ceiledTop,
    right: ceiledLeft + width,
    bottom: ceiledTop + height
  };
};
/**
 * Function to flip a position upside down.
 * @param {Position} position
 * @return {Position} flipped position
 */


var flipHorizontal = function flipHorizontal(position) {
  switch (position) {
    case Position.TOP_LEFT:
      return Position.BOTTOM_LEFT;

    case Position.TOP:
    default:
      return Position.BOTTOM;

    case Position.TOP_RIGHT:
      return Position.BOTTOM_RIGHT;

    case Position.BOTTOM_LEFT:
      return Position.TOP_LEFT;

    case Position.BOTTOM:
      return Position.TOP;

    case Position.BOTTOM_RIGHT:
      return Position.TOP_RIGHT;
  }
};
/**
 * Function that returns if position is aligned on top.
 * @param {Position} position
 * @return {Boolean}
 */


var isAlignedOnTop = function isAlignedOnTop(position) {
  switch (position) {
    case Position.TOP_LEFT:
    case Position.TOP:
    case Position.TOP_RIGHT:
      return true;

    default:
      return false;
  }
};
/**
 * Function that returns if position is aligned left or right.
 * @param {Position} position
 * @return {Boolean}
 */


var isAlignedHorizontal = function isAlignedHorizontal(position) {
  switch (position) {
    case Position.LEFT:
    case Position.RIGHT:
      return true;

    default:
      return false;
  }
};
/**
 * Function that returns if a rect fits on bottom.
 * @param {Rect} rect
 * @param {Object} viewport
 * @param {Number} viewportOffset
 * @return {Boolean}
 */


var getFitsOnBottom = function getFitsOnBottom(rect, viewport, viewportOffset) {
  return rect.bottom < viewport.height - viewportOffset;
};
/**
 * Function that returns if a rect fits on top.
 * @param {Rect} rect
 * @param {Number} viewportOffset
 * @return {Boolean}
 */


var getFitsOnTop = function getFitsOnTop(rect, viewportOffset) {
  return rect.top > viewportOffset;
};
/**
 * Function that returns if a rect fits on right.
 * @param {Rect} rect
 * @param {Object} viewport
 * @param {Number} viewportOffset
 * @return {Boolean}
 */


var getFitsOnRight = function getFitsOnRight(rect, viewport, viewportOffset) {
  return rect.right < viewport.width - viewportOffset;
};
/**
 * Function that returns if a rect fits on left.
 * @param {Rect} rect
 * @param {Number} viewportOffset
 * @return {Boolean}
 */


var getFitsOnLeft = function getFitsOnLeft(rect, viewportOffset) {
  return rect.left > viewportOffset;
};
/**
 * https://developer.mozilla.org/en-US/docs/Web/CSS/transform-origin
 * Function that returns the CSS `tranform-origin` property.
 * @param {Rect} rect
 * @param {Position} position
 * @param {Object} dimensions — the dimensions of the positioner.
 * @param {Number} targetCenter - center of the target.
 * @return {String} transform origin
 */


var getTransformOrigin = function getTransformOrigin(_ref3) {
  var dimensions = _ref3.dimensions,
      position = _ref3.position,
      rect = _ref3.rect,
      targetCenter = _ref3.targetCenter;
  var centerY = Math.round(targetCenter - rect.top);

  if (position === Position.LEFT) {
    /* Syntax: x-offset | y-offset */
    return "".concat(dimensions.width, "px ").concat(centerY, "px");
  }

  if (position === Position.RIGHT) {
    /* Syntax: x-offset | y-offset */
    return "0px ".concat(centerY, "px");
  }

  var centerX = Math.round(targetCenter - rect.left);

  if (isAlignedOnTop(position)) {
    /* Syntax: x-offset | y-offset */
    return "".concat(centerX, "px ").concat(dimensions.height, "px ");
  }
  /* Syntax: x-offset | y-offset */


  return "".concat(centerX, "px 0px ");
};
/**
 * Function that takes in numbers and position and gives the final coords.
 * @param {Position} position — the position the positioner should be on.
 * @param {Object} dimensions — the dimensions of the positioner.
 * @param {Rect} targetRect — the rect of the target.
 * @param {Number} targetOffset - offset from the target.
 * @param {Object} viewport - the width and height of the viewport.
 * @param {Number} viewportOffset - offset from the viewport.
 * @return {Object} - { rect: Rect, position: Position, transformOrigin: string }
 */


export default function getFittedPosition(_ref4) {
  var dimensions = _ref4.dimensions,
      position = _ref4.position,
      targetOffset = _ref4.targetOffset,
      targetRect = _ref4.targetRect,
      viewport = _ref4.viewport,
      _ref4$viewportOffset = _ref4.viewportOffset,
      viewportOffset = _ref4$viewportOffset === void 0 ? 8 : _ref4$viewportOffset;

  var _getPosition = getPosition({
    position: position,
    dimensions: dimensions,
    targetRect: targetRect,
    targetOffset: targetOffset,
    viewport: viewport,
    viewportOffset: viewportOffset
  }),
      finalPosition = _getPosition.position,
      rect = _getPosition.rect; // Push rect to the right if overflowing on the left side of the viewport.


  if (rect.left < viewportOffset) {
    rect.right += Math.ceil(Math.abs(rect.left - viewportOffset));
    rect.left = Math.ceil(viewportOffset);
  } // Push rect to the left if overflowing on the right side of the viewport.


  if (rect.right > viewport.width - viewportOffset) {
    var delta = Math.ceil(rect.right - (viewport.width - viewportOffset));
    rect.left -= delta;
    rect.right -= delta;
  } // Push rect down if overflowing on the top side of the viewport.


  if (rect.top < viewportOffset) {
    rect.top += Math.ceil(Math.abs(rect.top - viewportOffset));
    rect.bottom = Math.ceil(viewportOffset);
  } // Push rect up if overflowing on the bottom side of the viewport.


  if (rect.bottom > viewport.height - viewportOffset) {
    var _delta = Math.ceil(rect.bottom - (viewport.height - viewportOffset));

    rect.top -= _delta;
    rect.bottom -= _delta;
  }

  var targetCenter = isAlignedHorizontal(position) ? targetRect.top + targetRect.height / 2 : targetRect.left + targetRect.width / 2;
  var transformOrigin = getTransformOrigin({
    rect: rect,
    position: finalPosition,
    dimensions: dimensions,
    targetCenter: targetCenter
  });
  return {
    rect: rect,
    position: finalPosition,
    transformOrigin: transformOrigin
  };
}
/**
 * Function that takes in numbers and position and gives the final coords.
 * @param {Position} position — the position the positioner should be on.
 * @param {Object} dimensions — the dimensions of the positioner.
 * @param {Rect} targetRect — the rect of the target.
 * @param {Number} targetOffset - offset from the target.
 * @param {Object} viewport - the width and height of the viewport.
 * @param {Object} viewportOffset - offset from the viewport.
 * @return {Object} - { rect: Rect, position: Position }
 */

function getPosition(_ref5) {
  var dimensions = _ref5.dimensions,
      position = _ref5.position,
      targetOffset = _ref5.targetOffset,
      targetRect = _ref5.targetRect,
      viewport = _ref5.viewport,
      _ref5$viewportOffset = _ref5.viewportOffset,
      viewportOffset = _ref5$viewportOffset === void 0 ? 8 : _ref5$viewportOffset;
  var isHorizontal = isAlignedHorizontal(position); // Handle left and right positions

  if (isHorizontal) {
    var leftRect = getRect({
      position: Position.LEFT,
      dimensions: dimensions,
      targetRect: targetRect,
      targetOffset: targetOffset
    });
    var rightRect = getRect({
      position: Position.RIGHT,
      dimensions: dimensions,
      targetRect: targetRect,
      targetOffset: targetOffset
    });
    var fitsOnLeft = getFitsOnLeft(leftRect, viewportOffset);
    var fitsOnRight = getFitsOnRight(rightRect, viewport, viewportOffset);

    if (position === Position.LEFT) {
      if (fitsOnLeft) {
        return {
          position: position,
          rect: leftRect
        };
      }

      if (fitsOnRight) {
        return {
          position: Position.RIGHT,
          rect: rightRect
        };
      }
    }

    if (position === Position.RIGHT) {
      if (fitsOnRight) {
        return {
          position: position,
          rect: rightRect
        };
      }

      if (fitsOnLeft) {
        return {
          position: Position.LEFT,
          rect: leftRect
        };
      }
    } // Default to using the position with the most space


    var spaceRight = Math.abs(viewport.width - viewportOffset - rightRect.right);
    var spaceLeft = Math.abs(leftRect.left - viewportOffset);

    if (spaceRight < spaceLeft) {
      return {
        position: Position.RIGHT,
        rect: rightRect
      };
    }

    return {
      position: Position.LEFT,
      rect: leftRect
    };
  }

  var positionIsAlignedOnTop = isAlignedOnTop(position);
  var topRect;
  var bottomRect;

  if (positionIsAlignedOnTop) {
    topRect = getRect({
      position: position,
      dimensions: dimensions,
      targetRect: targetRect,
      targetOffset: targetOffset
    });
    bottomRect = getRect({
      position: flipHorizontal(position),
      dimensions: dimensions,
      targetRect: targetRect,
      targetOffset: targetOffset
    });
  } else {
    topRect = getRect({
      position: flipHorizontal(position),
      dimensions: dimensions,
      targetRect: targetRect,
      targetOffset: targetOffset
    });
    bottomRect = getRect({
      position: position,
      dimensions: dimensions,
      targetRect: targetRect,
      targetOffset: targetOffset
    });
  }

  var topRectFitsOnTop = getFitsOnTop(topRect, viewportOffset);
  var bottomRectFitsOnBottom = getFitsOnBottom(bottomRect, viewport, viewportOffset);

  if (positionIsAlignedOnTop) {
    if (topRectFitsOnTop) {
      return {
        position: position,
        rect: topRect
      };
    }

    if (bottomRectFitsOnBottom) {
      return {
        position: flipHorizontal(position),
        rect: bottomRect
      };
    }
  }

  if (!positionIsAlignedOnTop) {
    if (bottomRectFitsOnBottom) {
      return {
        position: position,
        rect: bottomRect
      };
    }

    if (topRectFitsOnTop) {
      return {
        position: flipHorizontal(position),
        rect: topRect
      };
    }
  } // Default to most spacious if there is no fit.


  var spaceBottom = Math.abs(viewport.height - viewportOffset - bottomRect.bottom);
  var spaceTop = Math.abs(topRect.top - viewportOffset);

  if (spaceBottom < spaceTop) {
    return {
      position: positionIsAlignedOnTop ? flipHorizontal(position) : position,
      rect: bottomRect
    };
  }

  return {
    position: positionIsAlignedOnTop ? position : flipHorizontal(position),
    rect: topRect
  };
}
/**
 * Function that takes in numbers and position and gives the final coords.
 * @param {Position} position
 * @param {Number} targetOffset - offset from the target.
 * @param {Object} dimensions — the dimensions of the positioner.
 * @param {Rect} targetRect — the rect of the target.
 * @return {Rect} - Rect { width, height, left, top, right, bottom }
 */


function getRect(_ref6) {
  var dimensions = _ref6.dimensions,
      position = _ref6.position,
      targetOffset = _ref6.targetOffset,
      targetRect = _ref6.targetRect;
  var leftRect = targetRect.left + targetRect.width / 2 - dimensions.width / 2;
  var alignedTopY = targetRect.top - dimensions.height - targetOffset;
  var alignedBottomY = targetRect.bottom + targetOffset;
  var alignedRightX = targetRect.right - dimensions.width;
  var alignedLeftRightY = targetRect.top + targetRect.height / 2 - dimensions.height / 2;

  switch (position) {
    case Position.LEFT:
      return makeRect(dimensions, {
        left: targetRect.left - dimensions.width - targetOffset,
        top: alignedLeftRightY
      });

    case Position.RIGHT:
      return makeRect(dimensions, {
        left: targetRect.right + targetOffset,
        top: alignedLeftRightY
      });

    case Position.TOP:
      return makeRect(dimensions, {
        left: leftRect,
        top: alignedTopY
      });

    case Position.TOP_LEFT:
      return makeRect(dimensions, {
        left: targetRect.left,
        top: alignedTopY
      });

    case Position.TOP_RIGHT:
      return makeRect(dimensions, {
        left: alignedRightX,
        top: alignedTopY
      });

    default:
    case Position.BOTTOM:
      return makeRect(dimensions, {
        left: leftRect,
        top: alignedBottomY
      });

    case Position.BOTTOM_LEFT:
      return makeRect(dimensions, {
        left: targetRect.left,
        top: alignedBottomY
      });

    case Position.BOTTOM_RIGHT:
      return makeRect(dimensions, {
        left: alignedRightX,
        top: alignedBottomY
      });
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9wb3NpdGlvbmVyL3NyYy9nZXRQb3NpdGlvbi5qcyJdLCJuYW1lcyI6WyJQb3NpdGlvbiIsIm1ha2VSZWN0IiwiaGVpZ2h0Iiwid2lkdGgiLCJsZWZ0IiwidG9wIiwiY2VpbGVkTGVmdCIsIk1hdGgiLCJjZWlsIiwiY2VpbGVkVG9wIiwicmlnaHQiLCJib3R0b20iLCJmbGlwSG9yaXpvbnRhbCIsInBvc2l0aW9uIiwiVE9QX0xFRlQiLCJCT1RUT01fTEVGVCIsIlRPUCIsIkJPVFRPTSIsIlRPUF9SSUdIVCIsIkJPVFRPTV9SSUdIVCIsImlzQWxpZ25lZE9uVG9wIiwiaXNBbGlnbmVkSG9yaXpvbnRhbCIsIkxFRlQiLCJSSUdIVCIsImdldEZpdHNPbkJvdHRvbSIsInJlY3QiLCJ2aWV3cG9ydCIsInZpZXdwb3J0T2Zmc2V0IiwiZ2V0Rml0c09uVG9wIiwiZ2V0Rml0c09uUmlnaHQiLCJnZXRGaXRzT25MZWZ0IiwiZ2V0VHJhbnNmb3JtT3JpZ2luIiwiZGltZW5zaW9ucyIsInRhcmdldENlbnRlciIsImNlbnRlclkiLCJyb3VuZCIsImNlbnRlclgiLCJnZXRGaXR0ZWRQb3NpdGlvbiIsInRhcmdldE9mZnNldCIsInRhcmdldFJlY3QiLCJnZXRQb3NpdGlvbiIsImZpbmFsUG9zaXRpb24iLCJhYnMiLCJkZWx0YSIsInRyYW5zZm9ybU9yaWdpbiIsImlzSG9yaXpvbnRhbCIsImxlZnRSZWN0IiwiZ2V0UmVjdCIsInJpZ2h0UmVjdCIsImZpdHNPbkxlZnQiLCJmaXRzT25SaWdodCIsInNwYWNlUmlnaHQiLCJzcGFjZUxlZnQiLCJwb3NpdGlvbklzQWxpZ25lZE9uVG9wIiwidG9wUmVjdCIsImJvdHRvbVJlY3QiLCJ0b3BSZWN0Rml0c09uVG9wIiwiYm90dG9tUmVjdEZpdHNPbkJvdHRvbSIsInNwYWNlQm90dG9tIiwic3BhY2VUb3AiLCJhbGlnbmVkVG9wWSIsImFsaWduZWRCb3R0b21ZIiwiYWxpZ25lZFJpZ2h0WCIsImFsaWduZWRMZWZ0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LFFBQUFBLEdBQUcsRUFBRXVEO0FBRnFCLE9BQWIsQ0FBZjs7QUFJRixTQUFLNUQsUUFBUSxDQUFDa0IsU0FBZDtBQUNFLGFBQU9qQixRQUFRLENBQUMrQixVQUFELEVBQWE7QUFDMUI1QixRQUFBQSxJQUFJLEVBQUUwRCxhQURvQjtBQUUxQnpELFFBQUFBLEdBQUcsRUFBRXVEO0FBRnFCLE9BQWIsQ0FBZjs7QUFJRjtBQUNBLFNBQUs1RCxRQUFRLENBQUNpQixNQUFkO0FBQ0UsYUFBT2hCLFFBQVEsQ0FBQytCLFVBQUQsRUFBYTtBQUMxQjVCLFFBQUFBLElBQUksRUFBRTBDLFFBRG9CO0FBRTFCekMsUUFBQUEsR0FBRyxFQUFFd0Q7QUFGcUIsT0FBYixDQUFmOztBQUlGLFNBQUs3RCxRQUFRLENBQUNlLFdBQWQ7QUFDRSxhQUFPZCxRQUFRLENBQUMrQixVQUFELEVBQWE7QUFDMUI1QixRQUFBQSxJQUFJLEVBQUVtQyxVQUFVLENBQUNuQyxJQURTO0FBRTFCQyxRQUFBQSxHQUFHLEVBQUV3RDtBQUZxQixPQUFiLENBQWY7O0FBSUYsU0FBSzdELFFBQVEsQ0FBQ21CLFlBQWQ7QUFDRSxhQUFPbEIsUUFBUSxDQUFDK0IsVUFBRCxFQUFhO0FBQzFCNUIsUUFBQUEsSUFBSSxFQUFFMEQsYUFEb0I7QUFFMUJ6RCxRQUFBQSxHQUFHLEVBQUV3RDtBQUZxQixPQUFiLENBQWY7QUF0Q0o7QUEyQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQb3NpdGlvbiB9IGZyb20gJy4uLy4uL2NvbnN0YW50cydcblxuLyoqXG4gKiBGdW5jdGlvbiB0byBjcmVhdGUgYSBSZWN0LlxuICogQHBhcmFtIHtPYmplY3R9IGRpbWVuc2lvbnNcbiAqIEBwYXJhbSB7TnVtYmVyfSBkaW1lbnNpb25zLndpZHRoXG4gKiBAcGFyYW0ge051bWJlcn0gZGltZW5zaW9ucy5oZWlnaHRcbiAqIEBwYXJhbSB7T2JqZWN0fSBwb3NpdGlvblxuICogQHBhcmFtIHtOdW1iZXJ9IHBvc2l0aW9uLmxlZnRcbiAqIEBwYXJhbSB7TnVtYmVyfSBwb3NpdGlvbi50b3BcbiAqIEByZXR1cm4ge09iamVjdH0gUmVjdCB7IHdpZHRoLCBoZWlnaHQsIGxlZnQsIHRvcCwgcmlnaHQsIGJvdHRvbSB9XG4gKi9cbmNvbnN0IG1ha2VSZWN0ID0gKHsgaGVpZ2h0LCB3aWR0aCB9LCB7IGxlZnQsIHRvcCB9KSA9PiB7XG4gIGNvbnN0IGNlaWxlZExlZnQgPSBNYXRoLmNlaWwobGVmdClcbiAgY29uc3QgY2VpbGVkVG9wID0gTWF0aC5jZWlsKHRvcClcbiAgcmV0dXJuIHtcbiAgICB3aWR0aCxcbiAgICBoZWlnaHQsXG4gICAgbGVmdDogY2VpbGVkTGVmdCxcbiAgICB0b3A6IGNlaWxlZFRvcCxcbiAgICByaWdodDogY2VpbGVkTGVmdCArIHdpZHRoLFxuICAgIGJvdHRvbTogY2VpbGVkVG9wICsgaGVpZ2h0XG4gIH1cbn1cblxuLyoqXG4gKiBGdW5jdGlvbiB0byBmbGlwIGEgcG9zaXRpb24gdXBzaWRlIGRvd24uXG4gKiBAcGFyYW0ge1Bvc2l0aW9ufSBwb3NpdGlvblxuICogQHJldHVybiB7UG9zaXRpb259IGZsaXBwZWQgcG9zaXRpb25cbiAqL1xuY29uc3QgZmxpcEhvcml6b250YWwgPSBwb3NpdGlvbiA9PiB7XG4gIHN3aXRjaCAocG9zaXRpb24pIHtcbiAgICBjYXNlIFBvc2l0aW9uLlRPUF9MRUZUOlxuICAgICAgcmV0dXJuIFBvc2l0aW9uLkJPVFRPTV9MRUZUXG4gICAgY2FzZSBQb3NpdGlvbi5UT1A6XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBQb3NpdGlvbi5CT1RUT01cbiAgICBjYXNlIFBvc2l0aW9uLlRPUF9SSUdIVDpcbiAgICAgIHJldHVybiBQb3NpdGlvbi5CT1RUT01fUklHSFRcbiAgICBjYXNlIFBvc2l0aW9uLkJPVFRPTV9MRUZUOlxuICAgICAgcmV0dXJuIFBvc2l0aW9uLlRPUF9MRUZUXG4gICAgY2FzZSBQb3NpdGlvbi5CT1RUT006XG4gICAgICByZXR1cm4gUG9zaXRpb24uVE9QXG4gICAgY2FzZSBQb3NpdGlvbi5CT1RUT01fUklHSFQ6XG4gICAgICByZXR1cm4gUG9zaXRpb24uVE9QX1JJR0hUXG4gIH1cbn1cblxuLyoqXG4gKiBGdW5jdGlvbiB0aGF0IHJldHVybnMgaWYgcG9zaXRpb24gaXMgYWxpZ25lZCBvbiB0b3AuXG4gKiBAcGFyYW0ge1Bvc2l0aW9ufSBwb3NpdGlvblxuICogQHJldHVybiB7Qm9vbGVhbn1cbiAqL1xuY29uc3QgaXNBbGlnbmVkT25Ub3AgPSBwb3NpdGlvbiA9PiB7XG4gIHN3aXRjaCAocG9zaXRpb24pIHtcbiAgICBjYXNlIFBvc2l0aW9uLlRPUF9MRUZUOlxuICAgIGNhc2UgUG9zaXRpb24uVE9QOlxuICAgIGNhc2UgUG9zaXRpb24uVE9QX1JJR0hUOlxuICAgICAgcmV0dXJuIHRydWVcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIGZhbHNlXG4gIH1cbn1cblxuLyoqXG4gKiBGdW5jdGlvbiB0aGF0IHJldHVybnMgaWYgcG9zaXRpb24gaXMgYWxpZ25lZCBsZWZ0IG9yIHJpZ2h0LlxuICogQHBhcmFtIHtQb3NpdGlvbn0gcG9zaXRpb25cbiAqIEByZXR1cm4ge0Jvb2xlYW59XG4gKi9cbmNvbnN0IGlzQWxpZ25lZEhvcml6b250YWwgPSBwb3NpdGlvbiA9PiB7XG4gIHN3aXRjaCAocG9zaXRpb24pIHtcbiAgICBjYXNlIFBvc2l0aW9uLkxFRlQ6XG4gICAgY2FzZSBQb3NpdGlvbi5SSUdIVDpcbiAgICAgIHJldHVybiB0cnVlXG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBmYWxzZVxuICB9XG59XG5cbi8qKlxuICogRnVuY3Rpb24gdGhhdCByZXR1cm5zIGlmIGEgcmVjdCBmaXRzIG9uIGJvdHRvbS5cbiAqIEBwYXJhbSB7UmVjdH0gcmVjdFxuICogQHBhcmFtIHtPYmplY3R9IHZpZXdwb3J0XG4gKiBAcGFyYW0ge051bWJlcn0gdmlld3BvcnRPZmZzZXRcbiAqIEByZXR1cm4ge0Jvb2xlYW59XG4gKi9cbmNvbnN0IGdldEZpdHNPbkJvdHRvbSA9IChyZWN0LCB2aWV3cG9ydCwgdmlld3BvcnRPZmZzZXQpID0+IHtcbiAgcmV0dXJuIHJlY3QuYm90dG9tIDwgdmlld3BvcnQuaGVpZ2h0IC0gdmlld3BvcnRPZmZzZXRcbn1cblxuLyoqXG4gKiBGdW5jdGlvbiB0aGF0IHJldHVybnMgaWYgYSByZWN0IGZpdHMgb24gdG9wLlxuICogQHBhcmFtIHtSZWN0fSByZWN0XG4gKiBAcGFyYW0ge051bWJlcn0gdmlld3BvcnRPZmZzZXRcbiAqIEByZXR1cm4ge0Jvb2xlYW59XG4gKi9cbmNvbnN0IGdldEZpdHNPblRvcCA9IChyZWN0LCB2aWV3cG9ydE9mZnNldCkgPT4ge1xuICByZXR1cm4gcmVjdC50b3AgPiB2aWV3cG9ydE9mZnNldFxufVxuXG4vKipcbiAqIEZ1bmN0aW9uIHRoYXQgcmV0dXJucyBpZiBhIHJlY3QgZml0cyBvbiByaWdodC5cbiAqIEBwYXJhbSB7UmVjdH0gcmVjdFxuICogQHBhcmFtIHtPYmplY3R9IHZpZXdwb3J0XG4gKiBAcGFyYW0ge051bWJlcn0gdmlld3BvcnRPZmZzZXRcbiAqIEByZXR1cm4ge0Jvb2xlYW59XG4gKi9cbmNvbnN0IGdldEZpdHNPblJpZ2h0ID0gKHJlY3QsIHZpZXdwb3J0LCB2aWV3cG9ydE9mZnNldCkgPT4ge1xuICByZXR1cm4gcmVjdC5yaWdodCA8IHZpZXdwb3J0LndpZHRoIC0gdmlld3BvcnRPZmZzZXRcbn1cblxuLyoqXG4gKiBGdW5jdGlvbiB0aGF0IHJldHVybnMgaWYgYSByZWN0IGZpdHMgb24gbGVmdC5cbiAqIEBwYXJhbSB7UmVjdH0gcmVjdFxuICogQHBhcmFtIHtOdW1iZXJ9IHZpZXdwb3J0T2Zmc2V0XG4gKiBAcmV0dXJuIHtCb29sZWFufVxuICovXG5jb25zdCBnZXRGaXRzT25MZWZ0ID0gKHJlY3QsIHZpZXdwb3J0T2Zmc2V0KSA9PiB7XG4gIHJldHVybiByZWN0LmxlZnQgPiB2aWV3cG9ydE9mZnNldFxufVxuXG4vKipcbiAqIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0NTUy90cmFuc2Zvcm0tb3JpZ2luXG4gKiBGdW5jdGlvbiB0aGF0IHJldHVybnMgdGhlIENTUyBgdHJhbmZvcm0tb3JpZ2luYCBwcm9wZXJ0eS5cbiAqIEBwYXJhbSB7UmVjdH0gcmVjdFxuICogQHBhcmFtIHtQb3NpdGlvbn0gcG9zaXRpb25cbiAqIEBwYXJhbSB7T2JqZWN0fSBkaW1lbnNpb25zIOKAlCB0aGUgZGltZW5zaW9ucyBvZiB0aGUgcG9zaXRpb25lci5cbiAqIEBwYXJhbSB7TnVtYmVyfSB0YXJnZXRDZW50ZXIgLSBjZW50ZXIgb2YgdGhlIHRhcmdldC5cbiAqIEByZXR1cm4ge1N0cmluZ30gdHJhbnNmb3JtIG9yaWdpblxuICovXG5jb25zdCBnZXRUcmFuc2Zvcm1PcmlnaW4gPSAoeyBkaW1lbnNpb25zLCBwb3NpdGlvbiwgcmVjdCwgdGFyZ2V0Q2VudGVyIH0pID0+IHtcbiAgY29uc3QgY2VudGVyWSA9IE1hdGgucm91bmQodGFyZ2V0Q2VudGVyIC0gcmVjdC50b3ApXG5cbiAgaWYgKHBvc2l0aW9uID09PSBQb3NpdGlvbi5MRUZUKSB7XG4gICAgLyogU3ludGF4OiB4LW9mZnNldCB8IHktb2Zmc2V0ICovXG4gICAgcmV0dXJuIGAke2RpbWVuc2lvbnMud2lkdGh9cHggJHtjZW50ZXJZfXB4YFxuICB9XG5cbiAgaWYgKHBvc2l0aW9uID09PSBQb3NpdGlvbi5SSUdIVCkge1xuICAgIC8qIFN5bnRheDogeC1vZmZzZXQgfCB5LW9mZnNldCAqL1xuICAgIHJldHVybiBgMHB4ICR7Y2VudGVyWX1weGBcbiAgfVxuXG4gIGNvbnN0IGNlbnRlclggPSBNYXRoLnJvdW5kKHRhcmdldENlbnRlciAtIHJlY3QubGVmdClcblxuICBpZiAoaXNBbGlnbmVkT25Ub3AocG9zaXRpb24pKSB7XG4gICAgLyogU3ludGF4OiB4LW9mZnNldCB8IHktb2Zmc2V0ICovXG4gICAgcmV0dXJuIGAke2NlbnRlclh9cHggJHtkaW1lbnNpb25zLmhlaWdodH1weCBgXG4gIH1cblxuICAvKiBTeW50YXg6IHgtb2Zmc2V0IHwgeS1vZmZzZXQgKi9cbiAgcmV0dXJuIGAke2NlbnRlclh9cHggMHB4IGBcbn1cblxuLyoqXG4gKiBGdW5jdGlvbiB0aGF0IHRha2VzIGluIG51bWJlcnMgYW5kIHBvc2l0aW9uIGFuZCBnaXZlcyB0aGUgZmluYWwgY29vcmRzLlxuICogQHBhcmFtIHtQb3NpdGlvbn0gcG9zaXRpb24g4oCUIHRoZSBwb3NpdGlvbiB0aGUgcG9zaXRpb25lciBzaG91bGQgYmUgb24uXG4gKiBAcGFyYW0ge09iamVjdH0gZGltZW5zaW9ucyDigJQgdGhlIGRpbWVuc2lvbnMgb2YgdGhlIHBvc2l0aW9uZXIuXG4gKiBAcGFyYW0ge1JlY3R9IHRhcmdldFJlY3Qg4oCUIHRoZSByZWN0IG9mIHRoZSB0YXJnZXQuXG4gKiBAcGFyYW0ge051bWJlcn0gdGFyZ2V0T2Zmc2V0IC0gb2Zmc2V0IGZyb20gdGhlIHRhcmdldC5cbiAqIEBwYXJhbSB7T2JqZWN0fSB2aWV3cG9ydCAtIHRoZSB3aWR0aCBhbmQgaGVpZ2h0IG9mIHRoZSB2aWV3cG9ydC5cbiAqIEBwYXJhbSB7TnVtYmVyfSB2aWV3cG9ydE9mZnNldCAtIG9mZnNldCBmcm9tIHRoZSB2aWV3cG9ydC5cbiAqIEByZXR1cm4ge09iamVjdH0gLSB7IHJlY3Q6IFJlY3QsIHBvc2l0aW9uOiBQb3NpdGlvbiwgdHJhbnNmb3JtT3JpZ2luOiBzdHJpbmcgfVxuICovXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBnZXRGaXR0ZWRQb3NpdGlvbih7XG4gIGRpbWVuc2lvbnMsXG4gIHBvc2l0aW9uLFxuICB0YXJnZXRPZmZzZXQsXG4gIHRhcmdldFJlY3QsXG4gIHZpZXdwb3J0LFxuICB2aWV3cG9ydE9mZnNldCA9IDhcbn0pIHtcbiAgY29uc3QgeyBwb3NpdGlvbjogZmluYWxQb3NpdGlvbiwgcmVjdCB9ID0gZ2V0UG9zaXRpb24oe1xuICAgIHBvc2l0aW9uLFxuICAgIGRpbWVuc2lvbnMsXG4gICAgdGFyZ2V0UmVjdCxcbiAgICB0YXJnZXRPZmZzZXQsXG4gICAgdmlld3BvcnQsXG4gICAgdmlld3BvcnRPZmZzZXRcbiAgfSlcblxuICAvLyBQdXNoIHJlY3QgdG8gdGhlIHJpZ2h0IGlmIG92ZXJmbG93aW5nIG9uIHRoZSBsZWZ0IHNpZGUgb2YgdGhlIHZpZXdwb3J0LlxuICBpZiAocmVjdC5sZWZ0IDwgdmlld3BvcnRPZmZzZXQpIHtcbiAgICByZWN0LnJpZ2h0ICs9IE1hdGguY2VpbChNYXRoLmFicyhyZWN0LmxlZnQgLSB2aWV3cG9ydE9mZnNldCkpXG4gICAgcmVjdC5sZWZ0ID0gTWF0aC5jZWlsKHZpZXdwb3J0T2Zmc2V0KVxuICB9XG5cbiAgLy8gUHVzaCByZWN0IHRvIHRoZSBsZWZ0IGlmIG92ZXJmbG93aW5nIG9uIHRoZSByaWdodCBzaWRlIG9mIHRoZSB2aWV3cG9ydC5cbiAgaWYgKHJlY3QucmlnaHQgPiB2aWV3cG9ydC53aWR0aCAtIHZpZXdwb3J0T2Zmc2V0KSB7XG4gICAgY29uc3QgZGVsdGEgPSBNYXRoLmNlaWwocmVjdC5yaWdodCAtICh2aWV3cG9ydC53aWR0aCAtIHZpZXdwb3J0T2Zmc2V0KSlcbiAgICByZWN0LmxlZnQgLT0gZGVsdGFcbiAgICByZWN0LnJpZ2h0IC09IGRlbHRhXG4gIH1cblxuICAvLyBQdXNoIHJlY3QgZG93biBpZiBvdmVyZmxvd2luZyBvbiB0aGUgdG9wIHNpZGUgb2YgdGhlIHZpZXdwb3J0LlxuICBpZiAocmVjdC50b3AgPCB2aWV3cG9ydE9mZnNldCkge1xuICAgIHJlY3QudG9wICs9IE1hdGguY2VpbChNYXRoLmFicyhyZWN0LnRvcCAtIHZpZXdwb3J0T2Zmc2V0KSlcbiAgICByZWN0LmJvdHRvbSA9IE1hdGguY2VpbCh2aWV3cG9ydE9mZnNldClcbiAgfVxuXG4gIC8vIFB1c2ggcmVjdCB1cCBpZiBvdmVyZmxvd2luZyBvbiB0aGUgYm90dG9tIHNpZGUgb2YgdGhlIHZpZXdwb3J0LlxuICBpZiAocmVjdC5ib3R0b20gPiB2aWV3cG9ydC5oZWlnaHQgLSB2aWV3cG9ydE9mZnNldCkge1xuICAgIGNvbnN0IGRlbHRhID0gTWF0aC5jZWlsKHJlY3QuYm90dG9tIC0gKHZpZXdwb3J0LmhlaWdodCAtIHZpZXdwb3J0T2Zmc2V0KSlcbiAgICByZWN0LnRvcCAtPSBkZWx0YVxuICAgIHJlY3QuYm90dG9tIC09IGRlbHRhXG4gIH1cblxuICBjb25zdCB0YXJnZXRDZW50ZXIgPSBpc0FsaWduZWRIb3Jpem9udGFsKHBvc2l0aW9uKVxuICAgID8gdGFyZ2V0UmVjdC50b3AgKyB0YXJnZXRSZWN0LmhlaWdodCAvIDJcbiAgICA6IHRhcmdldFJlY3QubGVmdCArIHRhcmdldFJlY3Qud2lkdGggLyAyXG5cbiAgY29uc3QgdHJhbnNmb3JtT3JpZ2luID0gZ2V0VHJhbnNmb3JtT3JpZ2luKHtcbiAgICByZWN0LFxuICAgIHBvc2l0aW9uOiBmaW5hbFBvc2l0aW9uLFxuICAgIGRpbWVuc2lvbnMsXG4gICAgdGFyZ2V0Q2VudGVyXG4gIH0pXG5cbiAgcmV0dXJuIHtcbiAgICByZWN0LFxuICAgIHBvc2l0aW9uOiBmaW5hbFBvc2l0aW9uLFxuICAgIHRyYW5zZm9ybU9yaWdpblxuICB9XG59XG5cbi8qKlxuICogRnVuY3Rpb24gdGhhdCB0YWtlcyBpbiBudW1iZXJzIGFuZCBwb3NpdGlvbiBhbmQgZ2l2ZXMgdGhlIGZpbmFsIGNvb3Jkcy5cbiAqIEBwYXJhbSB7UG9zaXRpb259IHBvc2l0aW9uIOKAlCB0aGUgcG9zaXRpb24gdGhlIHBvc2l0aW9uZXIgc2hvdWxkIGJlIG9uLlxuICogQHBhcmFtIHtPYmplY3R9IGRpbWVuc2lvbnMg4oCUIHRoZSBkaW1lbnNpb25zIG9mIHRoZSBwb3NpdGlvbmVyLlxuICogQHBhcmFtIHtSZWN0fSB0YXJnZXRSZWN0IOKAlCB0aGUgcmVjdCBvZiB0aGUgdGFyZ2V0LlxuICogQHBhcmFtIHtOdW1iZXJ9IHRhcmdldE9mZnNldCAtIG9mZnNldCBmcm9tIHRoZSB0YXJnZXQuXG4gKiBAcGFyYW0ge09iamVjdH0gdmlld3BvcnQgLSB0aGUgd2lkdGggYW5kIGhlaWdodCBvZiB0aGUgdmlld3BvcnQuXG4gKiBAcGFyYW0ge09iamVjdH0gdmlld3BvcnRPZmZzZXQgLSBvZmZzZXQgZnJvbSB0aGUgdmlld3BvcnQuXG4gKiBAcmV0dXJuIHtPYmplY3R9IC0geyByZWN0OiBSZWN0LCBwb3NpdGlvbjogUG9zaXRpb24gfVxuICovXG5mdW5jdGlvbiBnZXRQb3NpdGlvbih7IGRpbWVuc2lvbnMsIHBvc2l0aW9uLCB0YXJnZXRPZmZzZXQsIHRhcmdldFJlY3QsIHZpZXdwb3J0LCB2aWV3cG9ydE9mZnNldCA9IDggfSkge1xuICBjb25zdCBpc0hvcml6b250YWwgPSBpc0FsaWduZWRIb3Jpem9udGFsKHBvc2l0aW9uKVxuXG4gIC8vIEhhbmRsZSBsZWZ0IGFuZCByaWdodCBwb3NpdGlvbnNcbiAgaWYgKGlzSG9yaXpvbnRhbCkge1xuICAgIGNvbnN0IGxlZnRSZWN0ID0gZ2V0UmVjdCh7XG4gICAgICBwb3NpdGlvbjogUG9zaXRpb24uTEVGVCxcbiAgICAgIGRpbWVuc2lvbnMsXG4gICAgICB0YXJnZXRSZWN0LFxuICAgICAgdGFyZ2V0T2Zmc2V0XG4gICAgfSlcblxuICAgIGNvbnN0IHJpZ2h0UmVjdCA9IGdldFJlY3Qoe1xuICAgICAgcG9zaXRpb246IFBvc2l0aW9uLlJJR0hULFxuICAgICAgZGltZW5zaW9ucyxcbiAgICAgIHRhcmdldFJlY3QsXG4gICAgICB0YXJnZXRPZmZzZXRcbiAgICB9KVxuXG4gICAgY29uc3QgZml0c09uTGVmdCA9IGdldEZpdHNPbkxlZnQobGVmdFJlY3QsIHZpZXdwb3J0T2Zmc2V0KVxuICAgIGNvbnN0IGZpdHNPblJpZ2h0ID0gZ2V0Rml0c09uUmlnaHQocmlnaHRSZWN0LCB2aWV3cG9ydCwgdmlld3BvcnRPZmZzZXQpXG5cbiAgICBpZiAocG9zaXRpb24gPT09IFBvc2l0aW9uLkxFRlQpIHtcbiAgICAgIGlmIChmaXRzT25MZWZ0KSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgcG9zaXRpb24sXG4gICAgICAgICAgcmVjdDogbGVmdFJlY3RcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoZml0c09uUmlnaHQpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBwb3NpdGlvbjogUG9zaXRpb24uUklHSFQsXG4gICAgICAgICAgcmVjdDogcmlnaHRSZWN0XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAocG9zaXRpb24gPT09IFBvc2l0aW9uLlJJR0hUKSB7XG4gICAgICBpZiAoZml0c09uUmlnaHQpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBwb3NpdGlvbixcbiAgICAgICAgICByZWN0OiByaWdodFJlY3RcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoZml0c09uTGVmdCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHBvc2l0aW9uOiBQb3NpdGlvbi5MRUZULFxuICAgICAgICAgIHJlY3Q6IGxlZnRSZWN0XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBEZWZhdWx0IHRvIHVzaW5nIHRoZSBwb3NpdGlvbiB3aXRoIHRoZSBtb3N0IHNwYWNlXG4gICAgY29uc3Qgc3BhY2VSaWdodCA9IE1hdGguYWJzKHZpZXdwb3J0LndpZHRoIC0gdmlld3BvcnRPZmZzZXQgLSByaWdodFJlY3QucmlnaHQpXG4gICAgY29uc3Qgc3BhY2VMZWZ0ID0gTWF0aC5hYnMobGVmdFJlY3QubGVmdCAtIHZpZXdwb3J0T2Zmc2V0KVxuXG4gICAgaWYgKHNwYWNlUmlnaHQgPCBzcGFjZUxlZnQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHBvc2l0aW9uOiBQb3NpdGlvbi5SSUdIVCxcbiAgICAgICAgcmVjdDogcmlnaHRSZWN0XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHBvc2l0aW9uOiBQb3NpdGlvbi5MRUZULFxuICAgICAgcmVjdDogbGVmdFJlY3RcbiAgICB9XG4gIH1cblxuICBjb25zdCBwb3NpdGlvbklzQWxpZ25lZE9uVG9wID0gaXNBbGlnbmVkT25Ub3AocG9zaXRpb24pXG4gIGxldCB0b3BSZWN0XG4gIGxldCBib3R0b21SZWN0XG5cbiAgaWYgKHBvc2l0aW9uSXNBbGlnbmVkT25Ub3ApIHtcbiAgICB0b3BSZWN0ID0gZ2V0UmVjdCh7XG4gICAgICBwb3NpdGlvbixcbiAgICAgIGRpbWVuc2lvbnMsXG4gICAgICB0YXJnZXRSZWN0LFxuICAgICAgdGFyZ2V0T2Zmc2V0XG4gICAgfSlcbiAgICBib3R0b21SZWN0ID0gZ2V0UmVjdCh7XG4gICAgICBwb3NpdGlvbjogZmxpcEhvcml6b250YWwocG9zaXRpb24pLFxuICAgICAgZGltZW5zaW9ucyxcbiAgICAgIHRhcmdldFJlY3QsXG4gICAgICB0YXJnZXRPZmZzZXRcbiAgICB9KVxuICB9IGVsc2Uge1xuICAgIHRvcFJlY3QgPSBnZXRSZWN0KHtcbiAgICAgIHBvc2l0aW9uOiBmbGlwSG9yaXpvbnRhbChwb3NpdGlvbiksXG4gICAgICBkaW1lbnNpb25zLFxuICAgICAgdGFyZ2V0UmVjdCxcbiAgICAgIHRhcmdldE9mZnNldFxuICAgIH0pXG4gICAgYm90dG9tUmVjdCA9IGdldFJlY3Qoe1xuICAgICAgcG9zaXRpb24sXG4gICAgICBkaW1lbnNpb25zLFxuICAgICAgdGFyZ2V0UmVjdCxcbiAgICAgIHRhcmdldE9mZnNldFxuICAgIH0pXG4gIH1cblxuICBjb25zdCB0b3BSZWN0Rml0c09uVG9wID0gZ2V0Rml0c09uVG9wKHRvcFJlY3QsIHZpZXdwb3J0T2Zmc2V0KVxuXG4gIGNvbnN0IGJvdHRvbVJlY3RGaXRzT25Cb3R0b20gPSBnZXRGaXRzT25Cb3R0b20oYm90dG9tUmVjdCwgdmlld3BvcnQsIHZpZXdwb3J0T2Zmc2V0KVxuXG4gIGlmIChwb3NpdGlvbklzQWxpZ25lZE9uVG9wKSB7XG4gICAgaWYgKHRvcFJlY3RGaXRzT25Ub3ApIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHBvc2l0aW9uLFxuICAgICAgICByZWN0OiB0b3BSZWN0XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGJvdHRvbVJlY3RGaXRzT25Cb3R0b20pIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHBvc2l0aW9uOiBmbGlwSG9yaXpvbnRhbChwb3NpdGlvbiksXG4gICAgICAgIHJlY3Q6IGJvdHRvbVJlY3RcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBpZiAoIXBvc2l0aW9uSXNBbGlnbmVkT25Ub3ApIHtcbiAgICBpZiAoYm90dG9tUmVjdEZpdHNPbkJvdHRvbSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcG9zaXRpb24sXG4gICAgICAgIHJlY3Q6IGJvdHRvbVJlY3RcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodG9wUmVjdEZpdHNPblRvcCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcG9zaXRpb246IGZsaXBIb3Jpem9udGFsKHBvc2l0aW9uKSxcbiAgICAgICAgcmVjdDogdG9wUmVjdFxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIERlZmF1bHQgdG8gbW9zdCBzcGFjaW91cyBpZiB0aGVyZSBpcyBubyBmaXQuXG4gIGNvbnN0IHNwYWNlQm90dG9tID0gTWF0aC5hYnModmlld3BvcnQuaGVpZ2h0IC0gdmlld3BvcnRPZmZzZXQgLSBib3R0b21SZWN0LmJvdHRvbSlcblxuICBjb25zdCBzcGFjZVRvcCA9IE1hdGguYWJzKHRvcFJlY3QudG9wIC0gdmlld3BvcnRPZmZzZXQpXG5cbiAgaWYgKHNwYWNlQm90dG9tIDwgc3BhY2VUb3ApIHtcbiAgICByZXR1cm4ge1xuICAgICAgcG9zaXRpb246IHBvc2l0aW9uSXNBbGlnbmVkT25Ub3AgPyBmbGlwSG9yaXpvbnRhbChwb3NpdGlvbikgOiBwb3NpdGlvbixcbiAgICAgIHJlY3Q6IGJvdHRvbVJlY3RcbiAgICB9XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHBvc2l0aW9uOiBwb3NpdGlvbklzQWxpZ25lZE9uVG9wID8gcG9zaXRpb24gOiBmbGlwSG9yaXpvbnRhbChwb3NpdGlvbiksXG4gICAgcmVjdDogdG9wUmVjdFxuICB9XG59XG5cbi8qKlxuICogRnVuY3Rpb24gdGhhdCB0YWtlcyBpbiBudW1iZXJzIGFuZCBwb3NpdGlvbiBhbmQgZ2l2ZXMgdGhlIGZpbmFsIGNvb3Jkcy5cbiAqIEBwYXJhbSB7UG9zaXRpb259IHBvc2l0aW9uXG4gKiBAcGFyYW0ge051bWJlcn0gdGFyZ2V0T2Zmc2V0IC0gb2Zmc2V0IGZyb20gdGhlIHRhcmdldC5cbiAqIEBwYXJhbSB7T2JqZWN0fSBkaW1lbnNpb25zIOKAlCB0aGUgZGltZW5zaW9ucyBvZiB0aGUgcG9zaXRpb25lci5cbiAqIEBwYXJhbSB7UmVjdH0gdGFyZ2V0UmVjdCDigJQgdGhlIHJlY3Qgb2YgdGhlIHRhcmdldC5cbiAqIEByZXR1cm4ge1JlY3R9IC0gUmVjdCB7IHdpZHRoLCBoZWlnaHQsIGxlZnQsIHRvcCwgcmlnaHQsIGJvdHRvbSB9XG4gKi9cbmZ1bmN0aW9uIGdldFJlY3QoeyBkaW1lbnNpb25zLCBwb3NpdGlvbiwgdGFyZ2V0T2Zmc2V0LCB0YXJnZXRSZWN0IH0pIHtcbiAgY29uc3QgbGVmdFJlY3QgPSB0YXJnZXRSZWN0LmxlZnQgKyB0YXJnZXRSZWN0LndpZHRoIC8gMiAtIGRpbWVuc2lvbnMud2lkdGggLyAyXG4gIGNvbnN0IGFsaWduZWRUb3BZID0gdGFyZ2V0UmVjdC50b3AgLSBkaW1lbnNpb25zLmhlaWdodCAtIHRhcmdldE9mZnNldFxuICBjb25zdCBhbGlnbmVkQm90dG9tWSA9IHRhcmdldFJlY3QuYm90dG9tICsgdGFyZ2V0T2Zmc2V0XG4gIGNvbnN0IGFsaWduZWRSaWdodFggPSB0YXJnZXRSZWN0LnJpZ2h0IC0gZGltZW5zaW9ucy53aWR0aFxuICBjb25zdCBhbGlnbmVkTGVmdFJpZ2h0WSA9IHRhcmdldFJlY3QudG9wICsgdGFyZ2V0UmVjdC5oZWlnaHQgLyAyIC0gZGltZW5zaW9ucy5oZWlnaHQgLyAyXG5cbiAgc3dpdGNoIChwb3NpdGlvbikge1xuICAgIGNhc2UgUG9zaXRpb24uTEVGVDpcbiAgICAgIHJldHVybiBtYWtlUmVjdChkaW1lbnNpb25zLCB7XG4gICAgICAgIGxlZnQ6IHRhcmdldFJlY3QubGVmdCAtIGRpbWVuc2lvbnMud2lkdGggLSB0YXJnZXRPZmZzZXQsXG4gICAgICAgIHRvcDogYWxpZ25lZExlZnRSaWdodFlcbiAgICAgIH0pXG4gICAgY2FzZSBQb3NpdGlvbi5SSUdIVDpcbiAgICAgIHJldHVybiBtYWtlUmVjdChkaW1lbnNpb25zLCB7XG4gICAgICAgIGxlZnQ6IHRhcmdldFJlY3QucmlnaHQgKyB0YXJnZXRPZmZzZXQsXG4gICAgICAgIHRvcDogYWxpZ25lZExlZnRSaWdodFlcbiAgICAgIH0pXG4gICAgY2FzZSBQb3NpdGlvbi5UT1A6XG4gICAgICByZXR1cm4gbWFrZVJlY3QoZGltZW5zaW9ucywge1xuICAgICAgICBsZWZ0OiBsZWZ0UmVjdCxcbiAgICAgICAgdG9wOiBhbGlnbmVkVG9wWVxuICAgICAgfSlcbiAgICBjYXNlIFBvc2l0aW9uLlRPUF9MRUZUOlxuICAgICAgcmV0dXJuIG1ha2VSZWN0KGRpbWVuc2lvbnMsIHtcbiAgICAgICAgbGVmdDogdGFyZ2V0UmVjdC5sZWZ0LFxuICAgICAgICB0b3A6IGFsaWduZWRUb3BZXG4gICAgICB9KVxuICAgIGNhc2UgUG9zaXRpb24uVE9QX1JJR0hUOlxuICAgICAgcmV0dXJuIG1ha2VSZWN0KGRpbWVuc2lvbnMsIHtcbiAgICAgICAgbGVmdDogYWxpZ25lZFJpZ2h0WCxcbiAgICAgICAgdG9wOiBhbGlnbmVkVG9wWVxuICAgICAgfSlcbiAgICBkZWZhdWx0OlxuICAgIGNhc2UgUG9zaXRpb24uQk9UVE9NOlxuICAgICAgcmV0dXJuIG1ha2VSZWN0KGRpbWVuc2lvbnMsIHtcbiAgICAgICAgbGVmdDogbGVmdFJlY3QsXG4gICAgICAgIHRvcDogYWxpZ25lZEJvdHRvbVlcbiAgICAgIH0pXG4gICAgY2FzZSBQb3NpdGlvbi5CT1RUT01fTEVGVDpcbiAgICAgIHJldHVybiBtYWtlUmVjdChkaW1lbnNpb25zLCB7XG4gICAgICAgIGxlZnQ6IHRhcmdldFJlY3QubGVmdCxcbiAgICAgICAgdG9wOiBhbGlnbmVkQm90dG9tWVxuICAgICAgfSlcbiAgICBjYXNlIFBvc2l0aW9uLkJPVFRPTV9SSUdIVDpcbiAgICAgIHJldHVybiBtYWtlUmVjdChkaW1lbnNpb25zLCB7XG4gICAgICAgIGxlZnQ6IGFsaWduZWRSaWdodFgsXG4gICAgICAgIHRvcDogYWxpZ25lZEJvdHRvbVlcbiAgICAgIH0pXG4gIH1cbn1cbiJdfQ==
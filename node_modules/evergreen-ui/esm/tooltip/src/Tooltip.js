import _extends from "@babel/runtime/helpers/esm/extends";
import _defineProperty from "@babel/runtime/helpers/esm/defineProperty";
import _objectWithoutProperties from "@babel/runtime/helpers/esm/objectWithoutProperties";
import _slicedToArray from "@babel/runtime/helpers/esm/slicedToArray";
var _excluded = ["getTargetRef", "isShown"];

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

import React, { memo, useState, useEffect, useRef } from 'react';
import cx from 'classnames';
import { css as glamorCss } from 'glamor';
import debounce from 'lodash.debounce';
import PropTypes from 'prop-types';
import { Position } from '../../constants';
import { useId } from '../../hooks';
import { Positioner } from '../../positioner';
import TooltipStateless from './TooltipStateless';
var emptyProps = {};
var Tooltip = /*#__PURE__*/memo(function Tooltip(props) {
  var _props$appearance = props.appearance,
      appearance = _props$appearance === void 0 ? 'default' : _props$appearance,
      _props$position = props.position,
      position = _props$position === void 0 ? Position.BOTTOM : _props$position,
      content = props.content,
      _props$hideDelay = props.hideDelay,
      hideDelay = _props$hideDelay === void 0 ? 120 : _props$hideDelay,
      _props$showDelay = props.showDelay,
      showDelay = _props$showDelay === void 0 ? 0 : _props$showDelay,
      propIsShown = props.isShown,
      children = props.children,
      _props$statelessProps = props.statelessProps,
      statelessProps = _props$statelessProps === void 0 ? emptyProps : _props$statelessProps;
  var id = useId('evergreen-tooltip');

  var _useState = useState(propIsShown || false),
      _useState2 = _slicedToArray(_useState, 2),
      isShown = _useState2[0],
      setIsShown = _useState2[1];

  var _useState3 = useState(false),
      _useState4 = _slicedToArray(_useState3, 2),
      isShownByTarget = _useState4[0],
      setIsShownByTarget = _useState4[1];

  var closeTimer = useRef(undefined);

  var mouseLeftTarget = function mouseLeftTarget() {
    setIsShownByTarget(false);
  };

  var handleMouseLeaveTarget = debounce(mouseLeftTarget, hideDelay);

  var hide = function hide() {
    setIsShown(false); // Clean up any timeouts that may have been triggered from `showDelay`

    clearTimeout(closeTimer.current);
  };

  var handleHide = debounce(hide, hideDelay); // Component will unmount

  useEffect(function () {
    return function () {
      clearTimeout(closeTimer.current);
    };
  }, []);

  var show = function show() {
    if (isShown) return;

    if (!showDelay) {
      setIsShown(true);
      return;
    }

    clearTimeout(closeTimer.current);
    closeTimer.current = setTimeout(function () {
      setIsShown(true);
    }, showDelay);
  };

  var renderTarget = function renderTarget(_ref) {
    var getRef = _ref.getRef;
    var tooltipTargetProps = {
      onMouseEnter: show,
      onMouseLeave: handleHide,
      'aria-describedby': id
    };
    /**
     * Tooltips can be used within a Popover (not the other way around)
     * When a Tooltip is used within a Popover, the Popover passes
     * its props to the Tooltip in a `popoverProps` object.
     */
    // eslint-disable-next-line react/prop-types

    if (props.popoverProps) {
      var _props$popoverProps = props.popoverProps,
          getTargetRef = _props$popoverProps.getTargetRef,
          _isShown = _props$popoverProps.isShown,
          popoverTargetProps = _objectWithoutProperties(_props$popoverProps, _excluded);

      return /*#__PURE__*/React.cloneElement(children, _objectSpread(_objectSpread(_objectSpread({}, popoverTargetProps), tooltipTargetProps), {}, {
        ref: function ref(_ref2) {
          // Get the ref for the Tooltip.
          getRef(_ref2); // Pass the ref to the Popover.

          getTargetRef(_ref2);
        }
      }));
    }
    /**
     * With normal usage only the props for a Tooltip are passed to the target.
     */


    return /*#__PURE__*/React.cloneElement(children, _objectSpread(_objectSpread({}, tooltipTargetProps), {}, {
      ref: function ref(_ref3) {
        getRef(_ref3);
      }
    }));
  }; // eslint-disable-next-line react/prop-types


  var isPopoverShown = function isPopoverShown() {
    return props.popoverProps && props.popoverProps.isShown;
  };

  var handleMouseEnterTarget = function handleMouseEnterTarget() {
    setIsShownByTarget(true);
  };

  var shown = (propIsShown || isShown || isShownByTarget) && !isPopoverShown(); // Tooltip was explicitly set to not be shown

  if (propIsShown === false) {
    shown = false;
  }

  return /*#__PURE__*/React.createElement(Positioner, {
    target: renderTarget,
    isShown: shown,
    position: position,
    animationDuration: 160
  }, function (_ref4) {
    var css = _ref4.css,
        getRef = _ref4.getRef,
        state = _ref4.state,
        style = _ref4.style;
    return /*#__PURE__*/React.createElement(TooltipStateless, _extends({
      id: id,
      appearance: appearance,
      ref: getRef,
      "data-state": state,
      style: style,
      onMouseEnter: handleMouseEnterTarget,
      onMouseLeave: handleMouseLeaveTarget
    }, statelessProps, {
      className: cx(statelessProps.className, css ? glamorCss(css).toString() : undefined)
    }), content);
  });
});
Tooltip.propTypes = {
  /**
   * The appearance of the tooltip.
   */
  appearance: PropTypes.oneOf(['default', 'card']),

  /**
   * The position the Popover is on.
   */
  position: PropTypes.oneOf([Position.TOP, Position.TOP_LEFT, Position.TOP_RIGHT, Position.BOTTOM, Position.BOTTOM_LEFT, Position.BOTTOM_RIGHT, Position.LEFT, Position.RIGHT]),

  /**
   * The content of the Popover.
   */
  content: PropTypes.node,

  /**
   * Time in ms before hiding the Tooltip.
   */
  hideDelay: PropTypes.number,

  /**
   * Time in ms before showing the Tooltip.
   */
  showDelay: PropTypes.number,

  /**
   * When True, manually show the Tooltip.
   */
  isShown: PropTypes.bool,

  /**
   * The target button of the Tooltip.
   */
  children: PropTypes.node,

  /**
   * Properties passed through to the Tooltip.
   */
  statelessProps: PropTypes.object
};
export default Tooltip;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy90b29sdGlwL3NyYy9Ub29sdGlwLmpzIl0sIm5hbWVzIjpbIlJlYWN0IiwibWVtbyIsInVzZVN0YXRlIiwidXNlRWZmZWN0IiwidXNlUmVmIiwiY3giLCJjc3MiLCJnbGFtb3JDc3MiLCJkZWJvdW5jZSIsIlByb3BUeXBlcyIsIlBvc2l0aW9uIiwidXNlSWQiLCJQb3NpdGlvbmVyIiwiVG9vbHRpcFN0YXRlbGVzcyIsImVtcHR5UHJvcHMiLCJUb29sdGlwIiwicHJvcHMiLCJhcHBlYXJhbmNlIiwicG9zaXRpb24iLCJCT1RUT00iLCJjb250ZW50IiwiaGlkZURlbGF5Iiwic2hvd0RlbGF5IiwicHJvcElzU2hvd24iLCJpc1Nob3duIiwiY2hpbGRyZW4iLCJzdGF0ZWxlc3NQcm9wcyIsImlkIiwic2V0SXNTaG93biIsImlzU2hvd25CeVRhcmdldCIsInNldElzU2hvd25CeVRhcmdldCIsImNsb3NlVGltZXIiLCJ1bmRlZmluZWQiLCJtb3VzZUxlZnRUYXJnZXQiLCJoYW5kbGVNb3VzZUxlYXZlVGFyZ2V0IiwiaGlkZSIsImNsZWFyVGltZW91dCIsImN1cnJlbnQiLCJoYW5kbGVIaWRlIiwic2hvdyIsInNldFRpbWVvdXQiLCJyZW5kZXJUYXJnZXQiLCJnZXRSZWYiLCJ0b29sdGlwVGFyZ2V0UHJvcHMiLCJvbk1vdXNlRW50ZXIiLCJvbk1vdXNlTGVhdmUiLCJwb3BvdmVyUHJvcHMiLCJnZXRUYXJnZXRSZWYiLCJwb3BvdmVyVGFyZ2V0UHJvcHMiLCJjbG9uZUVsZW1lbnQiLCJyZWYiLCJpc1BvcG92ZXJTaG93biIsImhhbmRsZU1vdXNlRW50ZXJUYXJnZXQiLCJzaG93biIsInN0YXRlIiwic3R5bGUiLCJjbGFzc05hbWUiLCJ0b1N0cmluZyIsInByb3BUeXBlcyIsIm9uZU9mIiwiVE9QIiwiVE9QX0xFRlQiLCJUT1BfUklHSFQiLCJCT1RUT01fTEVGVCIsIkJPVFRPTV9SSUdIVCIsIkxFRlQiLCJSSUdIVCIsIm5vZGUiLCJudW1iZXIi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ZiB9IGZyb20gJ3JlYWN0J1xuaW1wb3J0IGN4IGZyb20gJ2NsYXNzbmFtZXMnXG5pbXBvcnQgeyBjc3MgYXMgZ2xhbW9yQ3NzIH0gZnJvbSAnZ2xhbW9yJ1xuaW1wb3J0IGRlYm91bmNlIGZyb20gJ2xvZGFzaC5kZWJvdW5jZSdcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcydcbmltcG9ydCB7IFBvc2l0aW9uIH0gZnJvbSAnLi4vLi4vY29uc3RhbnRzJ1xuaW1wb3J0IHsgdXNlSWQgfSBmcm9tICcuLi8uLi9ob29rcydcbmltcG9ydCB7IFBvc2l0aW9uZXIgfSBmcm9tICcuLi8uLi9wb3NpdGlvbmVyJ1xuaW1wb3J0IFRvb2x0aXBTdGF0ZWxlc3MgZnJvbSAnLi9Ub29sdGlwU3RhdGVsZXNzJ1xuXG5jb25zdCBlbXB0eVByb3BzID0ge31cblxuY29uc3QgVG9vbHRpcCA9IG1lbW8oZnVuY3Rpb24gVG9vbHRpcChwcm9wcykge1xuICBjb25zdCB7XG4gICAgYXBwZWFyYW5jZSA9ICdkZWZhdWx0JyxcbiAgICBwb3NpdGlvbiA9IFBvc2l0aW9uLkJPVFRPTSxcbiAgICBjb250ZW50LFxuICAgIGhpZGVEZWxheSA9IDEyMCxcbiAgICBzaG93RGVsYXkgPSAwLFxuICAgIGlzU2hvd246IHByb3BJc1Nob3duLFxuICAgIGNoaWxkcmVuLFxuICAgIHN0YXRlbGVzc1Byb3BzID0gZW1wdHlQcm9wc1xuICB9ID0gcHJvcHNcblxuICBjb25zdCBpZCA9IHVzZUlkKCdldmVyZ3JlZW4tdG9vbHRpcCcpXG4gIGNvbnN0IFtpc1Nob3duLCBzZXRJc1Nob3duXSA9IHVzZVN0YXRlKHByb3BJc1Nob3duIHx8IGZhbHNlKVxuICBjb25zdCBbaXNTaG93bkJ5VGFyZ2V0LCBzZXRJc1Nob3duQnlUYXJnZXRdID0gdXNlU3RhdGUoZmFsc2UpXG4gIGNvbnN0IGNsb3NlVGltZXIgPSB1c2VSZWYodW5kZWZpbmVkKVxuXG4gIGNvbnN0IG1vdXNlTGVmdFRhcmdldCA9ICgpID0+IHtcbiAgICBzZXRJc1Nob3duQnlUYXJnZXQoZmFsc2UpXG4gIH1cblxuICBjb25zdCBoYW5kbGVNb3VzZUxlYXZlVGFyZ2V0ID0gZGVib3VuY2UobW91c2VMZWZ0VGFyZ2V0LCBoaWRlRGVsYXkpXG5cbiAgY29uc3QgaGlkZSA9ICgpID0+IHtcbiAgICBzZXRJc1Nob3duKGZhbHNlKVxuICAgIC8vIENsZWFuIHVwIGFueSB0aW1lb3V0cyB0aGF0IG1heSBoYXZlIGJlZW4gdHJpZ2dlcmVkIGZyb20gYHNob3dEZWxheWBcbiAgICBjbGVhclRpbWVvdXQoY2xvc2VUaW1lci5jdXJyZW50KVxuICB9XG5cbiAgY29uc3QgaGFuZGxlSGlkZSA9IGRlYm91bmNlKGhpZGUsIGhpZGVEZWxheSlcblxuICAvLyBDb21wb25lbnQgd2lsbCB1bm1vdW50XG4gIHVzZUVmZmVjdChcbiAgICAoKSA9PiAoKSA9PiB7XG4gICAgICBjbGVhclRpbWVvdXQoY2xvc2VUaW1lci5jdXJyZW50KVxuICAgIH0sXG4gICAgW11cbiAgKVxuXG4gIGNvbnN0IHNob3cgPSAoKSA9PiB7XG4gICAgaWYgKGlzU2hvd24pIHJldHVyblxuXG4gICAgaWYgKCFzaG93RGVsYXkpIHtcbiAgICAgIHNldElzU2hvd24odHJ1ZSlcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIGNsZWFyVGltZW91dChjbG9zZVRpbWVyLmN1cnJlbnQpXG4gICAgY2xvc2VUaW1lci5jdXJyZW50ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBzZXRJc1Nob3duKHRydWUpXG4gICAgfSwgc2hvd0RlbGF5KVxuICB9XG5cbiAgY29uc3QgcmVuZGVyVGFyZ2V0ID0gKHsgZ2V0UmVmIH0pID0+IHtcbiAgICBjb25zdCB0b29sdGlwVGFyZ2V0UHJvcHMgPSB7XG4gICAgICBvbk1vdXNlRW50ZXI6IHNob3csXG4gICAgICBvbk1vdXNlTGVhdmU6IGhhbmRsZUhpZGUsXG4gICAgICAnYXJpYS1kZXNjcmliZWRieSc6IGlkXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVG9vbHRpcHMgY2FuIGJlIHVzZWQgd2l0aGluIGEgUG9wb3ZlciAobm90IHRoZSBvdGhlciB3YXkgYXJvdW5kKVxuICAgICAqIFdoZW4gYSBUb29sdGlwIGlzIHVzZWQgd2l0aGluIGEgUG9wb3ZlciwgdGhlIFBvcG92ZXIgcGFzc2VzXG4gICAgICogaXRzIHByb3BzIHRvIHRoZSBUb29sdGlwIGluIGEgYHBvcG92ZXJQcm9wc2Agb2JqZWN0LlxuICAgICAqL1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC9wcm9wLXR5cGVzXG4gICAgaWYgKHByb3BzLnBvcG92ZXJQcm9wcykge1xuICAgICAgY29uc3Qge1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QvcHJvcC10eXBlc1xuICAgICAgICBnZXRUYXJnZXRSZWYsXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC9wcm9wLXR5cGVzXG4gICAgICAgIGlzU2hvd24sXG4gICAgICAgIC4uLnBvcG92ZXJUYXJnZXRQcm9wc1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QvcHJvcC10eXBlc1xuICAgICAgfSA9IHByb3BzLnBvcG92ZXJQcm9wc1xuXG4gICAgICByZXR1cm4gUmVhY3QuY2xvbmVFbGVtZW50KGNoaWxkcmVuLCB7XG4gICAgICAgIC8vIEFkZCB0aGUgUG9wb3ZlciBwcm9wcyB0byB0aGUgdGFyZ2V0LlxuICAgICAgICAuLi5wb3BvdmVyVGFyZ2V0UHJvcHMsXG4gICAgICAgIC8vIEFkZCB0aGUgVG9vbHRpcCBwcm9wcyB0byB0aGUgdGFyZ2V0LlxuICAgICAgICAuLi50b29sdGlwVGFyZ2V0UHJvcHMsXG5cbiAgICAgICAgcmVmOiByZWYgPT4ge1xuICAgICAgICAgIC8vIEdldCB0aGUgcmVmIGZvciB0aGUgVG9vbHRpcC5cbiAgICAgICAgICBnZXRSZWYocmVmKVxuICAgICAgICAgIC8vIFBhc3MgdGhlIHJlZiB0byB0aGUgUG9wb3Zlci5cbiAgICAgICAgICBnZXRUYXJnZXRSZWYocmVmKVxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFdpdGggbm9ybWFsIHVzYWdlIG9ubHkgdGhlIHByb3BzIGZvciBhIFRvb2x0aXAgYXJlIHBhc3NlZCB0byB0aGUgdGFyZ2V0LlxuICAgICAqL1xuICAgIHJldHVybiBSZWFjdC5jbG9uZUVsZW1lbnQoY2hpbGRyZW4sIHtcbiAgICAgIC4uLnRvb2x0aXBUYXJnZXRQcm9wcyxcbiAgICAgIHJlZjogcmVmID0+IHtcbiAgICAgICAgZ2V0UmVmKHJlZilcbiAgICAgIH1cbiAgICB9KVxuICB9XG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0L3Byb3AtdHlwZXNcbiAgY29uc3QgaXNQb3BvdmVyU2hvd24gPSAoKSA9PiBwcm9wcy5wb3BvdmVyUHJvcHMgJiYgcHJvcHMucG9wb3ZlclByb3BzLmlzU2hvd25cblxuICBjb25zdCBoYW5kbGVNb3VzZUVudGVyVGFyZ2V0ID0gKCkgPT4ge1xuICAgIHNldElzU2hvd25CeVRhcmdldCh0cnVlKVxuICB9XG5cbiAgbGV0IHNob3duID0gKHByb3BJc1Nob3duIHx8IGlzU2hvd24gfHwgaXNTaG93bkJ5VGFyZ2V0KSAmJiAhaXNQb3BvdmVyU2hvd24oKVxuXG4gIC8vIFRvb2x0aXAgd2FzIGV4cGxpY2l0bHkgc2V0IHRvIG5vdCBiZSBzaG93blxuICBpZiAocHJvcElzU2hvd24gPT09IGZhbHNlKSB7XG4gICAgc2hvd24gPSBmYWxzZVxuICB9XG5cbiAgcmV0dXJuIChcbiAgICA8UG9zaXRpb25lciB0YXJnZXQ9e3JlbmRlclRhcmdldH0gaXNTaG93bj17c2hvd259IHBvc2l0aW9uPXtwb3NpdGlvbn0gYW5pbWF0aW9uRHVyYXRpb249ezE2MH0+XG4gICAgICB7KHsgY3NzLCBnZXRSZWYsIHN0YXRlLCBzdHlsZSB9KSA9PiAoXG4gICAgICAgIDxUb29sdGlwU3RhdGVsZXNzXG4gICAgICAgICAgaWQ9e2lkfVxuICAgICAgICAgIGFwcGVhcmFuY2U9e2FwcGVhcmFuY2V9XG4gICAgICAgICAgcmVmPXtnZXRSZWZ9XG4gICAgICAgICAgZGF0YS1zdGF0ZT17c3RhdGV9XG4gICAgICAgICAgc3R5bGU9e3N0eWxlfVxuICAgICAgICAgIG9uTW91c2VFbnRlcj17aGFuZGxlTW91c2VFbnRlclRhcmdldH1cbiAgICAgICAgICBvbk1vdXNlTGVhdmU9e2hhbmRsZU1vdXNlTGVhdmVUYXJnZXR9XG4gICAgICAgICAgey4uLnN0YXRlbGVzc1Byb3BzfVxuICAgICAgICAgIGNsYXNzTmFtZT17Y3goc3RhdGVsZXNzUHJvcHMuY2xhc3NOYW1lLCBjc3MgPyBnbGFtb3JDc3MoY3NzKS50b1N0cmluZygpIDogdW5kZWZpbmVkKX1cbiAgICAgICAgPlxuICAgICAgICAgIHtjb250ZW50fVxuICAgICAgICA8L1Rvb2x0aXBTdGF0ZWxlc3M+XG4gICAgICApfVxuICAgIDwvUG9zaXRpb25lcj5cbiAgKVxufSlcblxuVG9vbHRpcC5wcm9wVHlwZXMgPSB7XG4gIC8qKlxuICAgKiBUaGUgYXBwZWFyYW5jZSBvZiB0aGUgdG9vbHRpcC5cbiAgICovXG4gIGFwcGVhcmFuY2U6IFByb3BUeXBlcy5vbmVPZihbJ2RlZmF1bHQnLCAnY2FyZCddKSxcblxuICAvKipcbiAgICogVGhlIHBvc2l0aW9uIHRoZSBQb3BvdmVyIGlzIG9uLlxuICAgKi9cbiAgcG9zaXRpb246IFByb3BUeXBlcy5vbmVPZihbXG4gICAgUG9zaXRpb24uVE9QLFxuICAgIFBvc2l0aW9uLlRPUF9MRUZULFxuICAgIFBvc2l0aW9uLlRPUF9SSUdIVCxcbiAgICBQb3NpdGlvbi5CT1RUT00sXG4gICAgUG9zaXRpb24uQk9UVE9NX0xFRlQsXG4gICAgUG9zaXRpb24uQk9UVE9NX1JJR0hULFxuICAgIFBvc2l0aW9uLkxFRlQsXG4gICAgUG9zaXRpb24uUklHSFRcbiAgXSksXG5cbiAgLyoqXG4gICAqIFRoZSBjb250ZW50IG9mIHRoZSBQb3BvdmVyLlxuICAgKi9cbiAgY29udGVudDogUHJvcFR5cGVzLm5vZGUsXG5cbiAgLyoqXG4gICAqIFRpbWUgaW4gbXMgYmVmb3JlIGhpZGluZyB0aGUgVG9vbHRpcC5cbiAgICovXG4gIGhpZGVEZWxheTogUHJvcFR5cGVzLm51bWJlcixcblxuICAvKipcbiAgICogVGltZSBpbiBtcyBiZWZvcmUgc2hvd2luZyB0aGUgVG9vbHRpcC5cbiAgICovXG4gIHNob3dEZWxheTogUHJvcFR5cGVzLm51bWJlcixcblxuICAvKipcbiAgICogV2hlbiBUcnVlLCBtYW51YWxseSBzaG93IHRoZSBUb29sdGlwLlxuICAgKi9cbiAgaXNTaG93bjogUHJvcFR5cGVzLmJvb2wsXG5cbiAgLyoqXG4gICAqIFRoZSB0YXJnZXQgYnV0dG9uIG9mIHRoZSBUb29sdGlwLlxuICAgKi9cbiAgY2hpbGRyZW46IFByb3BUeXBlcy5ub2RlLFxuXG4gIC8qKlxuICAgKiBQcm9wZXJ0aWVzIHBhc3NlZCB0aHJvdWdoIHRvIHRoZSBUb29sdGlwLlxuICAgKi9cbiAgc3RhdGVsZXNzUHJvcHM6IFByb3BUeXBlcy5vYmplY3Rcbn1cblxuZXhwb3J0IGRlZmF1bHQgVG9vbHRpcFxuIl19
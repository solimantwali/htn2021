import _slicedToArray from "@babel/runtime/helpers/esm/slicedToArray";
import React, { memo, useMemo, useRef, useState, useEffect, useCallback } from 'react';
import { css } from 'glamor';
import PropTypes from 'prop-types';
import { Transition } from 'react-transition-group';
import Box from 'ui-box';
import Alert from '../../alert/src/Alert';
var animationEasing = {
  deceleration: 'cubic-bezier(0.0, 0.0, 0.2, 1)',
  acceleration: 'cubic-bezier(0.4, 0.0, 1, 1)',
  spring: 'cubic-bezier(0.175, 0.885, 0.320, 1.175)'
};
var ANIMATION_DURATION = 240;
var openAnimation = css.keyframes('openAnimation', {
  from: {
    opacity: 0,
    transform: 'translateY(-120%)'
  },
  to: {
    transform: 'translateY(0)'
  }
});
var closeAnimation = css.keyframes('closeAnimation', {
  from: {
    transform: 'scale(1)',
    opacity: 1
  },
  to: {
    transform: 'scale(0.9)',
    opacity: 0
  }
});
var animationStyles = css({
  display: 'flex',
  flexDirection: 'column',
  alignItems: 'center',
  height: 0,
  transition: "all ".concat(ANIMATION_DURATION, "ms ").concat(animationEasing.deceleration),
  '&[data-state="entering"], &[data-state="entered"]': {
    animation: "".concat(openAnimation, " ").concat(ANIMATION_DURATION, "ms ").concat(animationEasing.spring, " both")
  },
  '&[data-state="exiting"]': {
    animation: "".concat(closeAnimation, " 120ms ").concat(animationEasing.acceleration, " both")
  }
});
var Toast = /*#__PURE__*/memo(function Toast(props) {
  var children = props.children,
      duration = props.duration,
      hasCloseButton = props.hasCloseButton,
      _props$intent = props.intent,
      intent = _props$intent === void 0 ? 'none' : _props$intent,
      isShownProp = props.isShown,
      onRemove = props.onRemove,
      title = props.title,
      zIndex = props.zIndex;
  var transitionRef = useRef(null);

  var _useState = useState(true),
      _useState2 = _slicedToArray(_useState, 2),
      isShown = _useState2[0],
      setIsShown = _useState2[1];

  var _useState3 = useState(0),
      _useState4 = _slicedToArray(_useState3, 2),
      height = _useState4[0],
      setHeight = _useState4[1];

  var closeTimer = useRef(null);
  var clearCloseTimer = useCallback(function () {
    if (closeTimer.current) {
      clearTimeout(closeTimer.current);
      closeTimer.current = null;
    }
  }, []);
  var close = useCallback(function () {
    clearCloseTimer();
    setIsShown(false);
  }, [clearCloseTimer]);
  var startCloseTimer = useCallback(function () {
    if (duration) {
      clearCloseTimer();
      closeTimer.current = setTimeout(function () {
        close();
      }, duration * 1000);
    }
  }, [duration, clearCloseTimer, close]);
  useEffect(function () {
    startCloseTimer();
    return function () {
      clearCloseTimer();
    };
  }, [startCloseTimer, clearCloseTimer]);
  useEffect(function () {
    if (isShownProp !== isShown && typeof isShownProp === 'boolean') {
      setIsShown(isShownProp);
    }
  }, [isShown, isShownProp]);
  var handleMouseEnter = useCallback(function () {
    return clearCloseTimer();
  }, [clearCloseTimer]);
  var handleMouseLeave = useCallback(function () {
    return startCloseTimer();
  }, [startCloseTimer]);
  var onRef = useCallback(function (ref) {
    if (ref === null) return;

    var _ref$getBoundingClien = ref.getBoundingClientRect(),
        rectHeight = _ref$getBoundingClien.height;

    setHeight(rectHeight);
  }, []);
  var styles = useMemo(function () {
    return {
      height: height,
      zIndex: zIndex,
      marginBottom: isShown ? 0 : -height
    };
  }, [isShown, height, zIndex]);
  return /*#__PURE__*/React.createElement(Transition, {
    nodeRef: transitionRef,
    appear: true,
    unmountOnExit: true,
    timeout: ANIMATION_DURATION,
    "in": isShown,
    onExited: onRemove
  }, function (state) {
    return /*#__PURE__*/React.createElement("div", {
      ref: transitionRef,
      "data-state": state,
      className: animationStyles,
      onMouseEnter: handleMouseEnter,
      onMouseLeave: handleMouseLeave,
      style: styles
    }, /*#__PURE__*/React.createElement(Box, {
      ref: onRef,
      padding: 8
    }, /*#__PURE__*/React.createElement(Alert, {
      flexShrink: 0,
      appearance: "card",
      elevation: 3,
      intent: intent,
      title: title,
      isRemoveable: hasCloseButton,
      onRemove: close,
      pointerEvents: "all"
    }, children)));
  });
});
Toast.propTypes = {
  /**
   * The z-index of the toast.
   */
  zIndex: PropTypes.number,

  /**
   * Duration of the toast.
   */
  duration: PropTypes.number,

  /**
   * Function called when the toast is all the way closed.
   */
  onRemove: PropTypes.func,

  /**
   * The type of the alert.
   */
  intent: PropTypes.oneOf(['none', 'success', 'warning', 'danger']),

  /**
   * The title of the alert.
   */
  title: PropTypes.node,

  /**
   * Description of the alert.
   */
  children: PropTypes.node,

  /**
   * When true, show a close icon button inside of the toast.
   */
  hasCloseButton: PropTypes.bool,

  /**
   * When false, will close the Toast and call onRemove when finished.
   */
  isShown: PropTypes.bool
};
export default Toast;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy90b2FzdGVyL3NyYy9Ub2FzdC5qcyJdLCJuYW1lcyI6WyJSZWFjdCIsIm1lbW8iLCJ1c2VNZW1vIiwidXNlUmVmIiwidXNlU3RhdGUiLCJ1c2VFZmZlY3QiLCJ1c2VDYWxsYmFjayIsImNzcyIsIlByb3BUeXBlcyIsIlRyYW5zaXRpb24iLCJCb3giLCJBbGVydCIsImFuaW1hdGlvbkVhc2luZyIsImRlY2VsZXJhdGlvbiIsImFjY2VsZXJhdGlvbiIsInNwcmluZyIsIkFOSU1BVElPTl9EVVJBVElPTiIsIm9wZW5BbmltYXRpb24iLCJrZXlmcmFtZXMiLCJmcm9tIiwib3BhY2l0eSIsInRyYW5zZm9ybSIsInRvIiwiY2xvc2VBbmltYXRpb24iLCJhbmltYXRpb25TdHlsZXMiLCJkaXNwbGF5IiwiZmxleERpcmVjdGlvbiIsImFsaWduSXRlbXMiLCJoZWlnaHQiLCJ0cmFuc2l0aW9uIiwiYW5pbWF0aW9uIiwiVG9hc3QiLCJwcm9wcyIsImNoaWxkcmVuIiwiZHVyYXRpb24iLCJoYXNDbG9zZUJ1dHRvbiIsImludGVudCIsImlzU2hvd25Qcm9wIiwiaXNTaG93biIsIm9uUmVtb3ZlIiwidGl0bGUiLCJ6SW5kZXgiLCJ0cmFuc2l0aW9uUmVmIiwic2V0SXNTaG93biIsInNldEhlaWdodCIsImNsb3NlVGltZXIiLCJjbGVhckNsb3NlVGltZXIiLCJjdXJyZW50IiwiY2xlYXJUaW1lb3V0IiwiY2xvc2UiLCJzdGFydENsb3NlVGltZXIiLCJzZXRUaW1lb3V0IiwiaGFuZGxlTW91c2VFbnRlciIsImhhbmRsZU1vdXNlTGVhdmUiLCJvblJlZiIsInJlZiIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsInJlY3RIZWlnaHQiLCJzdHlsZXMiLCJtYXJnaW5Cb3R0b20iLCJzdGF0ZSIsInByb3BUeXBlcyIsIm51bWJlciIsImZ1bmMiLCJvbmVPZiIsIm5vZGUiLCJib29sIl0sIm1hcHBpbmdzIjoiO0FBQUEsT0FBT0EsS0FBUCxJQUFnQkMsSUFBaEIs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aEI7QUFDRjtBQUNBO0FBQ0U5QixFQUFBQSxjQUFjLEVBQUUzQixTQUFTLENBQUMwRCxJQWxDVjs7QUFvQ2hCO0FBQ0Y7QUFDQTtBQUNFNUIsRUFBQUEsT0FBTyxFQUFFOUIsU0FBUyxDQUFDMEQ7QUF2Q0gsQ0FBbEI7QUEwQ0EsZUFBZW5DLEtBQWYiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgbWVtbywgdXNlTWVtbywgdXNlUmVmLCB1c2VTdGF0ZSwgdXNlRWZmZWN0LCB1c2VDYWxsYmFjayB9IGZyb20gJ3JlYWN0J1xuaW1wb3J0IHsgY3NzIH0gZnJvbSAnZ2xhbW9yJ1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJ1xuaW1wb3J0IHsgVHJhbnNpdGlvbiB9IGZyb20gJ3JlYWN0LXRyYW5zaXRpb24tZ3JvdXAnXG5pbXBvcnQgQm94IGZyb20gJ3VpLWJveCdcbmltcG9ydCBBbGVydCBmcm9tICcuLi8uLi9hbGVydC9zcmMvQWxlcnQnXG5cbmNvbnN0IGFuaW1hdGlvbkVhc2luZyA9IHtcbiAgZGVjZWxlcmF0aW9uOiAnY3ViaWMtYmV6aWVyKDAuMCwgMC4wLCAwLjIsIDEpJyxcbiAgYWNjZWxlcmF0aW9uOiAnY3ViaWMtYmV6aWVyKDAuNCwgMC4wLCAxLCAxKScsXG4gIHNwcmluZzogJ2N1YmljLWJlemllcigwLjE3NSwgMC44ODUsIDAuMzIwLCAxLjE3NSknXG59XG5cbmNvbnN0IEFOSU1BVElPTl9EVVJBVElPTiA9IDI0MFxuXG5jb25zdCBvcGVuQW5pbWF0aW9uID0gY3NzLmtleWZyYW1lcygnb3BlbkFuaW1hdGlvbicsIHtcbiAgZnJvbToge1xuICAgIG9wYWNpdHk6IDAsXG4gICAgdHJhbnNmb3JtOiAndHJhbnNsYXRlWSgtMTIwJSknXG4gIH0sXG4gIHRvOiB7XG4gICAgdHJhbnNmb3JtOiAndHJhbnNsYXRlWSgwKSdcbiAgfVxufSlcblxuY29uc3QgY2xvc2VBbmltYXRpb24gPSBjc3Mua2V5ZnJhbWVzKCdjbG9zZUFuaW1hdGlvbicsIHtcbiAgZnJvbToge1xuICAgIHRyYW5zZm9ybTogJ3NjYWxlKDEpJyxcbiAgICBvcGFjaXR5OiAxXG4gIH0sXG4gIHRvOiB7XG4gICAgdHJhbnNmb3JtOiAnc2NhbGUoMC45KScsXG4gICAgb3BhY2l0eTogMFxuICB9XG59KVxuXG5jb25zdCBhbmltYXRpb25TdHlsZXMgPSBjc3Moe1xuICBkaXNwbGF5OiAnZmxleCcsXG4gIGZsZXhEaXJlY3Rpb246ICdjb2x1bW4nLFxuICBhbGlnbkl0ZW1zOiAnY2VudGVyJyxcbiAgaGVpZ2h0OiAwLFxuICB0cmFuc2l0aW9uOiBgYWxsICR7QU5JTUFUSU9OX0RVUkFUSU9OfW1zICR7YW5pbWF0aW9uRWFzaW5nLmRlY2VsZXJhdGlvbn1gLFxuICAnJltkYXRhLXN0YXRlPVwiZW50ZXJpbmdcIl0sICZbZGF0YS1zdGF0ZT1cImVudGVyZWRcIl0nOiB7XG4gICAgYW5pbWF0aW9uOiBgJHtvcGVuQW5pbWF0aW9ufSAke0FOSU1BVElPTl9EVVJBVElPTn1tcyAke2FuaW1hdGlvbkVhc2luZy5zcHJpbmd9IGJvdGhgXG4gIH0sXG4gICcmW2RhdGEtc3RhdGU9XCJleGl0aW5nXCJdJzoge1xuICAgIGFuaW1hdGlvbjogYCR7Y2xvc2VBbmltYXRpb259IDEyMG1zICR7YW5pbWF0aW9uRWFzaW5nLmFjY2VsZXJhdGlvbn0gYm90aGBcbiAgfVxufSlcblxuY29uc3QgVG9hc3QgPSBtZW1vKGZ1bmN0aW9uIFRvYXN0KHByb3BzKSB7XG4gIGNvbnN0IHtcbiAgICBjaGlsZHJlbixcbiAgICBkdXJhdGlvbixcbiAgICBoYXNDbG9zZUJ1dHRvbixcbiAgICAvLyBUZW1wbGF0ZSBwcm9wc1xuICAgIGludGVudCA9ICdub25lJyxcbiAgICBpc1Nob3duOiBpc1Nob3duUHJvcCxcbiAgICBvblJlbW92ZSxcbiAgICB0aXRsZSxcbiAgICB6SW5kZXhcbiAgfSA9IHByb3BzXG5cbiAgY29uc3QgdHJhbnNpdGlvblJlZiA9IHVzZVJlZihudWxsKVxuICBjb25zdCBbaXNTaG93biwgc2V0SXNTaG93bl0gPSB1c2VTdGF0ZSh0cnVlKVxuICBjb25zdCBbaGVpZ2h0LCBzZXRIZWlnaHRdID0gdXNlU3RhdGUoMClcbiAgY29uc3QgY2xvc2VUaW1lciA9IHVzZVJlZihudWxsKVxuXG4gIGNvbnN0IGNsZWFyQ2xvc2VUaW1lciA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBpZiAoY2xvc2VUaW1lci5jdXJyZW50KSB7XG4gICAgICBjbGVhclRpbWVvdXQoY2xvc2VUaW1lci5jdXJyZW50KVxuICAgICAgY2xvc2VUaW1lci5jdXJyZW50ID0gbnVsbFxuICAgIH1cbiAgfSwgW10pXG5cbiAgY29uc3QgY2xvc2UgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgY2xlYXJDbG9zZVRpbWVyKClcbiAgICBzZXRJc1Nob3duKGZhbHNlKVxuICB9LCBbY2xlYXJDbG9zZVRpbWVyXSlcblxuICBjb25zdCBzdGFydENsb3NlVGltZXIgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgaWYgKGR1cmF0aW9uKSB7XG4gICAgICBjbGVhckNsb3NlVGltZXIoKVxuICAgICAgY2xvc2VUaW1lci5jdXJyZW50ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIGNsb3NlKClcbiAgICAgIH0sIGR1cmF0aW9uICogMTAwMClcbiAgICB9XG4gIH0sIFtkdXJhdGlvbiwgY2xlYXJDbG9zZVRpbWVyLCBjbG9zZV0pXG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBzdGFydENsb3NlVGltZXIoKVxuXG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIGNsZWFyQ2xvc2VUaW1lcigpXG4gICAgfVxuICB9LCBbc3RhcnRDbG9zZVRpbWVyLCBjbGVhckNsb3NlVGltZXJdKVxuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKGlzU2hvd25Qcm9wICE9PSBpc1Nob3duICYmIHR5cGVvZiBpc1Nob3duUHJvcCA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICBzZXRJc1Nob3duKGlzU2hvd25Qcm9wKVxuICAgIH1cbiAgfSwgW2lzU2hvd24sIGlzU2hvd25Qcm9wXSlcblxuICBjb25zdCBoYW5kbGVNb3VzZUVudGVyID0gdXNlQ2FsbGJhY2soKCkgPT4gY2xlYXJDbG9zZVRpbWVyKCksIFtjbGVhckNsb3NlVGltZXJdKVxuICBjb25zdCBoYW5kbGVNb3VzZUxlYXZlID0gdXNlQ2FsbGJhY2soKCkgPT4gc3RhcnRDbG9zZVRpbWVyKCksIFtzdGFydENsb3NlVGltZXJdKVxuXG4gIGNvbnN0IG9uUmVmID0gdXNlQ2FsbGJhY2socmVmID0+IHtcbiAgICBpZiAocmVmID09PSBudWxsKSByZXR1cm5cblxuICAgIGNvbnN0IHsgaGVpZ2h0OiByZWN0SGVpZ2h0IH0gPSByZWYuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KClcbiAgICBzZXRIZWlnaHQocmVjdEhlaWdodClcbiAgfSwgW10pXG5cbiAgY29uc3Qgc3R5bGVzID0gdXNlTWVtbyhcbiAgICAoKSA9PiAoe1xuICAgICAgaGVpZ2h0LFxuICAgICAgekluZGV4LFxuICAgICAgbWFyZ2luQm90dG9tOiBpc1Nob3duID8gMCA6IC1oZWlnaHRcbiAgICB9KSxcbiAgICBbaXNTaG93biwgaGVpZ2h0LCB6SW5kZXhdXG4gIClcblxuICByZXR1cm4gKFxuICAgIDxUcmFuc2l0aW9uXG4gICAgICBub2RlUmVmPXt0cmFuc2l0aW9uUmVmfVxuICAgICAgYXBwZWFyXG4gICAgICB1bm1vdW50T25FeGl0XG4gICAgICB0aW1lb3V0PXtBTklNQVRJT05fRFVSQVRJT059XG4gICAgICBpbj17aXNTaG93bn1cbiAgICAgIG9uRXhpdGVkPXtvblJlbW92ZX1cbiAgICA+XG4gICAgICB7c3RhdGUgPT4gKFxuICAgICAgICA8ZGl2XG4gICAgICAgICAgcmVmPXt0cmFuc2l0aW9uUmVmfVxuICAgICAgICAgIGRhdGEtc3RhdGU9e3N0YXRlfVxuICAgICAgICAgIGNsYXNzTmFtZT17YW5pbWF0aW9uU3R5bGVzfVxuICAgICAgICAgIG9uTW91c2VFbnRlcj17aGFuZGxlTW91c2VFbnRlcn1cbiAgICAgICAgICBvbk1vdXNlTGVhdmU9e2hhbmRsZU1vdXNlTGVhdmV9XG4gICAgICAgICAgc3R5bGU9e3N0eWxlc31cbiAgICAgICAgPlxuICAgICAgICAgIDxCb3ggcmVmPXtvblJlZn0gcGFkZGluZz17OH0+XG4gICAgICAgICAgICA8QWxlcnRcbiAgICAgICAgICAgICAgZmxleFNocmluaz17MH1cbiAgICAgICAgICAgICAgYXBwZWFyYW5jZT1cImNhcmRcIlxuICAgICAgICAgICAgICBlbGV2YXRpb249ezN9XG4gICAgICAgICAgICAgIGludGVudD17aW50ZW50fVxuICAgICAgICAgICAgICB0aXRsZT17dGl0bGV9XG4gICAgICAgICAgICAgIGlzUmVtb3ZlYWJsZT17aGFzQ2xvc2VCdXR0b259XG4gICAgICAgICAgICAgIG9uUmVtb3ZlPXtjbG9zZX1cbiAgICAgICAgICAgICAgcG9pbnRlckV2ZW50cz1cImFsbFwiXG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIHtjaGlsZHJlbn1cbiAgICAgICAgICAgIDwvQWxlcnQ+XG4gICAgICAgICAgPC9Cb3g+XG4gICAgICAgIDwvZGl2PlxuICAgICAgKX1cbiAgICA8L1RyYW5zaXRpb24+XG4gIClcbn0pXG5cblRvYXN0LnByb3BUeXBlcyA9IHtcbiAgLyoqXG4gICAqIFRoZSB6LWluZGV4IG9mIHRoZSB0b2FzdC5cbiAgICovXG4gIHpJbmRleDogUHJvcFR5cGVzLm51bWJlcixcblxuICAvKipcbiAgICogRHVyYXRpb24gb2YgdGhlIHRvYXN0LlxuICAgKi9cbiAgZHVyYXRpb246IFByb3BUeXBlcy5udW1iZXIsXG5cbiAgLyoqXG4gICAqIEZ1bmN0aW9uIGNhbGxlZCB3aGVuIHRoZSB0b2FzdCBpcyBhbGwgdGhlIHdheSBjbG9zZWQuXG4gICAqL1xuICBvblJlbW92ZTogUHJvcFR5cGVzLmZ1bmMsXG5cbiAgLyoqXG4gICAqIFRoZSB0eXBlIG9mIHRoZSBhbGVydC5cbiAgICovXG4gIGludGVudDogUHJvcFR5cGVzLm9uZU9mKFsnbm9uZScsICdzdWNjZXNzJywgJ3dhcm5pbmcnLCAnZGFuZ2VyJ10pLFxuXG4gIC8qKlxuICAgKiBUaGUgdGl0bGUgb2YgdGhlIGFsZXJ0LlxuICAgKi9cbiAgdGl0bGU6IFByb3BUeXBlcy5ub2RlLFxuXG4gIC8qKlxuICAgKiBEZXNjcmlwdGlvbiBvZiB0aGUgYWxlcnQuXG4gICAqL1xuICBjaGlsZHJlbjogUHJvcFR5cGVzLm5vZGUsXG5cbiAgLyoqXG4gICAqIFdoZW4gdHJ1ZSwgc2hvdyBhIGNsb3NlIGljb24gYnV0dG9uIGluc2lkZSBvZiB0aGUgdG9hc3QuXG4gICAqL1xuICBoYXNDbG9zZUJ1dHRvbjogUHJvcFR5cGVzLmJvb2wsXG5cbiAgLyoqXG4gICAqIFdoZW4gZmFsc2UsIHdpbGwgY2xvc2UgdGhlIFRvYXN0IGFuZCBjYWxsIG9uUmVtb3ZlIHdoZW4gZmluaXNoZWQuXG4gICAqL1xuICBpc1Nob3duOiBQcm9wVHlwZXMuYm9vbFxufVxuXG5leHBvcnQgZGVmYXVsdCBUb2FzdFxuIl19
import _extends from "@babel/runtime/helpers/esm/extends";
import _defineProperty from "@babel/runtime/helpers/esm/defineProperty";
import _slicedToArray from "@babel/runtime/helpers/esm/slicedToArray";
import _objectWithoutProperties from "@babel/runtime/helpers/esm/objectWithoutProperties";
var _excluded = ["autocompleteProps", "buttonProps", "height", "initialSelectedItem", "inputProps", "isLoading", "itemToString", "items", "onChange", "openOnFocus", "placeholder", "selectedItem", "size", "width"];

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

import React, { memo, useState, useCallback } from 'react';
import PropTypes from 'prop-types';
import { dimensions, spacing, position, layout } from 'ui-box';
import { Autocomplete } from '../../autocomplete';
import { IconButton } from '../../buttons';
import { Group } from '../../group';
import { CaretDownIcon } from '../../icons';
import { TextInput } from '../../text-input';
var Combobox = /*#__PURE__*/memo(function Combobox(props) {
  var autocompleteProps = props.autocompleteProps,
      buttonProps = props.buttonProps,
      height = props.height,
      initialSelectedItem = props.initialSelectedItem,
      inputProps = props.inputProps,
      _props$isLoading = props.isLoading,
      isLoading = _props$isLoading === void 0 ? false : _props$isLoading,
      itemToString = props.itemToString,
      items = props.items,
      onChange = props.onChange,
      _props$openOnFocus = props.openOnFocus,
      openOnFocus = _props$openOnFocus === void 0 ? false : _props$openOnFocus,
      placeholder = props.placeholder,
      selectedItem = props.selectedItem,
      _props$size = props.size,
      size = _props$size === void 0 ? 'medium' : _props$size,
      _props$width = props.width,
      width = _props$width === void 0 ? 240 : _props$width,
      rest = _objectWithoutProperties(props, _excluded);

  var disabled = props.disabled || isLoading;

  var _useState = useState(false),
      _useState2 = _slicedToArray(_useState, 2),
      isOpenedByButton = _useState2[0],
      setIsOpenedByButton = _useState2[1];

  var handleStateChange = useCallback(function (changes, stateAndHelpers) {
    if (Object.prototype.hasOwnProperty.call(changes, 'isOpen')) {
      if (!changes.isOpen) {
        setIsOpenedByButton(false);
      }
    }

    if (autocompleteProps && typeof autocompleteProps.onStateChange === 'function') {
      autocompleteProps.onStateChange(changes, stateAndHelpers);
    }
  }, [autocompleteProps]);
  return /*#__PURE__*/React.createElement(Autocomplete, _extends({
    items: items,
    selectedItem: selectedItem,
    initialSelectedItem: initialSelectedItem,
    itemToString: itemToString,
    onChange: onChange,
    isFilterDisabled: isOpenedByButton
  }, autocompleteProps, {
    onStateChange: handleStateChange
  }), function (_ref) {
    var clearSelection = _ref.clearSelection,
        getInputProps = _ref.getInputProps,
        getRef = _ref.getRef,
        getToggleButtonProps = _ref.getToggleButtonProps,
        inputValue = _ref.inputValue,
        isShown = _ref.isShown,
        openMenu = _ref.openMenu;
    return /*#__PURE__*/React.createElement(Group, _extends({
      ref: getRef,
      size: size,
      width: width
    }, rest), /*#__PURE__*/React.createElement(TextInput, _extends({
      width: 0,
      flex: 1,
      height: height,
      value: inputValue,
      borderTopRightRadius: 0,
      borderBottomRightRadius: 0,
      disabled: disabled
    }, getInputProps(_objectSpread(_objectSpread({}, inputProps), {}, {
      placeholder: placeholder,
      onFocus: function onFocus() {
        if (openOnFocus) openMenu();
      },
      onChange: function onChange(e) {
        if (isOpenedByButton) {
          setIsOpenedByButton(false);
        }

        if (e.target.value.trim() === '') {
          // Prevent the selected item from sticking around
          clearSelection();
        }
      }
    })))), /*#__PURE__*/React.createElement(IconButton, _extends({
      color: "muted",
      icon: isLoading ? undefined : CaretDownIcon,
      appearance: "default",
      height: height,
      marginLeft: -1,
      paddingLeft: isLoading ? 12 : 0,
      paddingRight: 0,
      borderTopLeftRadius: 0,
      borderBottomLeftRadius: 0,
      disabled: disabled,
      isLoading: isLoading
    }, getToggleButtonProps(_objectSpread(_objectSpread({}, buttonProps), {}, {
      onClick: function onClick() {
        if (!isShown) {
          setIsOpenedByButton(true);
        }
      }
    })))));
  });
});
Combobox.propTypes = _objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread({}, dimensions.propTypes), spacing.propTypes), position.propTypes), layout.propTypes), {}, {
  /**
   * The options to show in the menu.
   */
  items: PropTypes.array.isRequired,

  /**
   * The selected item when controlled.
   */
  selectedItem: PropTypes.any,

  /**
   * Function called when value changes.
   */
  onChange: PropTypes.func,

  /**
   * When true, open the autocomplete on focus.
   */
  openOnFocus: PropTypes.bool,

  /**
   * Default selected item when uncontrolled.
   */
  initialSelectedItem: PropTypes.any,

  /**
   * The placeholder text when there is no value present.
   */
  placeholder: PropTypes.string,

  /**
   * In case the array of items is not an array of strings,
   * this function is used on each item to return the string that will be shown on the filter
   */
  itemToString: PropTypes.func,

  /**
   * Properties forwarded to the input. Use with caution.
   */
  inputProps: PropTypes.object,

  /**
   * Properties forwarded to the button. Use with caution.
   */
  buttonProps: PropTypes.object,

  /**
   * Properties forwarded to the autocomplete component. Use with caution.
   */
  autocompleteProps: PropTypes.object,

  /**
   * Makes the input element disabled.
   */
  disabled: PropTypes.bool,

  /**
   * When true, show a loading spinner. This also disables the button.
   */
  isLoading: PropTypes.bool,
  size: PropTypes.oneOf(['small', 'medium', 'large'])
});
export default Combobox;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21ib2JveC9zcmMvQ29tYm9ib3guanMiXSwibmFtZXMiOlsiUmVhY3QiLCJtZW1vIiwidXNlU3RhdGUiLCJ1c2VDYWxsYmFjayIsIlByb3BUeXBlcyIsImRpbWVuc2lvbnMiLCJzcGFjaW5nIiwicG9zaXRpb24iLCJsYXlvdXQiLCJBdXRvY29tcGxldGUiLCJJY29uQnV0dG9uIiwiR3JvdXAiLCJDYXJldERvd25JY29uIiwiVGV4dElucHV0IiwiQ29tYm9ib3giLCJwcm9wcyIsImF1dG9jb21wbGV0ZVByb3BzIiwiYnV0dG9uUHJvcHMiLCJoZWlnaHQiLCJpbml0aWFsU2VsZWN0ZWRJdGVtIiwiaW5wdXRQcm9wcyIsImlzTG9hZGluZyIsIml0ZW1Ub1N0cmluZyIsIml0ZW1zIiwib25DaGFuZ2UiLCJvcGVuT25Gb2N1cyIsInBsYWNlaG9sZGVyIiwic2VsZWN0ZWRJdGVtIiwic2l6ZSIsIndpZHRoIiwicmVzdCIsImRpc2FibGVkIiwiaXNPcGVuZWRCeUJ1dHRvbiIsInNldElzT3BlbmVkQnlCdXR0b24iLCJoYW5kbGVTdGF0ZUNoYW5nZSIsImNoYW5nZXMiLCJzdGF0ZUFuZEhlbHBlcnMiLCJPYmplY3QiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJpc09wZW4iLCJvblN0YXRlQ2hhbmdlIiwiY2xlYXJTZWxlY3Rpb24iLCJnZXRJbnB1dFByb3BzIiwiZ2V0UmVmIiwiZ2V0VG9nZ2xlQnV0dG9uUHJvcHMiLCJpbnB1dFZhbHVlIiwiaXNTaG93biIsIm9wZW5NZW51Iiwib25Gb2N1cyIsImUiLCJ0YXJnZXQiLCJ2YWx1ZSIsInRyaW0iLCJ1bmRlZmluZWQiLCJvbkNsaWNrIiwicHJvcFR5cGVzIiwiYXJyYXkiLCJpc1JlcXVpcmVkIiwiYW55IiwiZnVuYyIsImJvb2wiLCJzdHJpbmciLCJvYmplY3QiLCJvbmVPZiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBLE9BQU9BLEtBQVAsSUFBZ0JDLElBQWhC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QUFDQTtBQUNFM0MsRUFBQUEsbUJBQW1CLEVBQUVmLFNBQVMsQ0FBQ3dELEdBaENqQzs7QUFrQ0U7QUFDRjtBQUNBO0FBQ0VsQyxFQUFBQSxXQUFXLEVBQUV0QixTQUFTLENBQUMyRCxNQXJDekI7O0FBdUNFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0V6QyxFQUFBQSxZQUFZLEVBQUVsQixTQUFTLENBQUN5RCxJQTNDMUI7O0FBNkNFO0FBQ0Y7QUFDQTtBQUNFekMsRUFBQUEsVUFBVSxFQUFFaEIsU0FBUyxDQUFDNEQsTUFoRHhCOztBQWtERTtBQUNGO0FBQ0E7QUFDRS9DLEVBQUFBLFdBQVcsRUFBRWIsU0FBUyxDQUFDNEQsTUFyRHpCOztBQXVERTtBQUNGO0FBQ0E7QUFDRWhELEVBQUFBLGlCQUFpQixFQUFFWixTQUFTLENBQUM0RCxNQTFEL0I7O0FBNERFO0FBQ0Y7QUFDQTtBQUNFakMsRUFBQUEsUUFBUSxFQUFFM0IsU0FBUyxDQUFDMEQsSUEvRHRCOztBQWlFRTtBQUNGO0FBQ0E7QUFDRXpDLEVBQUFBLFNBQVMsRUFBRWpCLFNBQVMsQ0FBQzBELElBcEV2QjtBQXNFRWxDLEVBQUFBLElBQUksRUFBRXhCLFNBQVMsQ0FBQzZELEtBQVYsQ0FBZ0IsQ0FBQyxPQUFELEVBQVUsUUFBVixFQUFvQixPQUFwQixDQUFoQjtBQXRFUjtBQXlFQSxlQUFlbkQsUUFBZiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBtZW1vLCB1c2VTdGF0ZSwgdXNlQ2FsbGJhY2sgfSBmcm9tICdyZWFjdCdcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcydcbmltcG9ydCB7IGRpbWVuc2lvbnMsIHNwYWNpbmcsIHBvc2l0aW9uLCBsYXlvdXQgfSBmcm9tICd1aS1ib3gnXG5pbXBvcnQgeyBBdXRvY29tcGxldGUgfSBmcm9tICcuLi8uLi9hdXRvY29tcGxldGUnXG5pbXBvcnQgeyBJY29uQnV0dG9uIH0gZnJvbSAnLi4vLi4vYnV0dG9ucydcbmltcG9ydCB7IEdyb3VwIH0gZnJvbSAnLi4vLi4vZ3JvdXAnXG5pbXBvcnQgeyBDYXJldERvd25JY29uIH0gZnJvbSAnLi4vLi4vaWNvbnMnXG5pbXBvcnQgeyBUZXh0SW5wdXQgfSBmcm9tICcuLi8uLi90ZXh0LWlucHV0J1xuXG5jb25zdCBDb21ib2JveCA9IG1lbW8oZnVuY3Rpb24gQ29tYm9ib3gocHJvcHMpIHtcbiAgY29uc3Qge1xuICAgIGF1dG9jb21wbGV0ZVByb3BzLFxuICAgIGJ1dHRvblByb3BzLFxuICAgIGhlaWdodCxcbiAgICBpbml0aWFsU2VsZWN0ZWRJdGVtLFxuICAgIGlucHV0UHJvcHMsXG4gICAgaXNMb2FkaW5nID0gZmFsc2UsXG4gICAgaXRlbVRvU3RyaW5nLFxuICAgIGl0ZW1zLFxuICAgIG9uQ2hhbmdlLFxuICAgIG9wZW5PbkZvY3VzID0gZmFsc2UsXG4gICAgcGxhY2Vob2xkZXIsXG4gICAgc2VsZWN0ZWRJdGVtLFxuICAgIHNpemUgPSAnbWVkaXVtJyxcbiAgICB3aWR0aCA9IDI0MCxcbiAgICAuLi5yZXN0XG4gIH0gPSBwcm9wc1xuXG4gIGNvbnN0IGRpc2FibGVkID0gcHJvcHMuZGlzYWJsZWQgfHwgaXNMb2FkaW5nXG5cbiAgY29uc3QgW2lzT3BlbmVkQnlCdXR0b24sIHNldElzT3BlbmVkQnlCdXR0b25dID0gdXNlU3RhdGUoZmFsc2UpXG5cbiAgY29uc3QgaGFuZGxlU3RhdGVDaGFuZ2UgPSB1c2VDYWxsYmFjayhcbiAgICAoY2hhbmdlcywgc3RhdGVBbmRIZWxwZXJzKSA9PiB7XG4gICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGNoYW5nZXMsICdpc09wZW4nKSkge1xuICAgICAgICBpZiAoIWNoYW5nZXMuaXNPcGVuKSB7XG4gICAgICAgICAgc2V0SXNPcGVuZWRCeUJ1dHRvbihmYWxzZSlcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoYXV0b2NvbXBsZXRlUHJvcHMgJiYgdHlwZW9mIGF1dG9jb21wbGV0ZVByb3BzLm9uU3RhdGVDaGFuZ2UgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgYXV0b2NvbXBsZXRlUHJvcHMub25TdGF0ZUNoYW5nZShjaGFuZ2VzLCBzdGF0ZUFuZEhlbHBlcnMpXG4gICAgICB9XG4gICAgfSxcbiAgICBbYXV0b2NvbXBsZXRlUHJvcHNdXG4gIClcblxuICByZXR1cm4gKFxuICAgIDxBdXRvY29tcGxldGVcbiAgICAgIGl0ZW1zPXtpdGVtc31cbiAgICAgIHNlbGVjdGVkSXRlbT17c2VsZWN0ZWRJdGVtfVxuICAgICAgaW5pdGlhbFNlbGVjdGVkSXRlbT17aW5pdGlhbFNlbGVjdGVkSXRlbX1cbiAgICAgIGl0ZW1Ub1N0cmluZz17aXRlbVRvU3RyaW5nfVxuICAgICAgb25DaGFuZ2U9e29uQ2hhbmdlfVxuICAgICAgaXNGaWx0ZXJEaXNhYmxlZD17aXNPcGVuZWRCeUJ1dHRvbn1cbiAgICAgIHsuLi5hdXRvY29tcGxldGVQcm9wc31cbiAgICAgIG9uU3RhdGVDaGFuZ2U9e2hhbmRsZVN0YXRlQ2hhbmdlfVxuICAgID5cbiAgICAgIHsoeyBjbGVhclNlbGVjdGlvbiwgZ2V0SW5wdXRQcm9wcywgZ2V0UmVmLCBnZXRUb2dnbGVCdXR0b25Qcm9wcywgaW5wdXRWYWx1ZSwgaXNTaG93biwgb3Blbk1lbnUgfSkgPT4gKFxuICAgICAgICA8R3JvdXAgcmVmPXtnZXRSZWZ9IHNpemU9e3NpemV9IHdpZHRoPXt3aWR0aH0gey4uLnJlc3R9PlxuICAgICAgICAgIDxUZXh0SW5wdXRcbiAgICAgICAgICAgIHdpZHRoPXswfVxuICAgICAgICAgICAgZmxleD17MX1cbiAgICAgICAgICAgIGhlaWdodD17aGVpZ2h0fVxuICAgICAgICAgICAgdmFsdWU9e2lucHV0VmFsdWV9XG4gICAgICAgICAgICBib3JkZXJUb3BSaWdodFJhZGl1cz17MH1cbiAgICAgICAgICAgIGJvcmRlckJvdHRvbVJpZ2h0UmFkaXVzPXswfVxuICAgICAgICAgICAgZGlzYWJsZWQ9e2Rpc2FibGVkfVxuICAgICAgICAgICAgey4uLmdldElucHV0UHJvcHMoe1xuICAgICAgICAgICAgICAuLi5pbnB1dFByb3BzLFxuICAgICAgICAgICAgICBwbGFjZWhvbGRlcixcbiAgICAgICAgICAgICAgb25Gb2N1czogKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChvcGVuT25Gb2N1cykgb3Blbk1lbnUoKVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBvbkNoYW5nZTogZSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGlzT3BlbmVkQnlCdXR0b24pIHtcbiAgICAgICAgICAgICAgICAgIHNldElzT3BlbmVkQnlCdXR0b24oZmFsc2UpXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGUudGFyZ2V0LnZhbHVlLnRyaW0oKSA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICAgIC8vIFByZXZlbnQgdGhlIHNlbGVjdGVkIGl0ZW0gZnJvbSBzdGlja2luZyBhcm91bmRcbiAgICAgICAgICAgICAgICAgIGNsZWFyU2VsZWN0aW9uKClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pfVxuICAgICAgICAgIC8+XG4gICAgICAgICAgPEljb25CdXR0b25cbiAgICAgICAgICAgIGNvbG9yPVwibXV0ZWRcIlxuICAgICAgICAgICAgaWNvbj17aXNMb2FkaW5nID8gdW5kZWZpbmVkIDogQ2FyZXREb3duSWNvbn1cbiAgICAgICAgICAgIGFwcGVhcmFuY2U9XCJkZWZhdWx0XCJcbiAgICAgICAgICAgIGhlaWdodD17aGVpZ2h0fVxuICAgICAgICAgICAgbWFyZ2luTGVmdD17LTF9XG4gICAgICAgICAgICBwYWRkaW5nTGVmdD17aXNMb2FkaW5nID8gMTIgOiAwfVxuICAgICAgICAgICAgcGFkZGluZ1JpZ2h0PXswfVxuICAgICAgICAgICAgYm9yZGVyVG9wTGVmdFJhZGl1cz17MH1cbiAgICAgICAgICAgIGJvcmRlckJvdHRvbUxlZnRSYWRpdXM9ezB9XG4gICAgICAgICAgICBkaXNhYmxlZD17ZGlzYWJsZWR9XG4gICAgICAgICAgICBpc0xvYWRpbmc9e2lzTG9hZGluZ31cbiAgICAgICAgICAgIHsuLi5nZXRUb2dnbGVCdXR0b25Qcm9wcyh7XG4gICAgICAgICAgICAgIC4uLmJ1dHRvblByb3BzLFxuICAgICAgICAgICAgICBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFpc1Nob3duKSB7XG4gICAgICAgICAgICAgICAgICBzZXRJc09wZW5lZEJ5QnV0dG9uKHRydWUpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KX1cbiAgICAgICAgICAvPlxuICAgICAgICA8L0dyb3VwPlxuICAgICAgKX1cbiAgICA8L0F1dG9jb21wbGV0ZT5cbiAgKVxufSlcblxuQ29tYm9ib3gucHJvcFR5cGVzID0ge1xuICAvKipcbiAgICogSW1wbGVtZW50cyBzb21lIEFQSXMgZnJvbSB1aS1ib3guXG4gICAqL1xuICAuLi5kaW1lbnNpb25zLnByb3BUeXBlcyxcbiAgLi4uc3BhY2luZy5wcm9wVHlwZXMsXG4gIC4uLnBvc2l0aW9uLnByb3BUeXBlcyxcbiAgLi4ubGF5b3V0LnByb3BUeXBlcyxcblxuICAvKipcbiAgICogVGhlIG9wdGlvbnMgdG8gc2hvdyBpbiB0aGUgbWVudS5cbiAgICovXG4gIGl0ZW1zOiBQcm9wVHlwZXMuYXJyYXkuaXNSZXF1aXJlZCxcblxuICAvKipcbiAgICogVGhlIHNlbGVjdGVkIGl0ZW0gd2hlbiBjb250cm9sbGVkLlxuICAgKi9cbiAgc2VsZWN0ZWRJdGVtOiBQcm9wVHlwZXMuYW55LFxuXG4gIC8qKlxuICAgKiBGdW5jdGlvbiBjYWxsZWQgd2hlbiB2YWx1ZSBjaGFuZ2VzLlxuICAgKi9cbiAgb25DaGFuZ2U6IFByb3BUeXBlcy5mdW5jLFxuXG4gIC8qKlxuICAgKiBXaGVuIHRydWUsIG9wZW4gdGhlIGF1dG9jb21wbGV0ZSBvbiBmb2N1cy5cbiAgICovXG4gIG9wZW5PbkZvY3VzOiBQcm9wVHlwZXMuYm9vbCxcblxuICAvKipcbiAgICogRGVmYXVsdCBzZWxlY3RlZCBpdGVtIHdoZW4gdW5jb250cm9sbGVkLlxuICAgKi9cbiAgaW5pdGlhbFNlbGVjdGVkSXRlbTogUHJvcFR5cGVzLmFueSxcblxuICAvKipcbiAgICogVGhlIHBsYWNlaG9sZGVyIHRleHQgd2hlbiB0aGVyZSBpcyBubyB2YWx1ZSBwcmVzZW50LlxuICAgKi9cbiAgcGxhY2Vob2xkZXI6IFByb3BUeXBlcy5zdHJpbmcsXG5cbiAgLyoqXG4gICAqIEluIGNhc2UgdGhlIGFycmF5IG9mIGl0ZW1zIGlzIG5vdCBhbiBhcnJheSBvZiBzdHJpbmdzLFxuICAgKiB0aGlzIGZ1bmN0aW9uIGlzIHVzZWQgb24gZWFjaCBpdGVtIHRvIHJldHVybiB0aGUgc3RyaW5nIHRoYXQgd2lsbCBiZSBzaG93biBvbiB0aGUgZmlsdGVyXG4gICAqL1xuICBpdGVtVG9TdHJpbmc6IFByb3BUeXBlcy5mdW5jLFxuXG4gIC8qKlxuICAgKiBQcm9wZXJ0aWVzIGZvcndhcmRlZCB0byB0aGUgaW5wdXQuIFVzZSB3aXRoIGNhdXRpb24uXG4gICAqL1xuICBpbnB1dFByb3BzOiBQcm9wVHlwZXMub2JqZWN0LFxuXG4gIC8qKlxuICAgKiBQcm9wZXJ0aWVzIGZvcndhcmRlZCB0byB0aGUgYnV0dG9uLiBVc2Ugd2l0aCBjYXV0aW9uLlxuICAgKi9cbiAgYnV0dG9uUHJvcHM6IFByb3BUeXBlcy5vYmplY3QsXG5cbiAgLyoqXG4gICAqIFByb3BlcnRpZXMgZm9yd2FyZGVkIHRvIHRoZSBhdXRvY29tcGxldGUgY29tcG9uZW50LiBVc2Ugd2l0aCBjYXV0aW9uLlxuICAgKi9cbiAgYXV0b2NvbXBsZXRlUHJvcHM6IFByb3BUeXBlcy5vYmplY3QsXG5cbiAgLyoqXG4gICAqIE1ha2VzIHRoZSBpbnB1dCBlbGVtZW50IGRpc2FibGVkLlxuICAgKi9cbiAgZGlzYWJsZWQ6IFByb3BUeXBlcy5ib29sLFxuXG4gIC8qKlxuICAgKiBXaGVuIHRydWUsIHNob3cgYSBsb2FkaW5nIHNwaW5uZXIuIFRoaXMgYWxzbyBkaXNhYmxlcyB0aGUgYnV0dG9uLlxuICAgKi9cbiAgaXNMb2FkaW5nOiBQcm9wVHlwZXMuYm9vbCxcblxuICBzaXplOiBQcm9wVHlwZXMub25lT2YoWydzbWFsbCcsICdtZWRpdW0nLCAnbGFyZ2UnXSlcbn1cblxuZXhwb3J0IGRlZmF1bHQgQ29tYm9ib3hcbiJdfQ==